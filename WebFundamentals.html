<!DOCTYPE html>
<html>
<head>
<title>Web Development Fundamentals</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<link rel="stylesheet" type="text/css" href="css/basic.css" />
<link rel="stylesheet" href="css/bootstrap-combined.css"/>

    <script src="lib/jquery.js"></script>
    <script src="lib/bootstrap.js"></script>

<style type="text/css">

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
<style type="text/css">
.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #aaaaaa } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */
.task-list {
padding-left:10px;
margin-bottom:0;
}

.task-list li {
    margin-left: 20px;
}

.task-list-item {
list-style-type:none;
padding-left:10px;
}

.task-list-item label {
font-weight:400;
}

.task-list-item.enabled label {
cursor:pointer;
}

.task-list-item+.task-list-item {
margin-top:3px;
}

.task-list-item-checkbox {
display:inline-block;
margin-left:-20px;
margin-right:3px;
vertical-align:1px;
}
</style>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54365763-1', 'auto');
  ga('send', 'pageview');

</script>

</head>
<body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar">
            <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
          </button>
          
          <div>
            <ul class="nav">
              <li>
                <a href="http://itjumpstart.wordpress.com" target="_blank"><p>ITJUMPSTART</p></a>
              </li>
            </ul>
          </div>
          <!--/.nav-collapse -->
        </div>
      </div>
    </div>

	
<br><br>

<h1>Web Development Fundamentals</h1>

<p><strong>AUTHOR</strong>: Isagani Mendoza (<a href="http://itjumpstart.wordpress.com" target="_blank">ITJUMPSTART</a>)</p>

<p><strong>Table of Contents</strong></p>

<a href="#part1">... Part I. Three-Tier Architecture </a><br>
<a href="#uilayer">... ... Presentation Layer</a><br>
<a href="#applayer">... ... Application Layer</a><br>
<a href="#dblayer">... ... Database Layer</a><br>

<br>
<a href="#part2">... Part II. Front-end Development</a><br>
<a href="#todoapp">... ... Build your own Todo App</a><br>
<a href="#jsbasics">... ... JavaScript Basics</a><br>
<a href="#jquery">... ... Learn jQuery</a><br>
<a href="#events">... ... Events</a><br>
<a href="#ajax">... ... Ajax</a><br>
<a href="#fp">... ... Functional Programming</a><br>
<a href="#pbp">... ... Promise-based Programming</a><br>
<a href="#bootstrap">... ... Learn Bootstrap 2</a><br>

<br>
<a href="#part3">Part III. Back-End Development</a><br>
<a href="#logic">... Logic Tier</a><br>
<a href="#rule1">... ... Rule 1: Export services via port binding</a><br>
<a href="#rule2">... ... Rule 2: Minimize control logic, maximize application logic</a><br>
<a href="#rule3">... ... Rule 3: Concurrency is not parallelism</a><br>
<a href="#rule4">... ... Rule 4: Use interface, not leaky abstraction</a><br>
<a href="#rule5">... ... Rule 5: Scale out the logic tier, scale up the storage tier</a><br>
<a href="#rule6">... ... Rule 6: Your tool does matter</a><br>
<a href="#rule7">... ... Rule 7: Separate data structures from functions</a><br>
<a href="#rule8">... ... Rule 8: Software development is "anything goes"</a><br>
<a href="#rule9">... ... Rule 9: Git is for version control, not deployment</a><br>
<a href="#rule10">... ... Rule 10: Understand the problem domain first</a><br>
<a href="#rule11">... ... Rule 11: Simplicity is the ultimate sophistication</a><br>
<a href="#rule12">... ... Rule 12: Do not be afraid of the command line</a><br>

<a href="#dbdevt">... Database Development</a><br>
<a href="#rdbms">... ... Basics of RDBMS</a><br>
<a href="#whyrdb">... ... Why Relational Database?</a><br>
<a href="#isolation">... ... Isolation Levels</a><br>
<a href="#limitsrdb">... ... Limitations of Relational Database</a><br>
<a href="#basicsrdb">... ... Basics of Relational Database</a><br>
<a href="#whysql">... ... Why SQL?</a><br>
<a href="#sql">... ... SQL Caveats</a><br>
<a href="#sqljoin">... ... MySQL Join</a><br>
<a href="#sqltojson">... ... MySQL to JSON</a><br>

<p><strong>PREFACE</strong>:</p>

<p>There are only two types of application development. Alex Payne calls it "<a href="https://al3x.net/2010/07/27/node.html">scaling in the small</a>" versus "scaling in the large". The top 1% of all developers are the likes of Google, Facebook, Amazon and others who are scaling in the large. The rest is a continuum of solo developers and small-and-medium sized businesses who simply want to get the job done. </p>

<p>Linode founder <a href="http://gigaom.com/2014/08/16/when-cloud-computing-isnt-all-about-scale">Chris Aker</a> said it best:</p>

<blockquote>
<p>I think, largely the difference between a VPS and a cloud server is all marketing... When people think cloud, they think ephemeral, scale-out, highly flexible infrastructure. But really at the essence of it, what you’re getting out the end of either one of those is a Linux virtual machine... I think plenty of people get sold on the promise of Amazon. Cloud isn’t magic, you can’t just put your application in the cloud and expect it to scale to a billion users. It just doesn’t work like that... it’s not a magic button.</p>
</blockquote>

<p>The same is true of Web application development. There are solutions for trivial tasks all the way up to the most complex. For most developers, all you need is jQuery, not client-side frameworks.</p>

<p>This is why you need to know the fundamentals. Once you know the basics, you can tell if somebody is selling you snake oil or the real deal. Once you know the fundamentals, you can tell if somebody is selling you <a href="http://www.joyent.com/blog/magical-block-store-when-abstractions-fail-us">bandaids and chicken wire</a>.</p>

<p>As <a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html">Joel Spolsky</a> has said:</p>

<blockquote>
<p>So the abstractions save us time working, but they don't save us time learning.</p>
</blockquote>

<p>I hope this book about Web fundamentals will save you some time learning.</p>

<h3> SHARE THIS: </h3>
 

<blockquote>
<p>This guidebook is licensed under Creative Commons Attribution-NonCommercial-ShareAlike (CC BY-NC-SA) except for portions where they are copyrighted by its respective author(s). You may share this PDF through email and social networks.</p>
</blockquote>

<p>References:</p>

<ul class="task-list">
<li>Chad Hower on three-tier architecture</li>
<li>Jake Spurlock, author of "Bootstrap"</li>
<li>jQuery Foundation for chapters on front-end development</li>
<li>Michael Fogus, author of "Functional JavaScript"</li>
<li>Peter Smith, author of "Professional Website Performance"</li>
<li>Auth0 for chapter on JSON Web Token</li>
<li>Rob Pike for concurrency vs parallelism</li>
<li>Baron Schwartz et al, authors of "High Performance MySQL"</li>
<li>Adam Wiggins for The Twelve-Factor App</li>
<li>Leonard Richardson and Sam Ruby, authors of "RESTful Web Services"</li>
<li>Martin Abbott and Michael Fisher, authors of "Scalability Rules"</li>
<li>Jeff Atwood, SQL joins at "Coding Horror" blog</li>
<li>C.L.Mofatt, SQL joins at CodeProject</li>
<li>MathIsFun.com for Venn diagram examples</li>
<li>Thomas Frank for MySQL to JSON script</li>
</ul><p>Acknowledgement:</p>

<ul class="task-list">
<li>Thanks to all developers of open-source projects without whom this guidebook would have been non-existent</li>
</ul><p><br></p>

<a name="part1"><h2>Part I. Three-Tier Architecture</h2></a>

<a name="uilayer"><h3>Presentation Layer</h3></a>

<p><a href="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" alt="" data-canonical-src="http://i.imgur.com/eb9S9Fz.jpg" style="max-width:100%;"></a></p>

<h4>Build static pages</h4>

<p>The presentation tier is about the user interface and should be static as much as possible unless you are building a media site. The debate between static page applications and dynamic pages is as divisive as the debate between Web apps and native mobile apps. Technology debates are akin to religious wars. The merits of each side depend on each situation and thus, there is no one-size-fits-all solution. The only thing that matters is context.</p>

<p>In this book, I want to state the <strong>context</strong> once and for all: <strong>that of creating CRUD Web apps using a relational database, not mobile apps</strong>.</p>

<p>In this context, static page applications (SPA) are composed of three parts:</p>

<ul class="task-list">
<li>HTML - presentation</li>
<li>CSS - style</li>
<li>JavaScript - behavior </li>
</ul><p>When the application needs data, it simply invokes AJAX calls in the server and render it at the client-side with or without using a template engine. The data is being transported in JSON format. Read how <a href="http://engineering.linkedin.com/frontend/leaving-jsps-dust-moving-linkedin-dustjs-client-side-templates">LinkedIn</a> left JSP in the dust. </p>

<p>A static app is also known as single-page app (SPA) since it embodies one aspect of an application in a single Web page. In reality, SPA rarely stands alone as it needs to invoke other SPA to round out all the business aspects of an application.</p>

<p>More info at <a href="http://www.staticapps.org/">staticapps.org</a>.</p>

<h4>Use JSON as data transport</h4>

<p>JSON (JavaScript Object Notation) is the de facto data transport for Web pages since it speaks the same JavaScript language on the client-side, and is easily consumed on the server-side regardless if it is JavaScript or not. However, do not abuse JSON. For simple response data like a one-line status message, you may use plain text.</p>

<h4>Do not use client-side frameworks</h4>

<p>Client-side frameworks like <a href="http://okmaya.com/2014/03/12/the-reason-angular-js-will-fail">Angular</a>, Ember, Knockout, Backbone and others were built by advanced JavaScript developers as an abstraction for their own use. </p>

<blockquote>
<p>Instead of thinking in terms of MVC, you should think in terms of Three Tier Architecture. MVC is a leaky abstraction because Web development straddles at least three sides.</p>
</blockquote>

<p>Model - leaks to SQL or NoSQL query language (storage tier)<br>
View - HTML and CSS (presentation tier)<br>
Controller - RESTful API (logic tier)</p>

<p>You should use an interface instead of a leaky abstraction (see Rule 4 at Part III).</p>

<p>Today, there is one universal interface that can do everything what all those client-side frameworks can do: jQuery.</p>

<p>Why jQuery?</p>

<ul class="task-list">
<li><p>It is modular, extensible and easy to learn. It can be used in small projects and can scale to large ones by using building blocks like custom events and promise-based programming. jQuery can interface with functional programming libraries as well like Underscore/LoDash and BaconJS.</p></li>
<li><p>Instead of thinking in terms of models, you can simply use JSON and it will work using jQuery AJAX API regardless of server-side languages.</p></li>
<li><p>The issue with client-side frameworks is that they impose a certain methodology in doing the same thing. But there lies the problem. Software development just like any human endeavor is, in the words of Austrian philosopher Paul Feyerabend, "<a href="http://en.wikipedia.org/wiki/Epistemological_anarchism">anything goes</a>". There is no universal methodology that will hammer out all use cases but you can have a universal interface. Like Lego blocks, you can mix and match components however you like as long as it conforms to the interface. The loose coupling of interface and implementation is the hallmark of great software design.</p></li>
</ul><p><strong>What about two-way data binding?</strong></p>

<p>I will quote Michael S. Mikowski and Josh C. Powell, authors of "Single Page Web Applications":</p>

<blockquote>
<p>Beware SPA “framework” libraries bearing gifts</p>
</blockquote>

<p>Some SPA “framework” libraries promise “automatic two-way data binding” which certainly sounds good. But we’ve learned a few points of caution about such promises in spite of the impressive canned demos:</p>

<ul class="task-list">
<li>We’ll need to learn the language of the library—its API and terminology to make it do the things a well-groomed presenter can do. This can be a significant investment.</li>
<li>The library author often has a vision of how an SPA is supposed to be structured. If our SPA doesn’t meet that vision, retrofitting can get expensive. </li>
<li>Libraries can be big, buggy, and offer another layer of complexity where things can go wrong.</li>
<li>The library’s data binding may often not meet our SPA requirements.</li>
</ul><p>Let’s focus on that last point. Perhaps we’d like a user to be able to edit a row in a table, and when finished, either accept the entire row or cancel (in which case the row should revert back to old values). And, when the user is done editing rows, we’d like to have the user accept or cancel the entire edited table. And only then would we even consider saving the table to the backend.</p>

<p>The probability of a framework library supporting this kind of reasonable interaction “out-of-the-box” is low. So if we go with a library, we’ll need to create a custom override method to circumvent the default behavior. If we have to do that just a few times, we can easily end up with more code, more layers, more files, and more complexity than if we’d written the damn thing ourselves in the first place.</p>

<p>After a few well-intended attempts, we’ve learned to approach framework libraries with caution. We’ve found they can add complexity to an SPA rather than making development better, faster, or easier to understand. That doesn’t mean we should never use framework libraries—they have their place. But our example SPAs (and quite a few in production) work fine with just jQuery, some plugins, and a few specialized tools like TaffyDb. Often, simpler is better.</p>

<p>See my other rules "Do not use ORM" and "Do not use MVC framework" and I will rest my case against client-side frameworks.</p>

<h4>Do not reinvent the JavaScript module system</h4>

<p>There is only one JavaScript module system that works now and into the future: the Node module system (not AMD or RequireJS).</p>

<p>Breaking JavaScript code into modules is the key to developing large-scale JavaScript applications. The Node module system works in the server only but it can also work in the Web browser using Browserify. </p>

<p>The simplicity of Node Package Manager trumps all the other alternatives because </p>

<ul class="task-list">
<li>it enables you to use one model both for server-side and client-side development</li>
<li>it does <a href="http://stackoverflow.com/questions/18641899/difference-between-bower-and-npm">nested dependency</a> which frees the developer from doing it on their own.</li>
</ul><h4>Use token for authentication, not cookies</h4>

<p>User authentication in the context of Web application refers to a mechanism where a user has been authenticated (for example, with a username/email address and password) and gets a corresponding cookie or token which is being sent to the Web server for every protected API request. For more info about why cookies are bad, read <a href="http://sitr.us/2011/08/26/cookies-are-bad-for-you.html">Jesse Hallett's post</a>. Hint: A cookie is bad when used as authentication mechanism but works just fine when used as storage mechanism. But why rely on cookies when desktop and mobile browsers already support <a href="http://diveintohtml5.info/storage.html">Web storage</a> (localStorage and sessionStorage)?</p>

<p><strong>Overview of User Authentication</strong> (courtesy: <a href="https://hacks.mozilla.org/2012/12/using-secure-client-side-sessions-to-build-simple-and-scalable-node-js-applications-a-node-js-holiday-season-part-3/">Mozilla</a>)</p>

<p>Static websites are easy to scale. You can cache the heck out of them and you don’t have state to propagate between the various servers that deliver this content to end-users.</p>

<p>Unfortunately, most web applications need to carry some state in order to offer a personalized experience to users. If users can log into your site, then you need to keep sessions for them. The typical way that this is done is by setting a cookie with a random session identifier and storing session details on the server under this identifier.</p>

<p><strong>Scaling a stateful service</strong></p>

<p>Now, if you want to scale that service, you essentially have three options:</p>

<ul class="task-list">
<li>replicate that session data across all of the web servers,</li>
<li>use a central store that each web server connects to, or</li>
<li>ensure that a given user always hits the same web server</li>
</ul><p>These all have downsides:</p>

<ul class="task-list">
<li>Replication has a performance cost and increases complexity.</li>
<li>A central store will limit scaling and increase latency.</li>
<li>Confining users to a specific server leads to problems when that</li>
<li>server needs to come down.</li>
</ul><p>However, if you flip the problem around, you can find a fourth option: storing the session data on the client.</p>

<p><strong>Client-side sessions</strong></p>

<p>Pushing the session data to the browser has some obvious advantages:</p>

<ul class="task-list">
<li>the data is always available, regardless of which machine is serving a user</li>
<li>there is no state to manage on servers</li>
<li>nothing needs to be replicated between the web servers</li>
<li>new web servers can be added instantly</li>
</ul><p>There is one key problem though: you cannot trust the client not to tamper with the session data.</p>

<p>For example, if you store the user ID for the user’s account in a cookie, it would be easy for that user to change that ID and then gain access to someone else’s account.</p>

<p>While this sounds like a deal breaker, there is a clever solution to work around this trust problem: <strong>store the session data in a tamper-proof package</strong>. That way, there is no need to trust that the user hasn’t modified the session data. It can be verified by the server.</p>

<p>What that means in practice is that you encrypt and sign the cookie using a server key to keep users from reading or modifying the session data. This is what <a href="https://github.com/mozilla/node-client-sessions">node-client-sessions</a> does.</p>

<p><strong>Benefits of Token-based Authentication</strong></p>

<p>Now, if you replace cookies with tokens, here are the benefits: (courtesy: <a href="https://auth0.com/blog/2014/01/07/angularjs-authentication-with-cookies-vs-token">Auth0</a>)</p>

<ul class="task-list">
<li><p>Cross-domain / CORS: cookies + CORS don't play well across different domains. A token-based approach allows you to make AJAX calls to any server, on any domain because you use an HTTP header to transmit the user information.</p></li>
<li><p>Stateless (a.k.a. Server side scalability): there is no need to keep a session store, the token is a self-contained entity that conveys all the user information. The rest of the state lives in cookies or local storage on the client side.</p></li>
<li><p>CDN: you can serve all the assets of your app from a CDN (e.g. javascript, HTML, images, etc.), and your server side is just the API.</p></li>
<li><p>Decoupling: you are not tied to a particular authentication scheme. The token might be generated anywhere, hence your API can be called from anywhere with a single way of authenticating those calls.</p></li>
<li><p>Mobile ready: when you start working on a native platform (iOS, Android, Windows 8, etc.) cookies are not ideal when consuming a secure API (you have to deal with cookie containers). Adopting a token-based approach simplifies this a lot.</p></li>
<li><p>CSRF: since you are not relying on cookies, you don't need to protect against cross site requests (e.g. it would not be possible to  your site, generate a POST request and re-use the existing authentication cookie because there will be none).</p></li>
<li><p>Performance: we are not presenting any hard perf benchmarks here, but a network roundtrip (e.g. finding a session on database) is likely to take more time than calculating an HMACSHA256 to validate a token and parsing its contents.</p></li>
<li><p>Login page is not a special case: If you are using Protractor to write your functional tests, you don't need to handle any special case for login.</p></li>
<li><p>Standard-based: your API could accepts a standard JSON Web Token (JWT). This is a standard and there are multiple backend libraries (.NET, Ruby, Java, Python, PHP) and companies backing their infrastructure (e.g. Firebase, Google, Microsoft). As an example, Firebase allows their customers to use any authentication mechanism, as long as you generate a JWT with certain pre-defined properties, and signed with the shared secret to call their API.</p></li>
</ul><p><strong>What's JSON Web Token?</strong></p>

<p>JSON Web Token (JWT, pronounced jot) is a relatively new token format used in space-constrained environments such as HTTP Authorization headers. JWT is architected as a method for transferring security claims-based between parties.</p>

<p>For Web applications that have user login requirements, it is better to use sessionStorage rather than localStorage to store the JSON Web token but not sensitive data such as password! Data in sessionStorage persists until the Web browser is closed.</p>

<p><strong>More about Tokens</strong> (courtesy: <a href="https://auth0.com/blog/2014/01/27/ten-things-you-should-know-about-tokens-and-cookies/">https://auth0.com/blog/2014/01/27/ten-things-you-should-know-about-tokens-and-cookies/</a>)</p>

<p><strong>Tokens need to be stored somewhere (local/session storage or cookies)</strong></p>

<p>In the context of tokens being used on single page applications, some people have brought up the issue about refreshing the browser, and what happens with the token. The answer is simple: you have to store the token somewhere: in session storage, local storage or a client side cookie. Most session storage polyfills fallback to cookies when the browser doesn't support it.</p>

<p>If you are wondering </p>

<blockquote>
<p>"but if I store the token in the cookie I'm back to square one". </p>
</blockquote>

<p>Not really, in this case you are using <a href="http://sitr.us/2011/08/26/cookies-are-bad-for-you.html">cookies as a storage mechanism, not as an authentication mechanism</a> (i.e. the cookie won't be used by the web framework to authenticate a user, hence no XSRF attack)</p>

<p><strong>Tokens can expire like cookies, but you have more control</strong></p>

<p>Tokens have an expiration (in JSON Web Tokens is represented by exp property), otherwise someone could authenticate forever to the API once they logged in at least once. Cookies also have expiration for the same reasons.</p>

<p>In the world of cookies, there are different options to control the lifetime of the cookie:</p>

<ul class="task-list">
<li>Cookies can be destroyed after the browser is closed (session cookies).</li>
<li>In addition to this you can implement a server side check (typically done for you by the web framework in use), and you could implement expiration or sliding window expiration.</li>
<li>Cookies can be persistent (not destroyed after the browser is closed) with an expiration.</li>
</ul><p>In the tokens world, once the token expires, you simply want to get a new one. You could implement an endpoint to refresh a token that will:</p>

<ul class="task-list">
<li>Validate the old token</li>
<li>Check if the user still exists or access hasn't been revoked or whatever makes sense for your application</li>
<li>Issue a new token with a renewed expiration</li>
</ul><p><strong>Local/session storage won't work across domains, use a marker cookie</strong></p>

<p>If you set a cookie's domain to .yourdomain.com it can be accessed from yourdomain.com and app.yourdomain.com, making it easier to detect from the main domain (where you probably have, let's say, your marketing site) that the user is already logged in and redirect her to app.yourdomain.com.</p>

<p>Tokens stored in local/session storage, on the other hand, can't be accessed from different domains (even if these are subdomains). So what can you do?</p>

<p>One possible option is, when the user authenticates on app.yourdomain.com and you generate a token you can also set a cookie set to .yourdomain.com</p>

<p>Then, in yourdomain.com you can check the existence of that cookie and redirect to app.yourdomain.com if the cookie exists. The token will be available on app subdomain, and from there on, the usual flow applies (if the token is still valid use it, if not get a new one unless last login was more than the threshold you set up).</p>

<p>It could happen that the cookie exists but the token was deleted or something else happened. In that case, the user would have to login again. But what's important to highlight here is, as we said before, we are not using the cookie as an authentication mechanism, just as a storage mechanism that happens to support storing information across different domains.</p>

<p><strong>Preflight requests will be sent on each CORS request</strong></p>

<p>Someone pointed out that the Authorization header is not a simple header, hence a pre-flight request would be required for all the requests to a particular URLs.</p>

<p>But this happens if you are sending Content-Type: application/json for instance. So this is already happening for most applications.</p>

<p>One small caveat, the OPTIONS request won't have the Authorization header itself, so your web framework should support treating OPTIONS and the subsequent requests differently (Note: Microsoft IIS for some reason seems to have issues with this).</p>

<p>When you need to stream something, use the token to get a signed request</p>

<p>When using cookies, you can trigger a file download and stream the contents easily. However, in the tokens world, where the request is done via XHR, you can't rely on that. The way you solve this is by generating a signed request like AWS does, for example. <a href="https://github.com/hueniverse/hawk">Hawk Bewits</a> is a nice framework to enable this:</p>

<p>Request:</p>

<div class="highlight highlight-html"><pre>POST /download-file/123
Authorization: Bearer...
</pre></div>

<p>Response:</p>

<div class="highlight highlight-html"><pre>ticket=lahdoiasdhoiwdowijaksjdoaisdjoasidja
</pre></div>

<p>This ticket is stateless and it is built based on the URL: host + path + query + headers + timestamp + HMAC, and has an expiration. So it can be used in the next, say 5 minutes, to download the file.</p>

<p>You would then redirect to </p>

<div class="highlight highlight-html"><pre>/download-file/123?ticket=lahdoiasdhoiwdowijaksjdoaisdjoasidja
</pre></div>

<p>The server will check that the ticket is valid and continue with business as usual.</p>

<p><strong>It's easier to deal with XSS than XSRF</strong></p>

<p>Cookies have this feature that allows setting an HttpOnly flag from server side so they can only be accessed on the server and not from JavaScript. This is useful because it protects the content of that cookie to be accessed by injected client-side code (XSS).</p>

<p>Since tokens are stored in local/session storage or a client side cookie, they are open to an XSS attack getting the attacker access to the token. This is a valid concern, and for that reason <strong>you should keep your token expiration low.</strong></p>

<p>But if you think about the attack surface on cookies, one of the main ones is XSRF. The reality is that XSRF is one of the most misunderstood attacks, and the average developer, might not even understand the risk, so lots of applications lack anti-XSRF mechanism. However, everybody understands what injection is. Put simply, if you allow input on your website and then render that without escaping it, you are open to XSS. So based on our experience, it is easier to protect against XSS than protecting against XSRF. Adding to that, anti-XSRF is not built-in on every web framework. XSS on the other hand is easy to prevent by using the escape syntax available by default on most template engines.</p>

<p><strong>The token gets sent on every request, watch out its size</strong></p>

<p>Every time you make an API request you have to send the token in the Authorization header.</p>

<p>Depending on how much information you store in that token, it could get big. On the other hand, session cookies usually are just an identifier (connect.sid, PHPSESSID, etc.) and the rest of the content lives on the server (in memory if you just have one server or a database if you run on a server farm).</p>

<p>Now, nothing prevents you from implementing a similar mechanism with tokens. The token would have the basic information needed and on the server side you would enrich it with more data on every API call. This is exactly the same thing cookies will do, with the difference that you have the additional benefit that this is now a conscious decision, you have full control, and is part of your code.</p>

<p>It is worth mentioning that you could also have the session stored completely on the cookie (instead of being just an identifier). Some web platforms support that, others not. For instance, in node.js you can use <a href="https://github.com/mozilla/node-client-sessions">mozilla/node-client-sessions</a>.</p>

<p><strong>If you store confidential info, encrypt the token</strong></p>

<p>The signature on the token prevents tampering with it. TLS/SSL prevents man in the middle attacks. But if the payload contains sensitive information about the user (e.g. SSN, whatever), you can also encrypt them. The JWT spec points to the JWE spec but most of the libraries don't implement JWE yet, so the simplest thing is to just encrypt with AES-CBC.</p>

<p>Of course you can use the approach on #7 and keep confidential info in a database.</p>

<p><strong>JSON Web Tokens can be used in OAuth</strong></p>

<p>Tokens are usually associated with OAuth. OAuth 2 is an authorization protocol that solves identity delegation. The user is prompted for consent to access his/her data and the authorization server gives back an access_token that can be used to call the APIs acting as that user.</p>

<p>Typically these tokens are opaque. They are called bearer tokens and are random strings that will be stored in some kind of hash-table storage on the server (db, cache, etc.) together with an expiration, the scope requested (e.g. access to friend list) and the user who gave consent. Later, when the API is called, this token is sent and the server lookup on the hash-table, rehydrating the context to make the authorization decision (did it expire? does this token has the right scope associated for the API that wants to be accessed?).</p>

<p>The main difference between these tokens and the ones we've been discussing is that signed tokens (e.g.: JWT) are "stateless". They don't need to be stored on a hash-table, hence it's a more lightweight approach. OAuth2 does not dictate the format of the access_token so you could return a JWT from the authorization server containing the scope/permissions and the expiration.</p>

<p><strong>Tokens are not silver bullets, think about your authorization use cases carefully</strong></p>

<p>Couple of years ago Auth0 helped a big company implement a token-based architecture. This was a 100.000+ employees company with tons of information to protect. They wanted to have a centralized organization-wide store for "authentication &amp; authorization". Think about "user X can read field id and name of clincial trial Y for hospital Z on country W" use cases. This fine-grained authorization, as you can imagine, can get unmanageable pretty quickly, not only technically but also administratively.</p>

<ul class="task-list">
<li>Tokens can get really big</li>
<li>Your apps/APIs gets more complicated</li>
<li>Whoever grant these permissions will have a hard time managing all this.</li>
</ul><p>We ended up working more on the information architecture side of things to make sure the right scopes and permissions were created. Conclusion: resist the temptation of putting everything into tokens and do some analysis and sizing before going all the way with this approach.</p>

<a name="applayer"><h3>Application Layer</h3></a>

<p><a href="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" alt="" data-canonical-src="http://i.imgur.com/eb9S9Fz.jpg" style="max-width:100%;"></a></p>

<h4>Do not use ORM</h4>

<p>ORM (Object/Relational Mapper) is a leaky abstraction borne out of a need to abstract specific use cases when dealing with an RDBMS. Since SQL is the query language of relational databases, you better start learning it at the soonest time possible because ORM won't cover all use cases that is natively available with SQL. Granted, SQL has different syntax among RDBMS products but that is no excuse compared to differing and more complex syntax among ORMs in every programming language! SQL is not hard to learn. And if you will venture to the world of NoSQL, you will find that there are even more query languages to learn with respect to a particular NoSQL data store. In the worlds of relational and non-relational data stores, SQL and NoSQL's respective query language are the gatekeepers to the source of data.</p>

<h4>Do not use MVC framework</h4>

<p>MVC is a leaky abstraction since it <a href="http://blog.iandavis.com/2007/09/24/mvc-obscures-the-mechanics-of-the-web/">obscures the mechanics of the Web</a>. MVC whether you use it on the client-side or server-side reminds me of anybody who lumps everything as an object (read Steve Yegge's article: <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">Execution in the Kingdom of Nouns</a>).</p>

<p>Here, I quote Jason Roelofs' article "<a href="http://collectiveidea.com/blog/archives/2012/06/28/wheres-your-business-logic/">Where's Your Business Logic</a>?",</p>

<blockquote>
<p>If I sat down with your code base and asked you how such-and-such a feature is implemented, what would you say? Would you lead me through controller filters and actions? What about model methods, includes, callbacks or observers? How about objects in lib/ (oh, and there’s also this other call to a mailer to make sure emails get sent out…), or would you even dive down into the database itself? Or would you send me all of these paths at once? Can you even remember or properly follow the code flow for a given use case? If any of this sounds familiar, and you’re nodding in a “yeah I know but…” fashion, but feel stuck, I’ve got an answer. The fundamental problem with almost every Rails project (and I’m sure in other frameworks as well), is that there is no direct codifying of the business rules and use cases of the application. There is no single location you can point to and say “here, these objects implement our use cases”. I put some of the blame on Rails itself, which has guided developers to use Controllers, Models, or Libraries, and nothing else. </p>
</blockquote>

<p>Here is a code snippet from the jQuery version of TodoMVC app:</p>

<div class="highlight highlight-javascript"><pre>    <span class="kd">var</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">todos</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">store</span><span class="p">(</span><span class="s1">'todos-jquery'</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">cacheElements</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">();</span>

            <span class="nx">Router</span><span class="p">({</span>
                <span class="s1">'/:filter'</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">;</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
                <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
            <span class="p">}).</span><span class="nx">init</span><span class="p">(</span><span class="s1">'/all'</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">cacheElements</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">todoTemplate</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#todo-template'</span><span class="p">).</span><span class="nx">html</span><span class="p">());</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">footerTemplate</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#footer-template'</span><span class="p">).</span><span class="nx">html</span><span class="p">());</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$todoApp</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#todoapp'</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$header</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$todoApp</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#header'</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$main</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$todoApp</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#main'</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$footer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$todoApp</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#footer'</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$newTodo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$header</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#new-todo'</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$toggleAll</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$main</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#toggle-all'</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$todoList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$main</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#todo-list'</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$count</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$footer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#todo-count'</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$clearBtn</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$footer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#clear-completed'</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">bindEvents</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$todoList</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$newTodo</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'keyup'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">create</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$toggleAll</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">toggleAll</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$footer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="s1">'#clear-completed'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">destroyCompleted</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="nx">list</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="s1">'.toggle'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">toggle</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="nx">list</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'dblclick'</span><span class="p">,</span> <span class="s1">'label'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">edit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="nx">list</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'keyup'</span><span class="p">,</span> <span class="s1">'.edit'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">editKeyup</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="nx">list</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'focusout'</span><span class="p">,</span> <span class="s1">'.edit'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="nx">list</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="s1">'.destroy'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
        <span class="p">},</span>
        <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">todos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFilteredTodos</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$todoList</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">todoTemplate</span><span class="p">(</span><span class="nx">todos</span><span class="p">));</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$main</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="nx">todos</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$toggleAll</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="s1">'checked'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getActiveTodos</span><span class="p">().</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">renderFooter</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$newTodo</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
            <span class="nx">util</span><span class="p">.</span><span class="nx">store</span><span class="p">(</span><span class="s1">'todos-jquery'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">renderFooter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">todoCount</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">activeTodoCount</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getActiveTodos</span><span class="p">().</span><span class="nx">length</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">template</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">footerTemplate</span><span class="p">({</span>
                <span class="nx">activeTodoCount</span><span class="o">:</span> <span class="nx">activeTodoCount</span><span class="p">,</span>
                <span class="nx">activeTodoWord</span><span class="o">:</span> <span class="nx">util</span><span class="p">.</span><span class="nx">pluralize</span><span class="p">(</span><span class="nx">activeTodoCount</span><span class="p">,</span> <span class="s1">'item'</span><span class="p">),</span>
                <span class="nx">completedTodos</span><span class="o">:</span> <span class="nx">todoCount</span> <span class="o">-</span> <span class="nx">activeTodoCount</span><span class="p">,</span>
                <span class="nx">filter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">filter</span>
            <span class="p">});</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$footer</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="nx">todoCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">template</span><span class="p">);</span>
        <span class="p">},</span>
</pre></div>

<p>I mean no disrespect to the author but this code is more abstract than using jQuery's handling of built-in or custom events. The problem lies with the abstraction of an object as a noun instead of the more intuitive object as an event (verb).</p>

<blockquote>
<p>Wouldn't it be simpler if we code in jQuery like below and capture state using closures, deferred/promises or by emitting custom events?</p>
</blockquote>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"#element"</span> <span class="p">).</span><span class="nx">on</span><span class="p">(</span> <span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>

<p>In my view, MVC is more abstract since it refactors code from a noun-based object perspective. Is there a more intuitive way to do this?</p>

<blockquote>
<p>I quote Conrad Irwin in his article "<a href="http://cirw.in/blog/time-to-move-on">MVC is dead, it's time to MOVE on</a>."</p>
</blockquote>

<p><a href="https://camo.githubusercontent.com/a3ad2445f580a6368e4159df6fdc4b9116af1a12/687474703a2f2f692e696d6775722e636f6d2f4d6161585979542e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/a3ad2445f580a6368e4159df6fdc4b9116af1a12/687474703a2f2f692e696d6775722e636f6d2f4d6161585979542e6a7067" alt="" data-canonical-src="http://i.imgur.com/MaaXYyT.jpg" style="max-width:100%;"></a></p>

<p>MVC is a phenomenal idea. You have models, which are nice self-contained bits of state, views which are nice self-contained bits of UI, and controllers which are nice self-contained bits of …</p>

<p>What?</p>

<p>I'm certainly not the first person to notice this, but the problem with MVC as given is that you end up stuffing too much code into your controllers, because you don't know where else to put it.</p>

<p>To fix this I've been using a new pattern: MOVE. Models, Operations, Views, and Events.</p>

<p>I'll define the details in a minute, but this diagram shows the basic structure of a MOVE application.</p>

<ul class="task-list">
<li>Models encapsulate everything that your application knows.</li>
<li>Operations encapsulate everything that your application does.</li>
<li>Views mediate between your application and the user.</li>
<li>Events are used to join all these components together safely.</li>
</ul><p>In order to avoid spaghetti code, it's also worth noting that there are recommendations for what objects of each type are allowed to do. I've represented these as arrows on the diagram. For example, views are allowed to listen to events emitted by models, and operations are allowed to change models, but models should not refer to either views or operations.</p>

<p><strong>Models</strong></p>

<p>The archetypal model is a "user" object. It has at the very least an email address, and probably also a name and a phone number.</p>

<p>In a MOVE application models only wrap knowledge. That means that, in addition to getters and setters, they might contain functions that let you check "is this the user's password?", but they don't contain functions that let you save them to a database or upload them to an external API. That would be the job of an operation.</p>

<p><strong>Operations</strong></p>

<p>A common operation for applications is logging a user in. It's actually two sub-operations composed together: first get the email address and password from the user, second load the "user" model from the database and check whether the password matches.</p>

<p>Operations are the doers of the MOVE world. They are responsible for making changes to your models, for showing the right views at the right time, and for responding to events triggered by user interactions. In a well factored application, each sub-operation can be run independently of its parent; which is why in the diagram events flow upwards, and changes are pushed downwards.</p>

<p>What's exciting about using operations in this way is that your entire application can itself be treated as an operation that starts when the program boots. It spawns as many sub-operations as it needs, where each concurrently existing sub-operation is run in parallel, and exits the program when they are all complete.</p>

<p><strong>Views</strong></p>

<p>The login screen is a view which is responsible for showing a few text boxes to the user. When the user clicks the "login" button the view will yield a "loginAttempt" event which contains the username and password that the user typed.</p>

<p>Everything the user can see or interact with should be powered by a view. They not only display the state of your application in an understandable way, but also simplify the stream of incoming user interactions into meaningful events. Importantly views don't change models directly, they simply emit events to operations, and wait for changes by listening to events emitted by the models.<br>
Events</p>

<p>The "loginAttempt" event is emitted by the view when the user clicks login. Additionally, when the login operation completes, the "currentUser" model will emit an event to notify your application that it has changed.</p>

<p>Listening on events is what gives MOVE (and MVC) the inversion of control that you need to allow models to update views without the models being directly aware of which views they are updating. This is a powerful abstraction technique, allowing components to be coupled together without interfering with each other.</p>

<p><strong>Why now?</strong></p>

<p>I don't wish to be misunderstood as implying that MVC is bad; it truly has been an incredibly successful way to structure large applications for the last few decades. Since it was invented however, new programming techniques have become popular. Without closures (or anonymous blocks) event binding can be very tedious; and without deferrables (also known as deferreds or promises) the idea of treating individual operations as objects in their own right doesn't make much sense.</p>

<a name="dblayer"><h3>Database Layer</h3></a>

<p><a href="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" alt="" data-canonical-src="http://i.imgur.com/eb9S9Fz.jpg" style="max-width:100%;"></a></p>

<h4>Do not put application logic at the database level</h4>

<p>Why?</p>

<p>a) Because applications have its own life cycle (aborted, shelved, rewrite, refactor, etc)</p>

<p>b) Baron Schwartz have said in "Web Operations" book:  </p>

<blockquote>
<p>The database should store the data, not the application itself.</p>
</blockquote>

<p>c) Stored procedures are not enough to account for business logic complexity</p>

<p>d) Application deployment can be complex (see <a href="http://www.codeproject.com/Articles/10746/Dude-where-s-my-business-logic">Chad Hower</a>)</p>

<p><a href="https://camo.githubusercontent.com/19116ca55fed06b5fff0417507b932a55c6e4eb1/687474703a2f2f692e696d6775722e636f6d2f524c4143564c6a2e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/19116ca55fed06b5fff0417507b932a55c6e4eb1/687474703a2f2f692e696d6775722e636f6d2f524c4143564c6a2e6a7067" alt="" data-canonical-src="http://i.imgur.com/RLACVLj.jpg" style="max-width:100%;"></a></p>

<h4>Enforce foreign key constraints at the application level</h4>

<p>Foreign keys are part of a sound relational database design. However, do not enforce foreign key constraints at the database level. Every developer worth his salt ought to know the relational structure of the database because the database is the lifeblood of every business. You have no business developing code if you don't know the structure of your relational database. Of course, foreign keys are not applicable to NoSQL data stores.</p>

<p>Furthermore, it's a matter of performance. To quote the authors of High Performance MySQL, Third Edition:</p>

<blockquote>
<p>Instead of using foreign keys as constraints, it’s often a good idea to constrain the values in the application. Foreign keys can add significant overhead. We don’t have any benchmarks to share, but we have seen many cases where server profiling revealed that foreign key constraint checks were the performance problem, and removing the foreign keys improved performance greatly.</p>
</blockquote>

<h4>Do not abuse RDBMS</h4>

<p>Relational databases are designed for a specific use case: relational data model. If you don't need the data constraints inherent in a relational model, you may use NoSQL where it is more appropriate (key/value, columnar, document-oriented, graph databases). In the same vein, don't abuse the NoSQL proposition. Don't fall into the trap of IT dogma wars.</p>

<p><br></p>

<a name="part2"><h2>Part II. Front-End Development</h2></a>


<a name="todoapp"><h3>Build your own Todo App</h3></a>

<p><a href="https://camo.githubusercontent.com/1faa2be22fe1aae17681b06cd79d59b3d55d50b6/687474703a2f2f692e696d6775722e636f6d2f767a664c36644c2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/1faa2be22fe1aae17681b06cd79d59b3d55d50b6/687474703a2f2f692e696d6775722e636f6d2f767a664c36644c2e706e67" alt="" data-canonical-src="http://i.imgur.com/vzfL6dL.png" style="max-width:100%;"></a></p>

<p>Before you begin learning front-end development, I have adopted the ToDo template from TodoMVC.com and this will serve as your main exercise throughout the book.</p>

<p>The ToDo application created at <a href="http://todomvc.com/">TodoMVC.com</a> spawns a lot of examples using different frameworks. That application leans heavily on the MVC pattern and is geared towards intermediate JavaScript developers. In this book, I want you to deviate from the TodoMVC specification and tinker on your own. After all, the aim is not to submit your own ToDo app but to learn organically.</p>

<p>Here are some deviations:</p>

<ul class="task-list">
<li>For consistency, use jQuery</li>
<li>You need not use Bower for now</li>
<li>You could have your own coding style but at least, use double-quotes in HTML and single-quotes in JS and CSS, and use a constant instead of the keyCode directly: var ENTER_KEY = 13;</li>
<li>Instead of using MVC, use event-driven and promise-based programming of jQuery</li>
<li>Use {{ }} delimiter in Underscore template</li>
</ul><p>Client-side templating is beyond the scope of this book. Read <a href="http://www.bennadel.com/blog/2411-using-underscore-js-templates-to-render-html-partials.htm">Ben Nadel's article</a> which I quote below:</p>

<blockquote>
<p>All client-side template engines attempt to answer the same question: How do I merge this data into this block of HTML?</p>
</blockquote>

<p>You can read the following references regarding client-side templates:</p>

<ul class="task-list">
<li><a href="http://braddunbar.net/2013/08/19/underscore-templates/">Brad Dunbar Underscore Templates</a></li>
<li><a href="http://engineering.linkedin.com/frontend/leaving-jsps-dust-moving-linkedin-dustjs-client-side-templates">LinkedIn's move to DustJS client-side template</a></li>
</ul><p>So leaving aside the client-side template issue, here are the functionality specifications of your ToDo app copied verbatim from the site (a zip template is included in this book excluding jQuery):</p>

<p><strong>Specs</strong> </p>

<h4>No todos</h4>

<p>When there are no todos, #main and #footer should be hidden.</p>

<h4>New todo</h4>

<p>New todos are entered in the input at the top of the app. Pressing Enter creates the todo, appends it to the todo list and clears the input. Make sure to .trim() the input and then check that it's not empty before creating a new todo.<br>
Mark all as complete</p>

<p>This checkbox toggles all the todos to the same state as itself. Make sure to clear the checked state after the the "Clear completed" button is clicked. The "Mark all as complete" checkbox should also be updated when single todo items are checked/unchecked. Eg. When all the todos are checked it should also get checked.</p>

<h4>Item</h4>

<p>A todo item has three possible interactions:</p>

<ul class="task-list">
<li><p>Clicking the checkbox marks the todo as complete by updating its completed value and toggling the class completed on its parent "li"</p></li>
<li><p>Double-clicking the  activates editing mode, by toggling the .editing class on its "li"</p></li>
<li><p>Hovering over the todo shows the remove button (.destroy)</p></li>
</ul><h4>Editing</h4>

<p>When editing mode is activated it will hide the other controls and bring forward an input that contains the todo title, which should be focused (.focus()). The edit should be saved on both blur and enter, and the editing class should be removed. Make sure to .trim() the input and then check that it's not empty. If it's empty the todo should instead be destroyed. If escape is pressed during the edit, the edit state should be left and any changes be discarded.</p>

<h4>Counter</h4>

<p>Displays the number of active todos in a pluralized form. Make sure the number is wrapped by a <strong> tag. Also make sure to pluralize the item word correctly: 0 items, 1 item, 2 items. Example: 2 items left</strong></p>

<h4>Clear completed button</h4>

<p>Displays the number of completed todos, and when clicked, removes them. Should be hidden when there are no completed todos.</p>

<h4>Persistence</h4>

<p>Your app should dynamically persist the todos to localStorage. If the framework has capabilities for persisting data (i.e. Backbone.sync), use that, otherwise vanilla localStorage. If possible, use the keys id, title, completed for each item. Make sure to use this format for the localStorage name: todos-[framework]. Editing mode should not be persisted.</p>

<h4>Routing</h4>

<p>Routing is required for all frameworks. Use the built-in capabilities if supported, otherwise use the <a href="https://github.com/flatiron/director">Flatiron Director</a> routing library located in the /js folder. The following routes should be implemented: #/ (all - default), #/active and #/completed (#!/ is also allowed). When the route changes the todo list should be filtered on a model level and the selected class on the filter links should be toggled. When an item is updated while in a filtered state, it should be updated accordingly. E.g. if the filter is Active and the item is checked, it should be hidden. Make sure the active filter is persisted on reload.</p>

<a name="jsbasics"><h3>JavaScript Basics</h3></a>


<p><a href="https://camo.githubusercontent.com/907b69ca9fb5b7b786a79ba7da1167bfc8b594d1/687474703a2f2f692e696d6775722e636f6d2f756d695850304f2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/907b69ca9fb5b7b786a79ba7da1167bfc8b594d1/687474703a2f2f692e696d6775722e636f6d2f756d695850304f2e706e67" alt="" data-canonical-src="http://i.imgur.com/umiXP0O.png" style="max-width:100%;"></a></p>

<p><em>(Courtesy: <a href="http://viralpatel.net/blogs/javascript-objects-functions">http://viralpatel.net/blogs/javascript-objects-functions</a>)</em></p>

<p>This chapter is courtesy of jQuery Learning Center:</p>

<h4> Getting Started</h4>

<p>Anatomy of a Web Page</p>

<p>Before diving into JavaScript, it helps to understand how it aligns with the other web technologies.</p>

<p><strong>HTML is for Content</strong></p>

<p>HTML is a markup language used to define and describe content. Whether it be a blog post, a search engine result, or an e-commerce site, the core content of a web page is written in HTML. A semantic markup, HTML is used to describe content in universal terms (headers, paragraphs, images, etc.)</p>

<p><strong>CSS is for Presentation</strong></p>

<p>CSS is a supplemental language that applies style to HTML documents. CSS is all about making content look better by defining fonts, colors, and other visual aesthetics. The power of CSS comes from the fact that styling is not intermingled with content. This means you can apply different styles to the same piece of content, which is critical when building responsive websites that look good across a range of devices.</p>

<p><strong>JavaScript is for Interactivity</strong></p>

<p>In the browser, JavaScript adds interactivity and behavior to HTML content. Without JavaScript, web pages would be static and boring. JavaScript helps bring a web page to life.</p>

<p>Look at this simple HTML page that includes CSS and JavaScript to see how it all fits together:</p>

<div class="highlight highlight-html"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Hello World<span class="nt">&lt;/title&gt;</span>
<span class="c">&lt;!-- CSS for presentation. --&gt;</span>
<span class="nt">&lt;style&gt;</span>
<span class="nt">h1</span> <span class="p">{</span> <span class="k">font-size</span><span class="o">:</span> <span class="m">14px</span><span class="p">;</span> <span class="k">color</span><span class="o">:</span> <span class="nb">hotpink</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">button</span> <span class="p">{</span> <span class="k">color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Hello World<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;button&gt;</span>Click Me!<span class="nt">&lt;/button&gt;</span>
<span class="c">&lt;!-- JavaScript for interactivity. --&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="c1">// Get a handle on the first button element in the document.</span>
<span class="kd">var</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"button"</span><span class="p">);</span>
<span class="c1">// If a user clicks on it, say hello!</span>
<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p>In the example above, HTML is used to describe the content. The "Hello World" text is described as a heading with the h1 tag and "Click Me!" is described as a button with the button tag. The style block contains CSS that changes the font size and color of the header text. The script block contains JavaScript that adds interactivity to the button. When a user clicks on the button, an alert message will appear that says "Hello!"</p>

<p><strong>A Scripting Language for the Web</strong></p>

<p>JavaScript was originally designed to add interactivity to web pages, not to be a general programming language, which makes it a scripting language. Scripting languages are regarded to be more productive than general languages because they are optimized for their specific domain (in this case, the web browser). However, recent advancements have brought JavaScript to the server-side (via Node.js) so it can now be used in place of languages like PHP, Ruby, or ASP. This guide will focus exclusively on JavaScript running in the browser with jQuery.</p>

<p>The name "JavaScript" is a bit misleading. Despite the similarity in name, JavaScript has no relationship with Java, a general purpose language. JavaScript is based on an open web standard called ECMAScript. Standards-based languages are not controlled by any one entity or corporation – instead, developers work together to define the language, which is why JavaScript will run in every web browser regardless of the operating system or device.</p>

<p><strong>What You Need to Get Started with JavaScript and jQuery</strong></p>

<pre><code>Web Browser
Text Editor
Developer Tools (optional)
</code></pre>

<p>One of JavaScript's greatest strengths is its simplicity. It can be written and run on any operating system, and the only requirements are a web browser and a text editor. There are also numerous tools that can make JavaScript development more productive, but they are completely optional.</p>

<p>Developer Tools</p>

<p>Commonly referred to as "developer tools," many browsers ship with built-in features that provide better insight into JavaScript and jQuery while they run in the browser. Although they aren't required, you may find developer tools helpful when it comes to debugging errors in your code.</p>

<h4>Running Code</h4>

<p><strong>External</strong></p>

<p>The first and recommended option is to write code in an external file (with a .js extension), which can then be included on our web page using an HTML script tag and pointing the src attribute to the file's location. Having JavaScript in a separate file will reduce code duplication if you want to reuse it on other pages. It will also allow the browser to cache the file on the remote client's computer, decreasing page load time.</p>

<div class="highlight highlight-javascript"><pre><span class="c">&lt;!--</span> <span class="nx">Code</span> <span class="nx">is</span> <span class="nx">written</span> <span class="k">in</span> <span class="nx">a</span> <span class="p">.</span><span class="nx">js</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">included</span> <span class="nx">via</span> <span class="nx">the</span> <span class="nx">script</span> <span class="nx">tag</span> <span class="nx">src</span> <span class="nx">attribute</span><span class="p">.</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"/path/to/example.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p><strong>Inline</strong></p>

<p>The second option is to inline the code directly on the web page. This is also achieved using HTML script tags, but instead of pointing the src attribute to a file, the code is placed between the tags. While there are use cases for this option, the majority of the time it is best to keep our code in an external file as described above.</p>

<div class="highlight highlight-javascript"><pre><span class="c">&lt;!--</span> <span class="nx">Embed</span> <span class="nx">code</span> <span class="nx">directly</span> <span class="nx">on</span> <span class="nx">a</span> <span class="nx">web</span> <span class="nx">page</span> <span class="nx">using</span> <span class="nx">script</span> <span class="nx">tags</span><span class="p">.</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="nx">alert</span><span class="p">(</span> <span class="s2">"Hello World!"</span> <span class="p">);</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p><strong>Attributes</strong></p>

<p>The last option is to use the event handler attributes of HTML elements. This method is strongly discouraged:</p>

<div class="highlight highlight-html"><pre><span class="c">&lt;!-- Inline code directly on HTML elements being clicked. --&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:alert( 'Hello World' );"</span><span class="nt">&gt;</span>Click Me!<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;button</span> <span class="na">onClick=</span><span class="s">"alert( 'Good Bye World' );"</span><span class="nt">&gt;</span>Click Me Too!<span class="nt">&lt;/button&gt;</span>
</pre></div>

<p><strong>Placement</strong></p>

<p>Placement of the previous two options is important and can vary depending on the situation. If you are including JavaScript that doesn't access the elements on the page, you can safely place the script before the closing HTML head tag. However, if the code will interact with the elements on the page, you have to make sure those elements exist at the time the script is executed. This common pitfall can be seen in the example below. The script for finding the element with the ID hello-world will be executed before the element is defined in the document.</p>

<div class="highlight highlight-html"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="c1">// Attempting to access an element too early will have unexpected results.</span>
<span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="s2">"hello-world"</span> <span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">title</span> <span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">"hello-world"</span><span class="nt">&gt;</span>Hello World<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p>It is a common pattern to move scripts to the bottom of the page, prior to the closing HTML body tag. This will guarantee that elements are defined when the script is executed:</p>

<div class="highlight highlight-html"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">"hello-world"</span><span class="nt">&gt;</span>Hello World<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="c1">// Moving the script to the bottom of the page will make sure the element exists.</span>
<span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="s2">"hello-world"</span> <span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">title</span> <span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<h4>Syntax Basics</h4>

<p><strong>Comments</strong></p>

<p>JavaScript has support for single- and multi-line comments. Comments are ignored by the JavaScript engine and therefore have no side-effects on the outcome of the program. Use comments to document the code for other developers. Libraries like JSDoc are available to help generate project documentation pages based on commenting conventions.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Single- and multi-line comments.</span>
<span class="c1">// This is an example of a single-line comment.</span>
<span class="cm">/*</span>
<span class="cm">* this is an example</span>
<span class="cm">* of a</span>
<span class="cm">* multi-line</span>
<span class="cm">* comment.</span>
<span class="cm">*/</span>
</pre></div>

<p><strong>Whitespace</strong></p>

<p>Whitespace is also ignored in JavaScript. There are many tools that will strip out all the whitespace in a program, reducing the overall file size and improving network latency. Given the availability of tools like these, whitespace should be leveraged to make the code as readable as possible.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Whitespace is insignificant.</span>
<span class="kd">var</span> <span class="nx">hello</span> <span class="o">=</span> <span class="s2">"Hello"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">world</span> <span class="o">=</span> <span class="s2">"World!"</span><span class="p">;</span>

<span class="c1">// Semantic whitespace promotes readability.</span>
<span class="c1">// Readable code is good!</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="nx">foo</span><span class="p">();</span>
<span class="c1">// This is much harder to read!</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="nx">foo</span><span class="p">();</span>
</pre></div>

<p><strong>Reserved Words</strong></p>

<p>There are a handful of reserved words that can't be used when declaring user-defined variables and functions. Some of these reserved words are currently implemented, some are saved for future use, and others are reserved for historical reasons. A list of reserved words can be found here, and in-depth explanations for each can be found on the MDN JavaScript Reference site.</p>

<p><strong>Identifiers</strong></p>

<p>Identifiers are used to give variables and functions a unique name so they can subsequently be referred to by that name. The name of an identifier must follow a few rules:</p>

<pre><code>Cannot be a reserved word.
Can only be composed of letters, numbers, dollar signs, and underscores.
The first character cannot be a number.
</code></pre>

<p>It's a best practice to name identifiers in a way that will make sense to you and other developers later on.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Valid identifier names.</span>
<span class="kd">var</span> <span class="nx">myAwesomeVariable</span> <span class="o">=</span> <span class="s2">"a"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">myAwesomeVariable2</span> <span class="o">=</span> <span class="s2">"b"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">my_awesome_variable</span> <span class="o">=</span> <span class="s2">"c"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">$my_AwesomeVariable</span> <span class="o">=</span> <span class="s2">"d"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">_my_awesome_variable_$</span> <span class="o">=</span> <span class="s2">"e"</span><span class="p">;</span>
</pre></div>

<p><strong>Variable Definition</strong></p>

<p>Variables can be defined using multiple var statements, or in a single combined var statement.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// This works:</span>
<span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">test2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
<span class="kd">var</span> <span class="nx">test3</span> <span class="o">=</span> <span class="nx">test2</span><span class="p">(</span> <span class="nx">test</span> <span class="p">);</span>
<span class="c1">// And so does this:</span>
<span class="kd">var</span> <span class="nx">test4</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="nx">test5</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span>
<span class="nx">test6</span> <span class="o">=</span> <span class="nx">test2</span><span class="p">(</span> <span class="nx">test</span> <span class="p">);</span>
</pre></div>

<p>Variables can be declared without assigning them a value. The value of a variable declared without a value is undefined.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">x</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">// true</span>
</pre></div>

<h4>Types</h4>

<p>Types in JavaScript fall into two categories: primitives and objects. Primitive types include:</p>

<ul class="task-list">
<li>String</li>
<li>Number</li>
<li>Boolean</li>
<li>null</li>
<li>undefined</li>
</ul><p><strong>String</strong></p>

<p>Strings are text wrapped in single or double quotation marks. It is best practice to consistently use one or the other. There may be times when the string contains quotation marks that collide with the ones used to create the string. In this case, either escape the characters using a \ backslash or use different quotes around the string.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Strings can be created with double or single quotes.</span>
<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="s2">"I am a string"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="s1">'So am I!'</span><span class="p">;</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">a</span> <span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">b</span> <span class="p">);</span>

<span class="c1">// Sometimes a string may contain quotation marks.</span>
<span class="kd">var</span> <span class="nx">statement1</span> <span class="o">=</span> <span class="s1">'He said "JavaScript is awesome!"'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">statement2</span> <span class="o">=</span> <span class="s2">"He said \"JavaScript is awesome!\""</span><span class="p">;</span>
</pre></div>

<p><strong>Number</strong></p>

<p>Number types are any positive or negative numeric value. There is no distinction between integer and floating point values.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Numbers are any whole or floating point integer.</span>
<span class="kd">var</span> <span class="nx">num1</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">num2</span> <span class="o">=</span> <span class="mf">100.10</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">num3</span> <span class="o">=</span> <span class="mf">0.10</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">statement2</span> <span class="o">=</span> <span class="s2">"He said \"JavaScript is awesome!\""</span><span class="p">;</span>
</pre></div>

<p><strong>Boolean</strong></p>

<p>Boolean types are either true or false.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Boolean values.</span>
<span class="kd">var</span> <span class="nx">okay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">fail</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</pre></div>

<p><strong>null and undefined</strong></p>

<p>null and undefined are special types in JavaScript. Null types are values that represent the absence of a value, similar to many other programming languages. Undefined types represent a state in which no value has been assigned at all. This type is created in two ways: by using the undefined keyword or by not defining a value at all.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Define a null value.</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="c1">// Two ways to achieve an undefined value.</span>
<span class="kd">var</span> <span class="nx">bar1</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bar2</span><span class="p">;</span>
</pre></div>

<p><strong>Objects</strong></p>

<p>Everything else in JavaScript is considered an object. While there are numerous built-in objects, this chapter will cover:</p>

<ul class="task-list">
<li>Object</li>
<li>Array</li>
<li>Function</li>
</ul><p>The simplest way to create an object is either through the Object constructor or the shorthand syntax known as object literal. These simple objects are unordered key/value pairs. The key is formally known as a property and the value can be any valid JavaScript type, even another object. To create or access a property on an object, we use what is known as "dot notation" or "bracket notation."</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Creating an object with the constructor:</span>
<span class="kd">var</span> <span class="nx">person1</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Object</span><span class="p">;</span>
<span class="nx">person1</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="s2">"John"</span><span class="p">;</span>
<span class="nx">person1</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="s2">"Doe"</span><span class="p">;</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">person1</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">person1</span><span class="p">.</span><span class="nx">lastName</span><span class="p">);</span>
<span class="c1">// Creating an object with the object literal syntax:</span>
<span class="kd">var</span> <span class="nx">person2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">firstName</span> <span class="o">:</span> <span class="s2">"Jane"</span><span class="p">,</span>
    <span class="nx">lastName</span> <span class="o">:</span> <span class="s2">"Doe"</span>
<span class="p">};</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">person2</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">person2</span><span class="p">.</span><span class="nx">lastName</span><span class="p">);</span>

<span class="c1">// As mentioned, objects can also have objects as a property.</span>
<span class="kd">var</span> <span class="nx">people</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">people</span><span class="p">[</span><span class="s2">"person1"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">person1</span><span class="p">;</span>
<span class="nx">people</span><span class="p">[</span><span class="s2">"person2"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">person2</span><span class="p">;</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="s2">"person1"</span><span class="p">].</span><span class="nx">firstName</span><span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="s2">"person2"</span><span class="p">].</span><span class="nx">firstName</span><span class="p">);</span>
</pre></div>

<p>If a property is accessed that has not been defined, it will return a type of undefined.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Properties that have not been created are undefined.</span>
<span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">"John Doe"</span> <span class="p">};</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">person</span><span class="p">.</span><span class="nx">email</span> <span class="p">);</span> <span class="c1">// undefined</span>
</pre></div>

<p>Objects contain one or more key-value pairs. The key portion can be any string. The value portion can be any type of value: a number, a string, an array, a function, or even another object. When one of these values is a function, it’s called a method of the object. Otherwise, they are called properties.</p>

<p>As it turns out, nearly everything in JavaScript is an object – arrays, functions, numbers, even strings – and they all have properties and methods.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Creating an object literal.</span>
<span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">sayHello</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"Rebecca"</span>
<span class="p">};</span>
<span class="nx">myObject</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// "hello"</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myObject</span><span class="p">.</span><span class="nx">myName</span><span class="p">);</span> <span class="c1">// "Rebecca"</span>
</pre></div>

<p>When creating object literals, note that the key portion of each key-value pair can be written as any valid JavaScript identifier, a string (wrapped in quotes), or a number:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">validIdentifier</span> <span class="o">:</span> <span class="mi">123</span><span class="p">,</span>
    <span class="s2">"some string"</span> <span class="o">:</span> <span class="mi">456</span><span class="p">,</span>
    <span class="mi">99999</span> <span class="o">:</span> <span class="mi">789</span>
<span class="p">};</span>
</pre></div>

<p><strong>Array</strong></p>

<p>An array is a type of object that is ordered by the index of each item it contains. The index starts at zero and extends to however many items have been added, which is a property of the array known as the .length. Similar to a basic object, an array can be created with the Array constructor or the shorthand syntax known as array literal.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Creating an array with the constructor:</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">;</span>
<span class="c1">// Creating an array with the array literal syntax:</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="p">[];</span>
</pre></div>

<p>There is an important distinction to be made between the two. Both an array constructor and an array literal can contain items to be added to the array upon creating it. However, if just a single numeric item is passed in, the array constructor will assume its length to be that value.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// The array literal returns a foo.length value of 1:</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">100</span> <span class="p">];</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// 100</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span> <span class="c1">// 1</span>
<span class="c1">// The array constructor returns a bar.length value of 100:</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span> <span class="mi">100</span> <span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">bar</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// undefined</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span> <span class="c1">// 100</span>
</pre></div>

<p>An array can be manipulated through methods that are available on the instance of the array. Items in the array can be accessed using bracket notation with a given index. If the index does not exist or contains no value, the return type will be undefined.</p>

<p>A few common array methods are shown below:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using the push(), pop(), unshift() and shift() methods on an array.</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="s2">"a"</span> <span class="p">);</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="s2">"b"</span> <span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// a</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// b</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span> <span class="c1">// 2</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// a</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// undefined</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span> <span class="c1">// 1</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span> <span class="s2">"z"</span> <span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// z</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// a</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span> <span class="c1">// 2</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// a</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// undefined</span>
<span class="nx">alert</span><span class="p">(</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span> <span class="c1">// 1</span>
</pre></div>

<h4>Operators</h4>

<p>Basic operators allow you to manipulate values.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Concatenation</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="s2">"world"</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">foo</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">bar</span> <span class="p">);</span> <span class="c1">// "hello world"</span>

<span class="c1">// Multiplication and division</span>
<span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
<span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// Incrementing and decrementing</span>
<span class="c1">// The pre-increment operator increments the operand before any further processing.</span>
<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="o">++</span><span class="nx">i</span> <span class="p">);</span> <span class="c1">// 2 - because i was incremented before evaluation</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span> <span class="p">);</span> <span class="c1">// 2</span>
<span class="c1">// The post-increment operator increments the operand after processing it.</span>
<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span><span class="o">++</span> <span class="p">);</span> <span class="c1">// 1 - because i was evaluated to 1 and _then_ incremented</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span> <span class="p">);</span> <span class="c1">// 2 - incremented after using it</span>
</pre></div>

<p>**<br>
Operations on Numbers &amp; Strings**</p>

<p>In JavaScript, numbers and strings will occasionally behave in unexpected ways.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Addition vs. Concatenation</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="s2">"2"</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">foo</span> <span class="o">+</span> <span class="nx">bar</span> <span class="p">);</span> <span class="c1">// 12</span>

<span class="c1">// Coercing a string to act as a number.</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="s2">"2"</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">foo</span> <span class="o">+</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="p">);</span> <span class="c1">// 3</span>
</pre></div>

<p>The Number constructor, when called as a function (as in the above example), will have the effect of casting its argument into a number. The unary plus operator also does the same thing:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Forcing a string to act as a number (using the unary plus operator).</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">foo</span> <span class="o">+</span> <span class="o">+</span><span class="nx">bar</span> <span class="p">);</span> <span class="c1">// 3</span>
</pre></div>

<p><strong>Logical Operators</strong></p>

<p>Logical operators allow evaluation of a series of operands using AND (&amp;&amp;) and OR (||) operations.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Logical AND and OR operators</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">baz</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">// returns 1, which is true</span>
<span class="nx">foo</span> <span class="o">||</span> <span class="nx">bar</span><span class="p">;</span>
<span class="c1">// returns 1, which is true</span>
<span class="nx">bar</span> <span class="o">||</span> <span class="nx">foo</span><span class="p">;</span>
<span class="c1">// returns 0, which is false</span>
<span class="nx">foo</span> <span class="o">&amp;&amp;</span> <span class="nx">bar</span><span class="p">;</span>
<span class="c1">// returns 2, which is true</span>
<span class="nx">foo</span> <span class="o">&amp;&amp;</span> <span class="nx">baz</span><span class="p">;</span>
<span class="c1">// returns 1, which is true</span>
<span class="nx">baz</span> <span class="o">&amp;&amp;</span> <span class="nx">foo</span><span class="p">;</span>
</pre></div>

<p>In the above example, the || operator returns the value of the first truthy operand, or in cases where neither operand is truthy, it returns the last operand. The &amp;&amp; operator returns the value of the first false operand, or the value of the last operand if both operands are truthy.</p>

<p>You'll sometimes see developers use these logical operators for flow control instead of using if statements. For example:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Do something with foo if foo is truthy.</span>
<span class="nx">foo</span> <span class="o">&amp;&amp;</span> <span class="nx">doSomething</span><span class="p">(</span> <span class="nx">foo</span> <span class="p">);</span>
<span class="c1">// Set bar to baz if baz is truthy;</span>
<span class="c1">// otherwise, set it to the return value of createBar()</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="nx">baz</span> <span class="o">||</span> <span class="nx">createBar</span><span class="p">();</span>
</pre></div>

<p>This style is quite elegant and pleasantly terse; that said, it can be really hard to read or use, especially for beginners. See the section on truthy and falsy things in the Conditional Code article for more about evaluating truthiness.</p>

<p><strong>Comparison Operators</strong></p>

<p>Comparison operators allow you to test whether values are equivalent or whether values are identical.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Comparison operators</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">baz</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bim</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nx">foo</span> <span class="o">==</span> <span class="nx">bar</span><span class="p">;</span> <span class="c1">// false</span>
<span class="nx">foo</span> <span class="o">!=</span> <span class="nx">bar</span><span class="p">;</span> <span class="c1">// true</span>
<span class="nx">foo</span> <span class="o">==</span> <span class="nx">baz</span><span class="p">;</span> <span class="c1">// true; but note that the types are different</span>
<span class="nx">foo</span> <span class="o">===</span> <span class="nx">baz</span><span class="p">;</span> <span class="c1">// false</span>
<span class="nx">foo</span> <span class="o">!==</span> <span class="nx">baz</span><span class="p">;</span> <span class="c1">// true</span>
<span class="nx">foo</span> <span class="o">===</span> <span class="nb">parseInt</span><span class="p">(</span> <span class="nx">baz</span> <span class="p">);</span> <span class="c1">// true</span>
<span class="nx">foo</span> <span class="o">&gt;</span> <span class="nx">bim</span><span class="p">;</span> <span class="c1">// false</span>
<span class="nx">bim</span> <span class="o">&gt;</span> <span class="nx">baz</span><span class="p">;</span> <span class="c1">// true</span>
<span class="nx">foo</span> <span class="o">&lt;=</span> <span class="nx">baz</span><span class="p">;</span> <span class="c1">// true</span>
</pre></div>

<p><strong>Conditional Code</strong></p>

<p>Sometimes a block of code should only be run under certain conditions. Flow control – via if and else blocks – lets you run code if certain conditions have been met.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Flow control</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This code will never run.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"hello!"</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This code won't run.</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">foo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This code will run.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// This code would run if foo and bar were both false.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>While curly braces aren't strictly required around single-line if statements, using them consistently, even when they aren't strictly required, makes for vastly more readable code.</p>

<p>Be mindful not to define functions with the same name multiple times within separate if/else blocks, as doing so may not have the expected result.</p>

<p><strong>Conditional Code</strong></p>

<p>Sometimes a block of code should only be run under certain conditions. Flow control – via if and else blocks – lets you run code if certain conditions have been met.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Flow control</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This code will never run.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"hello!"</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This code won't run.</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">foo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This code will run.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// This code would run if foo and bar were both false.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>While curly braces aren't strictly required around single-line if statements, using them consistently, even when they aren't strictly required, makes for vastly more readable code.</p>

<p>Be mindful not to define functions with the same name multiple times within separate if/else blocks, as doing so may not have the expected result.</p>

<p><strong>Truthy and Falsy Things</strong></p>

<p>In order to use flow control successfully, it's important to understand which kinds of values are "truthy" and which kinds of values are "falsy." Sometimes, values that seem like they should evaluate one way actually evaluate another.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Values that evaluate to false:</span>
<span class="kc">false</span>
<span class="s2">""</span> <span class="c1">// An empty string.</span>
<span class="kc">NaN</span> <span class="c1">// JavaScript's "not-a-number" variable.</span>
<span class="kc">null</span>
<span class="kc">undefined</span> <span class="c1">// Be careful -- undefined can be redefined!</span>
<span class="mi">0</span> <span class="c1">// The number zero.</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// Everything else evaluates to true, some examples:</span>
<span class="s2">"0"</span>
<span class="s2">"any string"</span>
<span class="p">[]</span> <span class="c1">// An empty array.</span>
<span class="p">{}</span> <span class="c1">// An empty object.</span>
<span class="mi">1</span> <span class="c1">// Any non-zero number.</span>
</pre></div>

<p><strong>Conditional Variable Assignment with the Ternary Operator</strong></p>

<p>Sometimes a variable should be set depending on some condition. An if/else statement works, but in many cases the ternary operator is more convenient. The ternary operator tests a condition; if the condition is true, it returns a certain value, otherwise it returns a different value.</p>

<p>The ternary operator:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Set foo to 1 if bar is true; otherwise, set foo to 0:</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">bar</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>

<p>While the ternary operator can be used without assigning the return value to a variable, this is generally discouraged.</p>

<p><strong>Switch Statements</strong></p>

<p>Rather than using a series of if/else blocks, sometimes it can be useful to use a switch statement instead. switch statements look at the value of a variable or expression, and run different blocks of code depending on the value.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// A switch statement</span>
<span class="k">switch</span> <span class="p">(</span><span class="nx">foo</span><span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="s2">"bar"</span><span class="o">:</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"the value was bar -- yay!"</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="s2">"baz"</span><span class="o">:</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"boo baz :("</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
<span class="k">default</span><span class="o">:</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"everything else is just ok"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Switch statements have somewhat fallen out of favor in JavaScript, because often the same behavior can be accomplished by creating an object that has more potential for reuse or testing. For example:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">stuffToDo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"bar"</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"the value was bar -- yay!"</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="s2">"baz"</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"boo baz :("</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="s2">"default"</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"everything else is just ok"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// Check if the property exists in the object.</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">stuffToDo</span><span class="p">[</span><span class="nx">foo</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// This code won't run.</span>
    <span class="nx">stuffToDo</span><span class="p">[</span><span class="nx">foo</span><span class="p">]();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// This code will run.</span>
    <span class="nx">stuffToDo</span><span class="p">[</span><span class="s2">"default"</span><span class="p">]();</span>
<span class="p">}</span>
</pre></div>

<h4>Loops</h4>

<p>Loops let a block of code run a certain number of times:</p>

<div class="highlight highlight-javascript"><pre><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Logs "try 0", "try 1", ..., "try 4".</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"try "</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>Note that in loops, the variable i is not "scoped" to the loop block even though the keyword var is used before the variable name. Scope is covered in more depth in the Scope section.</p>
</blockquote>

<p><strong>The for Loop</strong></p>

<p>A for loop is made up of four statements and has the following structure:</p>

<div class="highlight highlight-javascript"><pre><span class="k">for</span> <span class="p">([</span><span class="nx">initialization</span><span class="p">];</span> <span class="p">[</span><span class="nx">conditional</span><span class="p">];</span> <span class="p">[</span><span class="nx">iteration</span><span class="p">])</span> <span class="p">{</span>
    <span class="p">[</span><span class="nx">loopBody</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

<p>The initialization statement is executed only once, before the loop starts. It gives you an opportunity to prepare or declare any variables.</p>

<p>The conditional statement is executed before each iteration, and its return value decides whether the loop is to continue. If the conditional statement evaluates to a falsy value, then the loop stops.</p>

<p>The iteration statement is executed at the end of each iteration and gives you an opportunity to change the state of important variables. Typically, this will involve incrementing or decrementing a counter and thus bringing the loop closer to its end.</p>

<p>The loopBody statement is what runs on every iteration. It can contain anything. Typically, there will be multiple statements that need to be executed, and should be wrapped in a block ({...}).</p>

<p>Here's a typical for loop:</p>

<div class="highlight highlight-javascript"><pre><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">limit</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">limit</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This block will be executed 100 times.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Currently at "</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
    <span class="c1">// Note: The last log will be "Currently at 99".</span>
<span class="p">}</span>
</pre></div>

<p><strong>The while loop</strong></p>

<p>A while loop is similar to an if statement, except that its body will keep executing until the condition evaluates to a falsy value.</p>

<div class="highlight highlight-javascript"><pre><span class="k">while</span> <span class="p">([</span><span class="nx">conditional</span><span class="p">])</span> <span class="p">{</span>
    <span class="p">[</span><span class="nx">loopBody</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

<p>Here's a typical while loop:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This block will be executed 100 times.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Currently at "</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
    <span class="nx">i</span><span class="o">++</span><span class="p">;</span> <span class="c1">// Increment i</span>
<span class="p">}</span>
</pre></div>

<p>Notice that the counter is incrementing within the loop's body. It's possible to combine the conditional and incrementer, like so:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This block will be executed 100 times.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Currently at "</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Notice that the counter starts at -1 and uses the prefix incrementer (++i).</p>

<p><strong>The do-while Loop</strong></p>

<p>This is almost exactly the same as the while loop, except for the fact that the loop's body is executed at least once before the condition is tested.</p>

<div class="highlight highlight-javascript"><pre><span class="k">do</span> <span class="p">{</span>
    <span class="p">[</span><span class="nx">loopBody</span><span class="p">]</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">([</span><span class="nx">conditional</span><span class="p">])</span>
</pre></div>

<p>Here's a do-while loop:</p>

<div class="highlight highlight-javascript"><pre><span class="k">do</span> <span class="p">{</span>
    <span class="c1">// Even though the condition evaluates to false</span>
    <span class="c1">// this loop's body will still execute once.</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hi there!"</span><span class="p">);</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</pre></div>

<p>These types of loops are quite rare since only few situations require a loop that blindly executes at least once. Regardless, it's good to be aware of it.</p>

<p><strong>Breaking and Continuing</strong></p>

<p>Usually, a loop's termination will result from the conditional statement not evaluating to a truthy value, but it is possible to stop a loop in its tracks from within the loop's body with the break statement:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Stopping a loop</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">something</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You may also want to continue the loop without executing more of the loop's body. This is done using the continue statement:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Skipping to the next iteration of a loop</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">something</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// The following statement will only be executed</span>
    <span class="c1">// if the conditional "something" has not been met</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"I have been reached"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Reserved Words</h4>

<ul class="task-list">
<li>break</li>
<li>case</li>
<li>catch</li>
<li>class</li>
<li>const</li>
<li>continue</li>
<li>debugger</li>
<li>default</li>
<li>delete</li>
<li>do</li>
<li>else</li>
<li>enum</li>
<li>export</li>
<li>extends</li>
<li>false</li>
<li>finally</li>
<li>for</li>
<li>function</li>
<li>if</li>
<li>implements</li>
<li>import</li>
<li>in</li>
<li>instanceof</li>
<li>interface</li>
<li>let</li>
<li>new</li>
<li>null</li>
<li>package</li>
<li>private</li>
<li>protected</li>
<li>public</li>
<li>return</li>
<li>static</li>
<li>super</li>
<li>switch</li>
<li>this</li>
<li>throw</li>
<li>true</li>
<li>try</li>
<li>typeof</li>
<li>var</li>
<li>void</li>
<li>while</li>
<li>with</li>
<li>yield</li>
</ul><h4>Arrays</h4>

<p>Arrays are zero-indexed, ordered lists of values. They are a handy way to store a set of related items of the same type (such as strings), though in reality, an array can include multiple types of items, including other arrays.</p>

<p>To create an array, either use the object constructor or the literal declaration, by assigning the variable a list of values after the declaration.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// A simple array with constructor.</span>
<span class="kd">var</span> <span class="nx">myArray1</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span> <span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"world"</span> <span class="p">);</span>
<span class="c1">// Literal declaration, the preferred way.</span>
<span class="kd">var</span> <span class="nx">myArray2</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"world"</span> <span class="p">];</span>
</pre></div>

<p>The literal declaration is generally preferred. See the Google Coding Guidelines for more information.</p>

<p>If the values are unknown, it is also possible to declare an empty array, and add elements either through functions or through accessing by index:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Creating empty arrays and adding values</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[];</span>
<span class="c1">// Adds "hello" on index 0</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="s2">"hello"</span> <span class="p">);</span>
<span class="c1">// Adds "world" on index 1</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="s2">"world"</span> <span class="p">);</span>
<span class="c1">// Adds "!" on index 2</span>
<span class="nx">myArray</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="s2">"!"</span><span class="p">;</span>
</pre></div>

<p>.push() is a function that adds an element on the end of the array and expands the array respectively. You also can directly add items by index. Missing indices will be filled with undefined.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Leaving indices</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">myArray</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">;</span>
<span class="nx">myArray</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="s2">"world"</span><span class="p">;</span>
<span class="nx">myArray</span><span class="p">[</span> <span class="mi">3</span> <span class="p">]</span> <span class="o">=</span> <span class="s2">"!"</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">myArray</span> <span class="p">);</span> <span class="c1">// [ "hello", "world", undefined, "!" ];</span>
</pre></div>

<p>If the size of the array is unknown, .push() is far more safe. You can both access and assign values to array items with the index.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Accessing array items by index</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="s2">"!"</span> <span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">myArray</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="p">);</span> <span class="c1">// "!"</span>
</pre></div>

<p><strong>Array Methods and Properties</strong></p>

<p><strong>.length</strong></p>

<p>The .length property is used to determine the amount of items in an array.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Length of an array</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="s2">"!"</span> <span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span> <span class="c1">// 3</span>
</pre></div>

<p>You will need the .length property for looping through an array:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// For loops and arrays - a classic</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="s2">"!"</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p><strong>.concat()</strong></p>

<p>Concatenate two or more arrays with .concat():</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">];</span>
<span class="kd">var</span> <span class="nx">myOtherArray</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span> <span class="p">];</span>
<span class="kd">var</span> <span class="nx">wholeArray</span> <span class="o">=</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span> <span class="nx">myOtherArray</span> <span class="p">);</span> <span class="c1">// [ 2, 3, 4, 5, 6, 7 ]</span>
</pre></div>

<p><strong>.join()</strong></p>

<p>.join() creates a string representation of an array by joining all of its elements using a separator string. If no separator is supplied (i.e., .join() is called without arguments) the array will be joined using a comma.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Joining elements</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="s2">"!"</span> <span class="p">];</span>
<span class="c1">// The default separator is a comma.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">join</span><span class="p">()</span> <span class="p">);</span> <span class="c1">// "hello,world,!"</span>
<span class="c1">// Any string can be used as separator...</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="s2">" "</span> <span class="p">)</span> <span class="p">);</span> <span class="c1">// "hello world !";</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="s2">"!!"</span> <span class="p">)</span> <span class="p">);</span> <span class="c1">// "hello!!world!!!";</span>
<span class="c1">// ...including an empty one.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="s2">""</span> <span class="p">)</span> <span class="p">);</span> <span class="c1">// "helloworld!"</span>
</pre></div>

<p><strong>.pop()</strong></p>

<p>.pop() removes the last element of an array. It is the opposite method of .push():</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Pushing and popping</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span> <span class="c1">// [ 0 ]</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="mi">2</span> <span class="p">);</span> <span class="c1">// [ 0 , 2 ]</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="mi">7</span> <span class="p">);</span> <span class="c1">// [ 0 , 2 , 7 ]</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span> <span class="c1">// [ 0 , 2 ]</span>
</pre></div>

<p><strong>.reverse()</strong></p>

<p>As the name suggests, the elements of the array are in reverse order after calling this method:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"world"</span> <span class="p">,</span> <span class="s2">"hello"</span> <span class="p">];</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">reverse</span><span class="p">();</span> <span class="c1">// [ "hello", "world" ]</span>
</pre></div>

<p><strong>.shift()</strong></p>

<p>Removes the first element of an array. With .push() and .shift(), you can recreate the method of a queue:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Queue with shift() and push()</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span> <span class="c1">// [ 0 ]</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="mi">2</span> <span class="p">);</span> <span class="c1">// [ 0 , 2 ]</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="mi">7</span> <span class="p">);</span> <span class="c1">// [ 0 , 2 , 7 ]</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span> <span class="c1">// [ 2 , 7 ]</span>
</pre></div>

<p><strong>.slice()</strong></p>

<p>Extracts a part of the array and returns that part in a new array. This method takes one parameter, which is the starting index:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Slicing</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span> <span class="p">];</span>
<span class="kd">var</span> <span class="nx">newArray</span> <span class="o">=</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span> <span class="mi">3</span> <span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">myArray</span> <span class="p">);</span> <span class="c1">// [ 1, 2, 3, 4, 5, 6, 7, 8 ]</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">newArray</span> <span class="p">);</span> <span class="c1">// [ 4, 5, 6, 7, 8 ]</span>
</pre></div>

<p><strong>.splice()</strong></p>

<p>Removes a certain amount of elements and adds new ones at the given index. It takes at least three parameters:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">myArray</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="p">...</span> <span class="p">);</span>
</pre></div>

<ul class="task-list">
<li>Index – The starting index.</li>
<li>Length – The number of elements to remove.</li>
<li>Values – The values to be inserted at the index position.</li>
</ul><p>For example:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span> <span class="p">];</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">myArray</span> <span class="p">);</span> <span class="c1">// [ 0, 1, 2, 3, 4, 5 ]</span>
</pre></div>

<p><strong>.sort()</strong></p>

<p>Sorts an array. It takes one parameter, which is a comparing function. If this function is not given, the array is sorted ascending:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Sorting without comparing function.</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span> <span class="p">];</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span> <span class="c1">// 1, 3, 4, 6</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// Sorting with comparing function.</span>
<span class="kd">function</span> <span class="nx">descending</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">b</span> <span class="o">-</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">descending</span><span class="p">);</span> <span class="c1">// [ 6, 4, 3, 1 ]</span>
</pre></div>

<p>The return value of descending (for this example) is important. If the return value is less than zero, the index of a is before b, and if it is greater than zero it's vice-versa. If the return value is zero, the elements' index is equal.</p>

<p><strong>.unshift()</strong></p>

<p>Inserts an element at the first position of the array:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span> <span class="c1">// [ 0 ]</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span> <span class="mi">2</span> <span class="p">);</span> <span class="c1">// [ 2 , 0 ]</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span> <span class="mi">7</span> <span class="p">);</span> <span class="c1">// [ 7 , 2 , 0 ]</span>
</pre></div>

<p><strong>.forEach()</strong></p>

<p>In modern browsers it is possible to traverse through arrays with a .forEach() method, where you pass a function that is called for each element in the array.</p>

<p>The function takes up to three arguments:</p>

<ul class="task-list">
<li>Element – The element itself.</li>
<li>Index – The index of this element in the array.</li>
<li>Array – The array itself.</li>
</ul><p>All of these are optional, but you will need at least the Element parameter in most cases.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Native .forEach()</span>
<span class="kd">function</span> <span class="nx">printElement</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">)</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">printElementAndIndex</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">index</span> <span class="p">)</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">"Index "</span> <span class="o">+</span> <span class="nx">index</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="nx">elem</span> <span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">negateElement</span><span class="p">(</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">array</span> <span class="p">)</span> <span class="p">{</span>
<span class="nx">array</span><span class="p">[</span> <span class="nx">index</span> <span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="nx">elem</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">];</span>
<span class="c1">// Prints all elements to the console</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="nx">printElement</span> <span class="p">);</span>
<span class="c1">// Prints "Index 0: 1", "Index 1: 2", "Index 2: 3", ...</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="nx">printElementAndIndex</span> <span class="p">);</span>
<span class="c1">// myArray is now [ -1, -2, -3, -4, -5 ]</span>
<span class="nx">myArray</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="nx">negateElement</span> <span class="p">);</span>
</pre></div>

<h4>Functions</h4>

<p>Functions contain blocks of code that need to be executed repeatedly. Functions can take zero or more arguments, and can optionally return a value.</p>

<p>Functions can be created in a variety of ways, two of which are shown below:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Function declaration.</span>
<span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// Do something.</span>
<span class="p">}</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// Named function expression.</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// Do something.</span>
<span class="p">};</span>
</pre></div>

<p><strong>Using Functions</strong></p>

<div class="highlight highlight-javascript"><pre><span class="c1">// A simple function.</span>
<span class="kd">var</span> <span class="nx">greet</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="nx">greeting</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">greeting</span> <span class="o">+</span> <span class="s2">", "</span> <span class="o">+</span> <span class="nx">person</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">greet</span><span class="p">(</span><span class="s2">"Rebecca"</span><span class="p">,</span> <span class="s2">"Hello"</span><span class="p">);</span> <span class="c1">// "Hello, Rebecca"</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// A function that returns a value.</span>
<span class="kd">var</span> <span class="nx">greet</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="nx">greeting</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">greeting</span> <span class="o">+</span> <span class="s2">", "</span> <span class="o">+</span> <span class="nx">person</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">text</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">greet</span><span class="p">(</span><span class="s2">"Rebecca"</span><span class="p">,</span> <span class="s2">"Hello"</span><span class="p">));</span> <span class="c1">// "Hello, Rebecca"</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// A function that returns another function.</span>
<span class="kd">var</span> <span class="nx">greet</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="nx">greeting</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">greeting</span> <span class="o">+</span> <span class="s2">", "</span> <span class="o">+</span> <span class="nx">person</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="nx">greet</span><span class="p">(</span><span class="s2">"Rebecca"</span><span class="p">,</span> <span class="s2">"Hello"</span><span class="p">);</span>
<span class="nx">greeting</span><span class="p">();</span> <span class="c1">// "Hello, Rebecca"</span>
</pre></div>

<p><strong>Immediately-Invoked Function Expression (IIFE)</strong></p>

<p>A common pattern in JavaScript is the immediately-invoked function expression. This pattern creates a function expression and then immediately executes the function. This pattern is extremely useful for cases where you want to avoid polluting the global namespace with code – no variables declared inside of the function are visible outside of it.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// An immediately-invoked function expression.</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s2">"Hello world"</span><span class="p">;</span>
<span class="p">})();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// undefined!</span>
</pre></div>

<p><strong>Functions as Arguments</strong></p>

<p>In JavaScript, functions are "first-class citizens" – they can be assigned to variables or passed to other functions as arguments. Passing functions as arguments is an extremely common idiom in jQuery.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Passing an anonymous function as an argument.</span>
<span class="kd">var</span> <span class="nx">myFn</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">};</span>
<span class="c1">// Logs "hello world"</span>
<span class="nx">myFn</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">"hello world"</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// Passing a named function as an argument</span>
<span class="kd">var</span> <span class="nx">myFn</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">myOtherFn</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">"hello world"</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">myFn</span><span class="p">(</span><span class="nx">myOtherFn</span><span class="p">);</span> <span class="c1">// "hello world"</span>
</pre></div>

<h4>Testing Type</h4>

<p>JavaScript offers a way to test the type of a variable. However, the result can be confusing – for example, the type of an array is "Object."</p>

<p>It's common practice to use the typeof operator when trying to determining the type of a specific value.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Testing the type of various variables.</span>
<span class="kd">var</span> <span class="nx">myFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">"hello"</span> <span class="p">);</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="p">{</span>
<span class="nx">foo</span><span class="o">:</span> <span class="s2">"bar"</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span> <span class="p">];</span>
<span class="kd">var</span> <span class="nx">myString</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">myNumber</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">myRegExp</span> <span class="o">=</span> <span class="sr">/(\w+)\s(\w+)/</span><span class="p">;</span>
<span class="k">typeof</span> <span class="nx">myFunction</span><span class="p">;</span> <span class="c1">// "function"</span>
<span class="k">typeof</span> <span class="nx">myObject</span><span class="p">;</span> <span class="c1">// "object"</span>
<span class="k">typeof</span> <span class="nx">myArray</span><span class="p">;</span> <span class="c1">// "object" -- Careful!</span>
<span class="k">typeof</span> <span class="nx">myString</span><span class="p">;</span> <span class="c1">// "string"</span>
<span class="k">typeof</span> <span class="nx">myNumber</span><span class="p">;</span> <span class="c1">// "number"</span>
<span class="k">typeof</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// "object" -- Careful!</span>
<span class="k">typeof</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">// "undefined"</span>
<span class="k">typeof</span> <span class="nx">meh</span><span class="p">;</span> <span class="c1">// "undefined" -- undefined variable.</span>
<span class="k">typeof</span> <span class="nx">myRegExp</span><span class="p">;</span> <span class="c1">// "function" or "object" depending on environment.</span>
<span class="k">if</span> <span class="p">(</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">push</span> <span class="o">&amp;&amp;</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">slice</span> <span class="o">&amp;&amp;</span> <span class="nx">myArray</span><span class="p">.</span><span class="nx">join</span> <span class="p">)</span> <span class="p">{</span>
<span class="c1">// probably an array (this is called "duck typing")</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">myArray</span> <span class="p">)</span> <span class="o">===</span> <span class="s2">"[object Array]"</span> <span class="p">)</span> <span class="p">{</span>
<span class="c1">// Definitely an array!</span>
<span class="c1">// This is widely considered as the most robust way</span>
<span class="c1">// to determine if a specific value is an Array.</span>
<span class="p">}</span>
</pre></div>

<h4>The "this" keyword</h4>

<p>In JavaScript, as in most object-oriented programming languages, this is a special keyword that is used in methods to refer to the object on which a method is being invoked. The value of this is determined using a simple series of steps:</p>

<ol class="task-list">
<li><p>If the function is invoked using Function.call() or Function.apply(), this will be set to the first argument passed to .call()/.apply(). If the first argument passed to .call()/.apply() is null or undefined, this will refer to the global object (which is the window object in web browsers).</p></li>
<li><p>If the function being invoked was created using Function.bind(), this will be the first argument that was passed to .bind() at the time the function was created.</p></li>
<li><p>If the function is being invoked as a method of an object, this will refer to that object.</p></li>
<li><p>Otherwise, the function is being invoked as a standalone function not attached to any object, and this will refer to the global object.</p></li>
</ol><div class="highlight highlight-javascript"><pre><span class="c1">// A function invoked using Function.call()</span>
<span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">sayHello</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hi! My name is "</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">myName</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"Rebecca"</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">secondObject</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"Colin"</span>
<span class="p">};</span>
<span class="nx">myObject</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// "Hi! My name is Rebecca"</span>
<span class="nx">myObject</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">secondObject</span><span class="p">);</span> <span class="c1">// "Hi! My name is Colin"</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// A function created using Function.bind()</span>
<span class="kd">var</span> <span class="nx">myName</span> <span class="o">=</span> <span class="s2">"the global object"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">sayHello</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hi! My name is "</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">myName</span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"Rebecca"</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">myObjectHello</span> <span class="o">=</span> <span class="nx">sayHello</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">myObject</span><span class="p">);</span>
<span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// "Hi! My name is the global object"</span>
<span class="nx">myObjectHello</span><span class="p">();</span> <span class="c1">// "Hi! My name is Rebecca"</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// A function being attached to an object at runtime.</span>
<span class="kd">var</span> <span class="nx">myName</span> <span class="o">=</span> <span class="s2">"the global object"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">sayHello</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hi! My name is "</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">myName</span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"Rebecca"</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">secondObject</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"Colin"</span>
<span class="p">};</span>
<span class="nx">myObject</span><span class="p">.</span><span class="nx">sayHello</span> <span class="o">=</span> <span class="nx">sayHello</span><span class="p">;</span>
<span class="nx">secondObject</span><span class="p">.</span><span class="nx">sayHello</span> <span class="o">=</span> <span class="nx">sayHello</span><span class="p">;</span>
<span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// "Hi! My name is the global object"</span>
<span class="nx">myObject</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// "Hi! My name is Rebecca"</span>
<span class="nx">secondObject</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// "Hi! My name is Colin"</span>
</pre></div>

<p>When invoking a function deep within a long namespace, it is often tempting to reduce the amount of code you need to type by storing a reference to the actual function as a single, shorter variable. It is important not to do this with instance methods as this will cause the value of this within the function to change, leading to incorrect code operation. For instance:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">myNamespace</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">myObject</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">sayHello</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hi! My name is "</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">myName</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"Rebecca"</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">hello</span> <span class="o">=</span> <span class="nx">myNamespace</span><span class="p">.</span><span class="nx">myObject</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">;</span>
<span class="nx">hello</span><span class="p">();</span> <span class="c1">// "Hi! My name is undefined"</span>
</pre></div>

<p>You can, however, safely reduce everything up to the object on which the method is invoked:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">myNamespace</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">myObject</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">sayHello</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hi! My name is "</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">myName</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"Rebecca"</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">myNamespace</span><span class="p">.</span><span class="nx">myObject</span><span class="p">;</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// "Hi! My name is Rebecca"</span>
</pre></div>

<h4>Scope</h4>

<p>"Scope" refers to the variables that are available to a piece of code at a given time. A lack of understanding of scope can lead to frustrating debugging experiences. The idea of scope is that it's where certain functions or variables are accessible from in our code, and the context in which they exist and are executed in.</p>

<p>There are two types of scopes in JavaScript: global and local. Let's talk about each of them in turn.</p>

<p><strong>Global Scope</strong></p>

<p>The first scope is Global Scope. This is very easy to define. If a variable or function is global, it can be accessed from anywhere within a program. In a browser, the global scope is the window object. If a variable declaration occurs outside of a function, then that variable exists on the global object. For example:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
</pre></div>

<p>Once that variable had been defined, it could be referenced as window.x, but because it exists on the global object we can simply refer to it as x.</p>

<p><strong>Local Scope</strong></p>

<p>JavaScript also creates a Local Scope inside each function body. For example:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">myFunc</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// ReferenceError: x is not defined</span>
</pre></div>

<p>Since x was initialized within .myFunc(), it is only accessible within .myFunc(), and we get a reference error if we try to access it outside of .myFunc().</p>

<p><strong>A Word of Caution</strong></p>

<p>If you declare a variable and forget to use the var keyword, that variable is automatically made global. So this code would work:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">myFunc</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 5</span>
</pre></div>

<p>This is a bad idea. Any variable that is global can have its value changed by any other parts of a program or any other script. This is undesirable, as it could lead to unforseen side effects.</p>

<p>Secondly, Immediately-Invoked Function Expressions provide a way to avoid global variables. You'll see many libraries such as jQuery often use these:</p>

<div class="highlight highlight-javascript"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">jQuery</span> <span class="o">=</span> <span class="p">{</span>
        <span class="cm">/* All my methods go here. */</span>
    <span class="p">};</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">;</span>
<span class="p">})();</span>
</pre></div>

<p>Wrapping everything in a function which is then immediately invoked means all the variables within that function are bound to the local scope. At the very end you can then expose all your methods by binding the jQuery object to the window, the global object. To read more about Immediately-Invoked Functions, check out <a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">Ben Alman's Immediately-Invoked Function Expression</a> article.</p>

<p>Because local scope works through functions, any functions defined within another have access to variables defined in the outer function:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">outer</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">inner</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">inner</span><span class="p">();</span> <span class="c1">// 5</span>
<span class="p">}</span>
</pre></div>

<p>But the .outer() function doesn't have access to any variables declared within .inner():</p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">outer</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">inner</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">inner</span><span class="p">();</span> <span class="c1">// 5</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// ReferenceError: y is not defined</span>
<span class="p">}</span>
</pre></div>

<p>Furthermore, variables that are declared inside a function without the var keyword are not local to the function – JavaScript will traverse the scope chain all the way up to the window scope to find where the variable was previously defined. If the variable wasn't previously defined, it will be defined in the global scope, which can have unexpected consequences.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Functions have access to variables defined in the same scope.</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">sayHello</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// "hello"</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// "hello"</span>
</pre></div>

<p>Variables with the same name can exist in different scopes with different values:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s2">"world"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">sayHello</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// "hello"</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// "world"</span>
</pre></div>

<p>When, within a function, you reference a variable defined in an outer scope, that function can see changes to the variable's value after the function is defined.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">myFunction</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">myFn</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">foo</span> <span class="o">=</span> <span class="s2">"world"</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">myFn</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">myFunction</span><span class="p">();</span>
<span class="nx">f</span><span class="p">();</span> <span class="c1">// "world"</span>
</pre></div>

<p>Here's a more complex example of scopes at play:</p>

<div class="highlight highlight-javascript"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">baz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">bim</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">baz</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">baz</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">})();</span>
</pre></div>

<p>In this instance, running:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">baz</span> <span class="p">);</span> <span class="c1">// baz is not defined outside of the function</span>
</pre></div>

<p>Gives us a ReferenceError. baz was only defined within the function, and was never exposed to the global scope.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">bar</span><span class="p">();</span> <span class="c1">//  1</span>
</pre></div>

<p>.bar() may have been defined within the anonymous function, but it was defined without the var keyword, which means it wasn't bound to the local scope and was instead created globally. Furthermore, it has access to the baz variable because .bar() was defined within the same scope as baz. This means it has access to it, even though other code outside of the function does not.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">bim</span><span class="p">();</span> <span class="c1">// ReferenceError: bim is not defined</span>
</pre></div>

<p>.bim() was only defined within the function, so it does not exist on the global object as it was defined locally.</p>

<p><strong>Closures</strong></p>

<p>Closures are an extension of the concept of scope. With closures, functions have access to variables that were available in the scope where the function was created. If that seems confusing, don’t worry: closures are generally best understood by example.</p>

<p>As shown in the Scope section, functions have access to changing variable values. The same sort of behavior exists with functions defined within loops – the function "sees" the change in the variable's value even after the function is defined, resulting in each function referencing the last value stored in the variable.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Each function executed within the loop will reference</span>
<span class="c1">// the last value stored in i (5).</span>
<span class="c1">// This won't behave as we want it to - every 100 milliseconds, 5 will alert</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">},</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Closures can be used to prevent this by creating a unique scope for each iteration – storing each unique value of the variable within its scope.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using a closure to create a new private scope</span>
<span class="c1">// fix: “close” the value of i inside createFunction, so it won't change</span>
<span class="kd">var</span> <span class="nx">createFunction</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">};</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">createFunction</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Closures can also be used to resolve issues with the this keyword, which is unique to each scope:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using a closure to access inner and outer object instances simultaneously.</span>
<span class="kd">var</span> <span class="nx">outerObj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"outer"</span><span class="p">,</span>
    <span class="nx">outerFunction</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Provide a reference to outerObj through innerFunction's closure</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">innerObj</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">myName</span> <span class="o">:</span> <span class="s2">"inner"</span><span class="p">,</span>
            <span class="nx">innerFunction</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">myName</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">myName</span><span class="p">);</span> <span class="c1">// "outer inner"</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nx">innerObj</span><span class="p">.</span><span class="nx">innerFunction</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">myName</span><span class="p">);</span> <span class="c1">// "outer"</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="nx">outerObj</span><span class="p">.</span><span class="nx">outerFunction</span><span class="p">();</span>
</pre></div>

<p><strong>Function.bind</strong></p>

<p>Closures can be particularly useful when dealing with callbacks. However, it is often better to use Function.bind, which will avoid any overhead associated with scope traversal.</p>

<p>Function.bind is used to create a new function. When called, the new function then calls itself in the context of the supplied this value, using a given set of arguments that will precede any arguments provided when the new function was initially called.</p>

<p>As .bind() is a recent addition to ECMAScript 5, it may not be present in all browsers, which is something to be wary of when deciding whether to use it. However, it's possible to work around support by using this shim from MDN:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Shim from MDN</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">oThis</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span> <span class="o">!==</span> <span class="s2">"function"</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// closest thing possible to the ECMAScript 5 internal</span>
            <span class="c1">// IsCallable function</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">"Function.prototype.bind - what is trying to be bound is not callable"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">fSlice</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">,</span>
        <span class="nx">aArgs</span> <span class="o">=</span> <span class="nx">fSlice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="nx">fToBind</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">fNOP</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span>
        <span class="nx">fBound</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fToBind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">fNOP</span>
                 <span class="o">?</span> <span class="k">this</span>
                 <span class="o">:</span> <span class="nx">oThis</span> <span class="o">||</span> <span class="nb">window</span><span class="p">,</span>
                <span class="nx">aArgs</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">fSlice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
        <span class="p">};</span>
        <span class="nx">fNOP</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
        <span class="nx">fBound</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">fNOP</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">fBound</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>

<p>One of the simplest uses of .bind() is making a function that is called with a particular value for this, regardless of how it's called. A common mistake developers make is attempting to extract a method from an object, then later calling that method and expecting it to the use the origin object as its this. However, this can be solved by creating a bound function using the original object as demonstrated below:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Let's manipulate "this" with a basic example.</span>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="s2">"johnsmith"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getUser</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">user</span> <span class="o">:</span> <span class="s2">"janedoe"</span>
<span class="p">};</span>
<span class="c1">// module.getUser() is called where "module" is "this"</span>
<span class="c1">// and "module.user" is returned.</span>
<span class="c1">// janedoe</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">getUser</span><span class="p">();</span>
<span class="c1">// let's now store a reference in the global version of "this"</span>
<span class="kd">var</span> <span class="nx">getUser</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">getUser</span><span class="p">;</span>
<span class="c1">// getUser() called, "this" is global, "user" is returned</span>
<span class="c1">// johnsmith</span>
<span class="nx">getUser</span><span class="p">();</span>
<span class="c1">// store a ref with "module" bound as "this"</span>
<span class="kd">var</span> <span class="nx">boundGetUser</span> <span class="o">=</span> <span class="nx">getUser</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
<span class="c1">// boundGetUser() called, "module" is "this" again, "module.user" returned.</span>
<span class="c1">// janedoe</span>
<span class="nx">boundGetUser</span><span class="p">();</span>
</pre></div>

<a name="jquery"><h3>Learn jQuery</h3></a>

<p><a href="https://camo.githubusercontent.com/ac5c404b490fd91836a5119ba1399d1af0c8acbb/687474703a2f2f692e696d6775722e636f6d2f694e6e784f64632e706e67" target="_blank"><img src="https://camo.githubusercontent.com/ac5c404b490fd91836a5119ba1399d1af0c8acbb/687474703a2f2f692e696d6775722e636f6d2f694e6e784f64632e706e67" alt="" data-canonical-src="http://i.imgur.com/iNnxOdc.png" style="max-width:100%;"></a></p>

<p>This chapter is courtesy of The jQuery Foundation:</p>

<h4>How jQuery Works</h4>

<p>This is a basic tutorial, designed to help you get started using jQuery. If you don't have a test page setup yet, start by creating the following HTML page:</p>

<div class="highlight highlight-html"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Demo<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://jquery.com/"</span><span class="nt">&gt;</span>jQuery<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="c1">// Your code goes here.</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p>The src attribute in the script element must point to a copy of jQuery. Download a copy of jQuery from <a href="http://jquery.com/download/">http://jquery.com/download/</a> or from Google CDN (<a href="https://developers.google.com/speed/libraries/">https://developers.google.com/speed/libraries/</a>) and store the jquery.js file in the same directory as your HTML file.</p>

<p><strong>Launching Code on Document Ready</strong></p>

<p>To ensure that their code runs after the browser finishes loading the document, many JavaScript programmers wrap their code in an onload function:</p>

<div class="highlight highlight-javascript"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"welcome"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Unfortunately, the code doesn't run until all images are finished downloading, including banner ads. To run code as soon as the document is ready to be manipulated, jQuery has a statement known as the ready event:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="nb">document</span> <span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// Your code here.</span>
<span class="p">});</span>
</pre></div>

<p>For example, inside the ready event, you can add a click handler to the link:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"Thanks for visiting!"</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>Save your HTML file and reload the test page in your browser. Clicking the link should now first display an alert pop-up, then continue with the default behavior of navigating to <a href="http://jquery.com">http://jquery.com</a>.</p>

<p>For click and most other events, you can prevent the default behavior by calling event.preventDefault() in the event handler:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"As you can see, the link no longer took you to jquery.com"</span><span class="p">);</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><strong>Complete Example</strong></p>

<p>The following example illustrates the click handling code discussed above, embedded directly in the HTML body. </p>

<blockquote>
<p>Note that in practice, it is usually better to place your code in a separate JS file and load it on the page with a script element's src attribute.</p>
</blockquote>

<div class="highlight highlight-html"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Demo<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://jquery.com/"</span><span class="nt">&gt;</span>jQuery<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"The link will no longer take you to jquery.com"</span><span class="p">);</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p><strong>Adding and Removing an HTML Class</strong></p>

<p>Important: You must place the remaining jQuery examples inside the ready event so that your code executes when the document is ready to be worked on.</p>

<p>Another common task is adding or removing a class.</p>

<p>First, add some style information into the head of the document, like this:</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;style&gt;</span>
<span class="nt">a</span><span class="nc">.test</span> <span class="p">{</span>
<span class="k">font-weight</span><span class="o">:</span> <span class="k">bold</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
</pre></div>

<p>Next, add the .addClass() call to the script:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"a"</span> <span class="p">).</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">"test"</span> <span class="p">);</span>
</pre></div>

<p>All "a" elements are now bold.</p>

<p>To remove an existing class, use .removeClass():</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"a"</span> <span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s2">"test"</span> <span class="p">);</span>
</pre></div>

<p><strong>Special Effects</strong></p>

<p>jQuery also provides some handy effects to help you make your web sites stand out. For example, if you create a click handler of:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hide</span><span class="p">(</span><span class="s2">"slow"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Then the link slowly disappears when clicked.</p>

<p><strong>Callbacks and Functions</strong></p>

<p>Unlike many other programming languages, JavaScript enables you to freely pass functions around to be executed at a later time. A callback is a function that is passed as an argument to another function and is executed after its parent function has completed. Callbacks are special because they patiently wait to execute until their parent finishes. Meanwhile, the browser can be executing other functions or doing all sorts of other work.</p>

<p>To use callbacks, it is important to know how to pass them into their parent function.</p>

<p>Callback without Arguments</p>

<p>If a callback has no arguments, you can pass it in like this:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s2">"myhtmlpage.html"</span><span class="p">,</span> <span class="nx">myCallBack</span> <span class="p">);</span>
</pre></div>

<p>When $.get() finishes getting the page myhtmlpage.html, it executes the myCallBack() function.</p>

<blockquote>
<p>Note: The second parameter here is simply the function name (but not as a string, and without parentheses).</p>
</blockquote>

<p>Callback with Arguments</p>

<p>Executing callbacks with arguments can be tricky.</p>

<p><em>Wrong</em></p>

<p>This code example will not work:</p>

<pre><code>$.get( "myhtmlpage.html", myCallBack( param1, param2 ) );
</code></pre>

<p>The reason this fails is that the code executes myCallBack( param1, param2 ) immediately and then passes myCallBack()'s return value as the second parameter to $.get(). We actually want to pass the function myCallBack(), not myCallBack( param1, param2 )'s return value (which might or might not be a function). So, how to pass in myCallBack() and include its arguments?</p>

<p><em>Right</em></p>

<p>To defer executing myCallBack() with its parameters, you can use an anonymous function as a wrapper. </p>

<blockquote>
<p>Note the use of function() {. The anonymous function does exactly one thing: calls myCallBack(), with the values of param1 and param2.</p>
</blockquote>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"myhtmlpage.html"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">myCallBack</span><span class="p">(</span><span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>When $.get() finishes getting the page myhtmlpage.html, it executes the anonymous function, which executes myCallBack( param1, param2 ).</p>

<h4>$ vs $()</h4>

<p>Until now, we've been dealing entirely with methods that are called on a jQuery object. For example:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"h1"</span> <span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
</pre></div>

<p>Most jQuery methods are called on jQuery objects as shown above; these methods are said to be part of the $.fn namespace, or the "jQuery prototype," and are best thought of as jQuery object methods.</p>

<p>However, there are several methods that do not act on a selection; these methods are said to be part of the jQuery namespace, and are best thought of as core jQuery methods.</p>

<p>This distinction can be incredibly confusing to new jQuery users. Here's what you need to remember:</p>

<ul class="task-list">
<li><p>Methods called on jQuery selections are in the $.fn namespace, and automatically receive and return the selection as this.</p></li>
<li><p>Methods in the $ namespace are generally utility-type methods, and do not work with selections; they are not automatically passed any arguments, and their return value will vary.</p></li>
</ul><p>There are a few cases where object methods and core methods have the same names, such as $.each() and .each(). In these cases, be extremely careful when reading the documentation that you are exploring the correct method.</p>

<p>In this guide, if a method can be called on a jQuery selection, we'll refer to it just by its name: .each(). If it is a utility method -- that is, a method that isn't called on a selection -- we'll refer to it explicitly as a method in the jQuery namespace: $.each().</p>

<h4>$( document ).ready()</h4>

<p>A page can't be manipulated safely until the document is "ready." jQuery detects this state of readiness for you. Code included inside $( document ).ready() will only run once the page Document Object Model (DOM) is ready for JavaScript code to execute. Code included inside $( window ).load(function() { ... }) will run once the entire page (images or iframes), not just the DOM, is ready.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// A $( document ).ready() block.</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"ready!"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Experienced developers sometimes use shorthand for $( document ).ready(). If you are writing code that people who aren't experienced with jQuery may see, it's best to use the long form.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Shorthand for $( document ).ready()</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"ready!"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You can also pass a named function to $( document ).ready() instead of passing an anonymous function.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Passing a named function instead of an anonymous function.</span>
<span class="kd">function</span> <span class="nx">readyFn</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Code to run when the document is ready.</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="nx">readyFn</span><span class="p">);</span>
<span class="c1">// or:</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span><span class="nx">readyFn</span><span class="p">);</span>
</pre></div>

<p>The below example shows $( document ).ready() and $( window ).load() in action. The code tries to load a website URL in an iframe and checks for both events:</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://code.jquery.com/jquery-1.9.1.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"document loaded"</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"window loaded"</span><span class="p">);</span>
<span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">"http://techcrunch.com"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<h4>Avoiding Conflicts with Other Libraries</h4>

<p>The jQuery library and virtually all of its plugins are contained within the jQuery namespace. As a general rule, global objects are stored inside the jQuery namespace as well, so you shouldn't get a clash between jQuery and any other library (like prototype.js, MooTools, or YUI).</p>

<p>That said, there is one caveat: by default, jQuery uses $ as a shortcut for jQuery. Thus, if you are using another JavaScript library that uses the $ variable, you can run into conflicts with jQuery. In order to avoid these conflicts, you need to put jQuery in no-conflict mode immediately after it is loaded onto the page and before you attempt to use jQuery in your page.</p>

<p><strong>Putting jQuery Into No-Conflict Mode</strong></p>

<p>When you put jQuery into no-conflict mode, you have the option of assigning a new variable name to replace the $ alias.</p>

<div class="highlight highlight-javascript"><pre><span class="c">&lt;!--</span> <span class="nx">Putting</span> <span class="nx">jQuery</span> <span class="nx">into</span> <span class="nx">no</span><span class="o">-</span><span class="nx">conflict</span> <span class="nx">mode</span><span class="p">.</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"prototype.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"jquery.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="kd">var</span> <span class="nx">$j</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">noConflict</span><span class="p">();</span>
<span class="c1">// $j is now an alias to the jQuery function; creating the new alias is optional.</span>
<span class="nx">$j</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$j</span><span class="p">(</span><span class="s2">"div"</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">});</span>
<span class="c1">// The $ variable now has the prototype meaning, which is a shortcut for</span>
<span class="c1">// document.getElementById(). mainDiv below is a DOM element, not a jQuery object.</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mainDiv</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"main"</span><span class="p">);</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p>In the code above, the $ will revert back to its meaning in original library. You'll still be able to use the full function name jQuery as well as the new alias $j in the rest of your application. The new alias can be named anything you'd like: jq, $J, awesomeQuery, etc.</p>

<p>Finally, if you don't want to define another alternative to the full jQuery function name (you really like to use $ and don't care about using the other library's $ method), then there's still another approach you might try: simply add the $ as an argument passed to your jQuery( document ).ready() function. This is most frequently used in the case where you still want the benefits of really concise jQuery code, but don't want to cause conflicts with other libraries.</p>

<div class="highlight highlight-javascript"><pre><span class="c">&lt;!--</span> <span class="nx">Another</span> <span class="nx">way</span> <span class="nx">to</span> <span class="nx">put</span> <span class="nx">jQuery</span> <span class="nx">into</span> <span class="nx">no</span><span class="o">-</span><span class="nx">conflict</span> <span class="nx">mode</span><span class="p">.</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"prototype.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"jquery.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="nx">jQuery</span><span class="p">.</span><span class="nx">noConflict</span><span class="p">();</span>
<span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// You can use the locally-scoped $ in here as an alias to jQuery.</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"div"</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">});</span>
<span class="c1">// The $ variable in the global scope has the prototype.js meaning.</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mainDiv</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"main"</span><span class="p">);</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p>This is probably the ideal solution for most of your code, considering that there'll be less code that you'll have to change in order to achieve complete compatibility.</p>

<p><strong>Including jQuery Before Other Libraries</strong></p>

<p>The code snippets above rely on jQuery being loaded after prototype.js is loaded. If you include jQuery before other libraries, you may use jQuery when you do some work with jQuery, but the $ will have the meaning defined in the other library. There is no need to relinquish the $ alias by calling jQuery.noConflict().</p>

<div class="highlight highlight-javascript"><pre><span class="c">&lt;!--</span> <span class="nx">Loading</span> <span class="nx">jQuery</span> <span class="nx">before</span> <span class="nx">other</span> <span class="nx">libraries</span><span class="p">.</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"jquery.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"prototype.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="c1">// Use full jQuery function name to reference jQuery.</span>
<span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">jQuery</span><span class="p">(</span><span class="s2">"div"</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">});</span>
<span class="c1">// Use the $ variable as defined in prototype.js</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mainDiv</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"main"</span><span class="p">);</span>
<span class="p">};</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p><strong>Summary of Ways to Reference the jQuery Function</strong></p>

<p>Here's a recap of ways you can reference the jQuery function when the presence of another library creates a conflict over the use of the $ variable:</p>

<p><strong>Create a New Alias</strong></p>

<p>The jQuery.noConflict() method returns a reference to the jQuery function, so you can capture it in whatever variable you'd like:</p>

<div class="highlight highlight-javascript"><pre><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"prototype.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"jquery.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="c1">// Give $ back to prototype.js; create new alias to jQuery.</span>
<span class="kd">var</span> <span class="nx">$jq</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">noConflict</span><span class="p">();</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p><strong>Use an Immediately Invoked Function Expression</strong></p>

<p>You can continue to use the standard $ by wrapping your code in an immediately invoked function expression; this is also a standard pattern for jQuery plugin authoring, where the author cannot know whether another library will have taken over the $.</p>

<div class="highlight highlight-javascript"><pre><span class="c">&lt;!--</span> <span class="nx">Using</span> <span class="nx">the</span> <span class="nx">$</span> <span class="nx">inside</span> <span class="nx">an</span> <span class="nx">immediately</span><span class="o">-</span><span class="nx">invoked</span> <span class="kd">function</span> <span class="nx">expression</span><span class="p">.</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"prototype.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"jquery.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="nx">jQuery</span><span class="p">.</span><span class="nx">noConflict</span><span class="p">();</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Your jQuery code here, using the $</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<blockquote>
<p>Note that if you use this technique, you will not be able to use prototype.js methods inside the immediately invoked function that expect $ to be prototype.js's $.</p>
</blockquote>

<p><strong>Use the Argument That's Passed to the jQuery( document ).ready() Function</strong></p>

<div class="highlight highlight-javascript"><pre><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"jquery.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"prototype.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Your jQuery code here, using $ to refer to jQuery.</span>
<span class="p">});</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p>Or using the more concise syntax for the DOM ready function:</p>

<div class="highlight highlight-javascript"><pre><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"jquery.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"prototype.js"</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="nx">jQuery</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Your jQuery code here, using the $</span>
<span class="p">});</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<h4>Attributes</h4>

<p>An element's attributes can contain useful information for your application, so it's important to be able to get and set them.</p>

<p><strong>The .attr() method</strong></p>

<p>The .attr() method acts as both a getter and a setter. As a setter, .attr() can accept either a key and a value, or an object containing one or more key/value pairs.</p>

<p>.attr() as a setter:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"a"</span> <span class="p">).</span><span class="nx">attr</span><span class="p">(</span> <span class="s2">"href"</span><span class="p">,</span> <span class="s2">"allMyHrefsAreTheSameNow.html"</span> <span class="p">);</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"a"</span> <span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
<span class="nx">title</span><span class="o">:</span> <span class="s2">"all titles are the same too!"</span><span class="p">,</span>
<span class="nx">href</span><span class="o">:</span> <span class="s2">"somethingNew.html"</span>
<span class="p">});</span>
</pre></div>

<p>.attr() as a getter:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"a"</span> <span class="p">).</span><span class="nx">attr</span><span class="p">(</span> <span class="s2">"href"</span> <span class="p">);</span> <span class="c1">// Returns the href for the first a element in the document</span>
</pre></div>

<h4>Selecting Elements</h4>

<p>The most basic concept of jQuery is to "select some elements and do something with them." jQuery supports most CSS3 selectors, as well as some non-standard selectors.</p>

<p>****Selecting Elements by ID****</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"#myId"</span> <span class="p">);</span> <span class="c1">// Note IDs must be unique per page.</span>
</pre></div>

<p>Selecting Elements by Class Name</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">".myClass"</span> <span class="p">);</span>
</pre></div>

<p>Selecting Elements by Attribute</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"input[name='first_name']"</span> <span class="p">);</span> <span class="c1">// Beware, this can be very slow in older browsers</span>
</pre></div>

<p>Selecting Elements by Compound CSS Selector</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"#contents ul.people li"</span> <span class="p">);</span>
</pre></div>

<p>Pseudo-Selectors</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"a.external:first"</span> <span class="p">);</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"tr:odd"</span> <span class="p">);</span>
<span class="c1">// Select all input-like elements in a form (more on this below).</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"#myForm :input"</span> <span class="p">);</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"div:visible"</span> <span class="p">);</span>
<span class="c1">// All except the first three divs.</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"div:gt(2)"</span> <span class="p">);</span>
<span class="c1">// All currently animated divs.</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"div:animated"</span> <span class="p">);</span>
</pre></div>

<blockquote>
<p>Note: When using the :visible and :hidden pseudo-selectors, jQuery tests the actual visibility of the element, not its CSS visibility or display properties. jQuery looks to see if the element's physical height and width on the page are both greater than zero.</p>
</blockquote>

<p>However, this test doesn't work with </p> elements. In the case of  jQuery does check the CSS display property, and considers an element hidden if its display property is set to none.

<p>Elements that have not been added to the DOM will always be considered hidden, even if the CSS that would affect them would render them visible. </p>

<p><strong>Choosing Selectors</strong></p>

<p>Choosing good selectors is one way to improve JavaScript's performance. A little specificity – for example, including an element type when selecting elements by class name – can go a long way. On the other hand, too much specificity can be a bad thing. A selector such as #myTable thead tr th.special is overkill if a selector such as #myTable th.special will get the job done.</p>

<p>jQuery offers many attribute-based selectors, allowing selections based on the content of arbitrary attributes using simplified regular expressions.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Find all &lt;a&gt; elements whose rel attribute ends with "thinger".</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"a[rel$='thinger']"</span> <span class="p">);</span>
</pre></div>

<p><strong>Does My Selection Contain Any Elements?</strong></p>

<p>Once you've made a selection, you'll often want to know whether you have anything to work with. A common mistake is to use:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Doesn't work!</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">"div.foo"</span><span class="p">))</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>

<p>This won't work. When a selection is made using $(), an object is always returned, and objects always evaluate to true. Even if the selection doesn't contain any elements, the code inside the if statement will still run.</p>

<p>The best way to determine if there are any elements is to test the selection's .length property, which tells you how many elements were selected. If the answer is 0, the .length property will evaluate to false when used as a boolean value:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Testing whether a selection contains elements.</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">"div.foo"</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>

<p><strong>Saving Selections</strong></p>

<p>jQuery doesn't cache elements for you. If you've made a selection that you might need to make again, you should save the selection in a variable rather than making the selection repeatedly.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">divs</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s2">"div"</span> <span class="p">);</span>
</pre></div>

<p>Once the selection is stored in a variable, you can call jQuery methods on the variable just like you would have called them on the original selection.</p>

<p>A selection only fetches the elements that are on the page at the time the selection is made. If elements are added to the page later, you'll have to repeat the selection or otherwise add them to the selection stored in the variable. Stored selections don't magically update when the DOM changes.</p>

<p><strong>Refining &amp; Filtering Selections</strong></p>

<p>Sometimes the selection contains more than what you're after. jQuery offers several methods for refining and filtering selections.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Refining selections.</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"div.foo"</span> <span class="p">).</span><span class="nx">has</span><span class="p">(</span> <span class="s2">"p"</span> <span class="p">);</span> <span class="c1">// div.foo elements that contain &lt;p&gt; tags</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"h1"</span> <span class="p">).</span><span class="nx">not</span><span class="p">(</span> <span class="s2">".bar"</span> <span class="p">);</span> <span class="c1">// h1 elements that don't have a class of bar</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"ul li"</span> <span class="p">).</span><span class="nx">filter</span><span class="p">(</span> <span class="s2">".current"</span> <span class="p">);</span> <span class="c1">// unordered list items with class of current</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"ul li"</span> <span class="p">).</span><span class="nx">first</span><span class="p">();</span> <span class="c1">// just the first unordered list item</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"ul li"</span> <span class="p">).</span><span class="nx">eq</span><span class="p">(</span> <span class="mi">5</span> <span class="p">);</span> <span class="c1">// the sixth</span>
</pre></div>

<h4>Working with Selections</h4>

<p><strong>Getters &amp; Setters</strong></p>

<p>jQuery "overloads" its methods, so the method used to set a value generally has the same name as the method used to get a value. When a method is used to set a value, it's called a setter. When a method is used to get (or read) a value, it's called a getter. Setters affect all elements in a selection. Getters get the requested value only for the first element in the selection.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// The .html() method used as a setter:</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"h1"</span> <span class="p">).</span><span class="nx">html</span><span class="p">(</span> <span class="s2">"hello world"</span> <span class="p">);</span>

<span class="c1">// The .html() method used as a getter:</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"h1"</span> <span class="p">).</span><span class="nx">html</span><span class="p">();</span>
</pre></div>

<p>Setters return a jQuery object, allowing you to continue calling jQuery methods on your selection. Getters return whatever they were asked to get, so you can't continue to call jQuery methods on the value returned by the getter.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Attempting to call a jQuery method after calling a getter.</span>
<span class="c1">// This will NOT work:</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"h1"</span> <span class="p">).</span><span class="nx">html</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">"test"</span> <span class="p">);</span>
</pre></div>

<p><strong>Chaining</strong></p>

<p>If you call a method on a selection and that method returns a jQuery object, you can continue to call jQuery methods on the object without pausing for a semicolon. This practice is referred to as "chaining":</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"#content"</span> <span class="p">).</span><span class="nx">find</span><span class="p">(</span> <span class="s2">"h3"</span> <span class="p">).</span><span class="nx">eq</span><span class="p">(</span> <span class="mi">2</span> <span class="p">).</span><span class="nx">html</span><span class="p">(</span> <span class="s2">"new text for the third h3!"</span> <span class="p">);</span>
</pre></div>

<p>It may help code readability to break the chain over several lines:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"#content"</span> <span class="p">)</span>
<span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">"h3"</span> <span class="p">)</span>
<span class="p">.</span><span class="nx">eq</span><span class="p">(</span> <span class="mi">2</span> <span class="p">)</span>
<span class="p">.</span><span class="nx">html</span><span class="p">(</span> <span class="s2">"new text for the third h3!"</span> <span class="p">);</span>
</pre></div>

<p>jQuery also provides the .end() method to get back to the original selection should you change the selection in the middle of a chain:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"#content"</span> <span class="p">)</span>
<span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">"h3"</span> <span class="p">)</span>
<span class="p">.</span><span class="nx">eq</span><span class="p">(</span> <span class="mi">2</span> <span class="p">)</span>
<span class="p">.</span><span class="nx">html</span><span class="p">(</span> <span class="s2">"new text for the third h3!"</span> <span class="p">)</span>
<span class="p">.</span><span class="nx">end</span><span class="p">()</span> <span class="c1">// Restores the selection to all h3s in #content</span>
<span class="p">.</span><span class="nx">eq</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
<span class="p">.</span><span class="nx">html</span><span class="p">(</span> <span class="s2">"new text for the first h3!"</span> <span class="p">);</span>
</pre></div>

<p>Chaining is extraordinarily powerful, and it's a feature that many libraries have adapted since it was made popular by jQuery. However, it must be used with care – extensive chaining can make code extremely difficult to modify or debug. There is no hard-and-fast rule to how long a chain should be – just know that it's easy to get carried away.</p>

<h4>Manipulating Elements</h4>

<p><strong>Getting and Setting Information About Elements</strong></p>

<p>There are many ways to change an existing element. Among the most common tasks is changing the inner HTML or attribute of an element. jQuery offers simple, cross-browser methods for these sorts of manipulations. You can also get information about elements using many of the same methods in their getter incarnations. For more information on getters and setters, see the Working with Selections section. Here are a few methods you can use to get and set information about elements:</p>

<ul class="task-list">
<li>.html() – Get or set the HTML contents.</li>
<li>.text() – Get or set the text contents; HTML will be stripped.</li>
<li>.attr() – Get or set the value of the provided attribute.</li>
<li>.width() – Get or set the width in pixels of the first element in the selection as an integer.</li>
<li>.height() – Get or set the height in pixels of the first element in the selection as an integer.</li>
<li>.position() – Get an object with position information for the first element in the selection, relative to its first positioned ancestor. This is a getter only.</li>
<li>.val() – Get or set the value of form elements.</li>
</ul><p>Changing things about elements is trivial, but remember that the change will affect all elements in the selection. If you just want to change one element, be sure to specify that in the selection before calling a setter method.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Changing the HTML of an element.</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"#myDiv p:first"</span> <span class="p">).</span><span class="nx">html</span><span class="p">(</span> <span class="s2">"New &lt;strong&gt;first&lt;/strong&gt; paragraph!"</span> <span class="p">);</span>
</pre></div>

<p><strong>Cloning Elements</strong></p>

<p>Methods such as .appendTo() move the element, but sometimes a copy of the element is needed instead. In this case, use .clone() first:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Making a copy of an element.</span>
<span class="c1">// Copy the first list item to the end of the list:</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"#myList li:first"</span> <span class="p">).</span><span class="nx">clone</span><span class="p">().</span><span class="nx">appendTo</span><span class="p">(</span> <span class="s2">"#myList"</span> <span class="p">);</span>
</pre></div>

<p>If you need to copy related data and events, be sure to pass true as an argument to .clone().</p>

<p><strong>Removing Elements</strong></p>

<p>There are two ways to remove elements from the page: .remove() and .detach(). Use .remove() when you want to permanently remove the selection from the page. While .remove() does return the removed element(s), those elements will not have their associated data and events attached to them if you return them to the page.</p>

<p>Use .detach() if you need the data and events to persist. Like .remove(), it returns the selection, but it also maintains the data and events associated with the selection, so you can restore the selection to the page at a later time.</p>

<p>The .detach() method is extremely valuable if you are doing heavy manipulation on an element. In that case, it's beneficial to .detach() the element from the page, work on it in your code, then restore it to the page when you're done. This limits expensive "DOM touches" while maintaining the element's data and events.</p>

<p>If you want to leave the element on the page but remove its contents, you can use .empty() to dispose of the element's inner HTML.</p>

<p><strong>Creating New Elements</strong></p>

<p>jQuery offers a trivial and elegant way to create new elements using the same $() method used to make selections:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Creating new elements from an HTML string.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;p&gt;This is a new paragraph&lt;/p&gt;"</span><span class="p">);</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;li class=\"new\"&gt;new list item&lt;/li&gt;"</span><span class="p">);</span>

<span class="c1">// Creating a new element with an attribute object.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;a/&gt;"</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">html</span> <span class="o">:</span> <span class="s2">"This is a &lt;strong&gt;new&lt;/strong&gt; link"</span><span class="p">,</span>
    <span class="s2">"class"</span> <span class="o">:</span> <span class="s2">"new"</span><span class="p">,</span>
    <span class="nx">href</span> <span class="o">:</span> <span class="s2">"foo.html"</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>Note that the attributes object in the second argument above, the property name class is quoted, although the property names html and href are not. Property names generally do not need to be quoted unless they are reserved words (as class is in this case).</p>
</blockquote>

<p>When you create a new element, it is not immediately added to the page. There are several ways to add an element to the page once it's been created.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Getting a new element on to the page.</span>
<span class="kd">var</span> <span class="nx">myNewElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s2">"&lt;p&gt;New element&lt;/p&gt;"</span> <span class="p">);</span>
<span class="nx">myNewElement</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span> <span class="s2">"#content"</span> <span class="p">);</span>
<span class="nx">myNewElement</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span> <span class="s2">"ul:last"</span> <span class="p">);</span> <span class="c1">// This will remove the p from #content!</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"ul"</span> <span class="p">).</span><span class="nx">last</span><span class="p">().</span><span class="nx">after</span><span class="p">(</span> <span class="nx">myNewElement</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span> <span class="p">);</span> <span class="c1">// Clone the p so now we have</span>
</pre></div>

<p>The created element doesn't need to be stored in a variable – you can call the method to add the element to the page directly after the $(). However, most of the time you'll want a reference to the element you added so you won't have to select it later.</p>

<p>You can also create an element as you're adding it to the page, but note that in this case you don't get a reference to the newly created element:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Creating and adding an element to the page at the same time.</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"ul"</span> <span class="p">).</span><span class="nx">append</span><span class="p">(</span> <span class="s2">"&lt;li&gt;list item&lt;/li&gt;"</span> <span class="p">);</span>
</pre></div>

<p>The syntax for adding new elements to the page is easy, so it's tempting to forget that there's a huge performance cost for adding to the DOM repeatedly. If you're adding many elements to the same container, you'll want to concatenate all the HTML into a single string, and then append that string to the container instead of appending the elements one at a time. Use an array to gather all the pieces together, then join them into a single string for appending:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">myItems</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">myList</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#myList"</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">myItems</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">"&lt;li&gt;item "</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">"&lt;/li&gt;"</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">myList</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">myItems</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">""</span><span class="p">));</span>
</pre></div>

<p><strong>Manipulating Attributes</strong></p>

<p>jQuery's attribute manipulation capabilities are extensive. Basic changes are simple, but the .attr() method also allows for more complex manipulations. It can either set an explicit value, or set a value using the return value of a function. When the function syntax is used, the function receives two arguments: the zero-based index of the element whose attribute is being changed, and the current value of the attribute being changed.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Manipulating a single attribute.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#myDiv a:first"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"href"</span><span class="p">,</span> <span class="s2">"newDestination.html"</span><span class="p">);</span>

<span class="c1">// Manipulating multiple attributes.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#myDiv a:first"</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
    <span class="nx">href</span> <span class="o">:</span> <span class="s2">"newDestination.html"</span><span class="p">,</span>
    <span class="nx">rel</span> <span class="o">:</span> <span class="s2">"nofollow"</span>
<span class="p">});</span>

<span class="c1">// Using a function to determine an attribute's new value.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#myDiv a:first"</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
    <span class="nx">rel</span> <span class="o">:</span> <span class="s2">"nofollow"</span><span class="p">,</span>
    <span class="nx">href</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">href</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"/new/"</span> <span class="o">+</span> <span class="nx">href</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#myDiv a:first"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"href"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">href</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">"/new/"</span> <span class="o">+</span> <span class="nx">href</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>The jQuery Object</h4>

<p>When creating new elements (or selecting existing ones), jQuery returns the elements in a collection. Many developers new to jQuery assume that this collection is an array. It has a zero-indexed sequence of DOM elements, some familiar array functions, and a .length property, after all. Actually, the jQuery object is more complicated than that.</p>

<p><strong>DOM and DOM Elements</strong></p>

<p>The Document Object Model (DOM for short) is a representation of an HTML document. It may contain any number of DOM elements. At a high level, a DOM element can be thought of as a "piece" of a web page. It may contain text and/or other DOM elements. DOM elements are described by a type, such as </p><div>, , or <p>, and any number of attributes such as src, href, class and so on. For a more thorough description, refer to the official DOM specification from the W3C.</p>

<p>Elements have properties like any JavaScript object. Among these properties are attributes like .tagName and methods like .appendChild(). These properties are the only way to interact with the web page via JavaScript.</p>

<p><strong>The jQuery Object</strong></p>

<p>It turns out that working directly with DOM elements can be awkward. The jQuery object defines many methods to smooth out the experience for developers. Some benefits of the jQuery Object include:</p>

<p><em>Compatibility</em> – The implementation of element methods varies across browser vendors and versions. The following snippet attempts to set the inner HTML of a </p> element stored in target:

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="s2">"target"</span> <span class="p">);</span>
<span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">"&lt;td&gt;Hello &lt;b&gt;World&lt;/b&gt;!&lt;/td&gt;"</span><span class="p">;</span>
</pre></div>

<p>This works in many cases, but it will fail in most versions of Internet Explorer. In that case, the recommended approach is to use pure DOM methods instead. By wrapping the target element in a jQuery object, these edge cases are taken care of, and the expected result is achieved in all supported browsers:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Setting the inner HTML with jQuery.</span>
<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="s2">"target"</span> <span class="p">);</span>
<span class="nx">$</span><span class="p">(</span> <span class="nx">target</span> <span class="p">).</span><span class="nx">html</span><span class="p">(</span> <span class="s2">"&lt;td&gt;Hello &lt;b&gt;World&lt;/b&gt;!&lt;/td&gt;"</span> <span class="p">);</span>
</pre></div>

<p><em>Convenience</em> – There are also a lot of common DOM manipulation use cases that are awkward to accomplish with pure DOM methods. For instance, inserting an element stored in newElement after the target element requires a rather verbose DOM method:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Inserting a new element after another with the native DOM API.</span>
<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="s2">"target"</span> <span class="p">);</span>
<span class="kd">var</span> <span class="nx">newElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span> <span class="s2">"div"</span> <span class="p">);</span>
<span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span> <span class="nx">newElement</span><span class="p">,</span> <span class="nx">target</span><span class="p">.</span><span class="nx">nextSibling</span> <span class="p">);</span>
</pre></div>

<p>By wrapping the target element in a jQuery object, the same task becomes much simpler:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Inserting a new element after another with jQuery.</span>
<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="s2">"target"</span> <span class="p">);</span>
<span class="kd">var</span> <span class="nx">newElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span> <span class="s2">"div"</span> <span class="p">);</span>
<span class="nx">$</span><span class="p">(</span> <span class="nx">target</span> <span class="p">).</span><span class="nx">after</span><span class="p">(</span> <span class="nx">newElement</span> <span class="p">);</span>
</pre></div>

<p>For the most part, these details are simply "gotchas" standing between you and your goals.</p>

<h4>Data Methods</h4>

<p>There's often data about an element you want to store with the element. In plain JavaScript, you might do this by adding a property to the DOM element, but you'd have to deal with memory leaks in some browsers. jQuery offers a straightforward way to store data related to an element, and it manages the memory issues for you.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Storing and retrieving data related to an element.</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"#myDiv"</span> <span class="p">).</span><span class="nx">data</span><span class="p">(</span> <span class="s2">"keyName"</span><span class="p">,</span> <span class="p">{</span> <span class="nx">foo</span><span class="o">:</span> <span class="s2">"bar"</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"#myDiv"</span> <span class="p">).</span><span class="nx">data</span><span class="p">(</span> <span class="s2">"keyName"</span> <span class="p">);</span> <span class="c1">// Returns { foo: "bar" }</span>
</pre></div>

<p>Any kind of data can be stored on an element. For the purposes of this article, .data() will be used to store references to other elements.</p>

<p>For example, you may want to establish a relationship between a list item and a </p>
<div> that's inside of it. This relationship could be established every single time the list item is touched, but a better solution would be to establish the relationship once, then store a pointer to the <div> on the list item using .data():

<div class="highlight highlight-javascript"><pre><span class="c1">// Storing a relationship between elements using .data()</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#myList li"</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">"div.content"</span><span class="p">);</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">"contentDiv"</span><span class="p">,</span> <span class="nx">div</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// Later, we don't have to find the div again;</span>
<span class="c1">// we can just read it from the list item's data</span>
<span class="kd">var</span> <span class="nx">firstLi</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#myList li:first"</span><span class="p">);</span>
<span class="nx">firstLi</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">"contentDiv"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">"new content"</span><span class="p">);</span>
</pre></div>

<p>In addition to passing .data() a single key-value pair to store data, you can also pass an object containing one or more pairs.</p>

<h4>Iterating over jQuery and non-jQuery Objects</h4>

<p>jQuery provides an object iterator utility called $.each() as well as a jQuery collection iterator: .each(). These are not interchangeable. In addition, there are a couple of helpful methods called $.map() and .map() that can shortcut one of our common iteration use cases.</p>

<p><strong>$.each()</strong></p>

<p>$.each() is a generic iterator function for looping over object, arrays, and array-like objects. Plain objects are iterated via their named properties while arrays and array-like objects are iterated via their indices.</p>

<p>$.each() is essentially a drop-in replacement of a traditional for or for-in loop. Given:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">];</span>
</pre></div>

<p>Then this:</p>

<div class="highlight highlight-javascript"><pre><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sum</span><span class="p">);</span> <span class="c1">// 15</span>
</pre></div>

<p>Can be replaced with this:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sum</span><span class="p">);</span> <span class="c1">// 15</span>
</pre></div>

<p>Notice that we don't have to access arr[ index ] as the value is conveniently passed to the callback in $.each().</p>

<p>In addition, given:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">foo</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">bar</span> <span class="o">:</span> <span class="mi">2</span>
<span class="p">}</span>
</pre></div>

<p>Then this:</p>

<div class="highlight highlight-javascript"><pre><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">item</span><span class="p">];</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sum</span><span class="p">);</span> <span class="c1">// 3</span>
</pre></div>

<p>Can be replaced with this:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sum</span><span class="p">);</span> <span class="c1">// 3</span>
</pre></div>

<p>Again, we don't have to directly access obj[ key ] as the value is passed directly to the callback.</p>

<blockquote>
<p>Note that $.each() is for plain objects, arrays, array-like objects that are not jQuery collections.</p>
</blockquote>

<p>This would be considered incorrect:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Incorrect:</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">"p"</span><span class="p">),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Do something</span>
<span class="p">});</span>
</pre></div>

<p>For jQuery collections, use .each().</p>

<p><strong>.each()</strong></p>

<p>.each() is used directly on a jQuery collection. It iterates over each matched element in the collection and performs a callback on that object. The index of the current element within the collection is passed as an argument to the callback. The value (the DOM element in this case) is also passed, but the callback is fired within the context of the current matched element so the this keyword points to the current element as expected in other jQuery callbacks.</p>

<p>For example, given the following markup:</p>

<div class="highlight highlight-javascript"><pre><span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">"#"</span><span class="o">&gt;</span><span class="nx">Link</span> <span class="mi">1</span><span class="o">&lt;</span><span class="err">/a&gt;&lt;/li&gt;</span>
<span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">"#"</span><span class="o">&gt;</span><span class="nx">Link</span> <span class="mi">2</span><span class="o">&lt;</span><span class="err">/a&gt;&lt;/li&gt;</span>
<span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">"#"</span><span class="o">&gt;</span><span class="nx">Link</span> <span class="mi">3</span><span class="o">&lt;</span><span class="err">/a&gt;&lt;/li&gt;</span>
<span class="o">&lt;</span><span class="err">/ul&gt;</span>
</pre></div>

<p>.each() may be used like so:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"li"</span> <span class="p">).</span><span class="nx">each</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">element</span> <span class="p">){</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">text</span><span class="p">()</span> <span class="p">);</span>
<span class="p">});</span>
<span class="c1">// Logs the following:</span>
<span class="c1">// Link 1</span>
<span class="c1">// Link 2</span>
<span class="c1">// Link 3</span>
</pre></div>

<p><strong>The Second Argument</strong></p>

<p>The question is often raised, "If this is the element, why is there a second DOM element argument passed to the callback?"</p>

<p>Whether intentional or inadvert, the execution context may change. When consistently using the keyword this, it's easy to end up confusing ourselves or other developers reading the code. Even if the execution context remains the same, it may be more readable to use the second parameter as a named parameter. For example:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"li"</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">listItem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">===</span> <span class="nx">listItem</span><span class="p">;</span> <span class="c1">// true</span>
    <span class="c1">// For example only. You probably shouldn't call $.ajax() in a loop.</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// The context has changed.</span>
            <span class="c1">// The "this" keyword no longer refers to listItem.</span>
            <span class="k">this</span> <span class="o">!==</span> <span class="nx">listItem</span><span class="p">;</span> <span class="c1">// true</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><strong>Sometimes .each() Isn't Necessary</strong></p>

<p>Many jQuery methods implicitly iterate over the entire collection, applying their behavior to each matched element. For example, this is unnecessary:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"li"</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"newClass"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>And this is fine:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"li"</span> <span class="p">).</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">"newClass"</span> <span class="p">);</span>
</pre></div>

<p>Each li in the document will have the class "newClass" added.</p>

<p>On the other hand, some methods do not iterate over the collection. .each() is required when we need to get information from the element before setting a new value.</p>

<p>This will not work:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Doesn't work:</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"input"</span> <span class="p">).</span><span class="nx">val</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"%"</span> <span class="p">);</span>
<span class="c1">// .val() does not change the execution context, so this === window</span>
</pre></div>

<p>Rather, this is how it should be written:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"input"</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
    <span class="nx">elem</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"%"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The following is a list of methods that require .each():</p>

<ul class="task-list">
<li>.attr() (getter)</li>
<li>.css() (getter)</li>
<li>.data() (getter)</li>
<li>.height() (getter)</li>
<li>.html() (getter)</li>
<li>.innerHeight()</li>
<li>.innerWidth()</li>
<li>.offset() (getter)</li>
<li>.outerHeight()</li>
<li>.outerWidth()</li>
<li>.position()</li>
<li>.prop() (getter)</li>
<li>.scrollLeft() (getter)</li>
<li>.scrollTop() (getter)</li>
<li>.val() (getter)</li>
<li>.width() (getter)</li>
</ul>
<blockquote>
<p>Note that in most cases, the "getter" signature returns the result from the first element in a jQuery collection while the setter acts over the entire collection of matched elements. The exception to this is .text() where the getter signature will return a concatenated string of text from all matched elements.</p>
</blockquote>

<p>In addition to a setter value, the attribute, property, CSS setters, and DOM insertion "setter" methods (i.e. .text() and .html()) accept anonymous callback functions that are applied to each element in the matching set. The arguments passed to the callback are the index of the matched element within the set and the result of the 'getter' signature of the method.</p>

<p>For example, these are equivalent:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"input"</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
    <span class="nx">elem</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"%"</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"input"</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">value</span> <span class="o">+</span> <span class="s2">"%"</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>One other thing to keep in mind with this implicit iteration is that traversal methods such as .children() or .parent() will act on each matched element in a collection, returning a combined collection of all children or parent nodes.</p>

<p><strong>.map()</strong></p>

<p>There is a common iteration use case that can be better handled by using the .map() method. Anytime we want to create an array or concatenated string based on all matched elements in our jQuery selector, we're better served using .map().</p>

<p>For example instead of doing this:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">newArr</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"li"</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">newArr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>We can do this:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"li"</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="p">}).</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Notice the .get() chained at the end. .map() actually returns a jQuery-wrapped collection, even if we return strings out of the callback. We need to use the argument-less version of .get() in order to return a basic JavaScript array that we can work with. To concatenate into a string, we can chain the plain JS .join() array method after .get().</p>

<p><strong>$.map</strong></p>

<p>Like $.each() and .each(), there is a $.map() as well as .map(). The difference is also very similar to both .each() methods. $.map() works on plain JavaScript arrays while .map() works on jQuery element collections. Because it's working on a plain array, $.map() returns a plain array and .get() does not need to be called – in fact, it will throw an error as it's not a native JavaScript method.</p>

<p>A word of warning: $.map() switches the order of callback arguments. This was done in order to match the native JavaScript .map() method made available in ECMAScript 5.</p>

<p>For example:</p>

<div class="highlight highlight-javascript"><pre><span class="o">&lt;</span><span class="nx">li</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"a"</span><span class="o">&gt;&lt;</span><span class="err">/li&gt;</span>
<span class="o">&lt;</span><span class="nx">li</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"b"</span><span class="o">&gt;&lt;</span><span class="err">/li&gt;</span>
<span class="o">&lt;</span><span class="nx">li</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"c"</span><span class="o">&gt;&lt;</span><span class="err">/li&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[{</span>
        <span class="nx">id</span> <span class="o">:</span> <span class="s2">"a"</span><span class="p">,</span>
        <span class="nx">tagName</span> <span class="o">:</span> <span class="s2">"li"</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="nx">id</span> <span class="o">:</span> <span class="s2">"b"</span><span class="p">,</span>
        <span class="nx">tagName</span> <span class="o">:</span> <span class="s2">"li"</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="nx">id</span> <span class="o">:</span> <span class="s2">"c"</span><span class="p">,</span>
        <span class="nx">tagName</span> <span class="o">:</span> <span class="s2">"li"</span>
    <span class="p">}</span>
<span class="p">];</span>
<span class="c1">// Returns [ "a", "b", "c" ]</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"li"</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="p">}).</span><span class="nx">get</span><span class="p">();</span>
<span class="c1">// Also returns ["a", "b", "c"]</span>
<span class="c1">// Note that the value comes first with $.map</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="p">});</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<a name="events"><h3>Events</h3></a>

<p><a href="https://camo.githubusercontent.com/726990e989348ec185849043f6d167d0d46ee0c9/687474703a2f2f692e696d6775722e636f6d2f6e5a6f514a6c382e706e67" target="_blank"><img src="https://camo.githubusercontent.com/726990e989348ec185849043f6d167d0d46ee0c9/687474703a2f2f692e696d6775722e636f6d2f6e5a6f514a6c382e706e67" alt="" data-canonical-src="http://i.imgur.com/nZoQJl8.png" style="max-width:100%;"></a></p>

<p>(Courtesy: <a href="http://courses.cs.washington.edu/courses/cse190m/12su/lectures/slides/lecture17-events.shtml">washington.edu</a>)</p>

<p>jQuery provides simple methods for attaching event handlers to selections. When an event occurs, the provided function is executed. Inside the function, this refers to the element that was clicked.</p>

<p>For details on jQuery events, visit the Events documentation on api.jquery.com.</p>

<p>The event handling function can receive an event object. This object can be used to determine the nature of the event, and to prevent the event’s default behavior.</p>

<p>For details on the event object, visit the Event object documentation on api.jquery.com.</p>

<h4>Introduction to Events</h4>

<p>Web pages are all about interaction. Users perform a countless number of actions such as moving their mice over the page, clicking on elements, and typing in textboxes — all of these are examples of events. In addition to these user events, there are a slew of others that occur, like when the page is loaded, when video begins playing or is paused, etc. Whenever something interesting occurs on the page, an event is fired, meaning that the browser basically announces that something has happened. It's this announcement that allows developers to "listen" for events and react to them appropriately.</p>

<p><strong>What's a DOM event?</strong></p>

<p>As mentioned, there are a myriad of event types, but perhaps the ones that are easiest to understand are user events, like when someone clicks on an element or types into a form. These types of events occur on an element, meaning that when a user clicks on a button for example, the button has had an event occur on it. While user interactions aren't the only types of DOM events, they're certainly the easiest to understand when starting out. MDN has a good reference of available DOM events.</p>

<p><strong>Ways to listen for events</strong></p>

<p>There are many ways to listen for events. Actions are constantly occurring on a webpage, but the developer is only notified about them if they're listening for them. Listening for an event basically means you're waiting for the browser to tell you that a specific event has occurred and then you'll specify how the page should react.</p>

<p>To specify to the browser what to do when an event occurs, you provide a function, also known as an event handler. This function is executed whenever the event occurs (or until the event is unbound).</p>

<p>For instance, to alert a message whenever a user clicks on a button, you might write something like this:</p>

<div class="highlight highlight-javascript"><pre><span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onclick</span><span class="o">=</span><span class="s2">"alert('Hello')"</span><span class="o">&gt;</span><span class="nx">Say</span> <span class="nx">hello</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</pre></div>

<p>The event we want to listen to is specified by the button's onclick attribute, and the event handler is the alert function which alerts "Hello" to the user. While this works, it's an abysmal way to achieve this functionality for a couple of reasons:</p>

<ul class="task-list">
<li><p>First, we're coupling our view code (HTML) with our interaction code (JS). That means that whenever we need to update functionality, we'd have to edit our HTML which is just a bad practice and a maintenance nightmare.</p></li>
<li><p>Second, it's not scalable. If you had to attach this functionality onto numerous buttons, you'd not only bloat the page with a bunch of repetitious code, but you would again destroy maintainability.</p></li>
</ul>
<p>Utilizing inline event handlers like this can be considered obtrusive JavaScript, but its opposite, unobtrusive JavaScript is a much more common way of discussing the topic. The notion of <em>unobtrusive JavaScript</em> is that your HTML and JS are kept separate and are therefore more maintainable. Separation of concerns is important because it keeps like pieces of code together (i.e. HTML, JS, CSS) and unlike pieces of code apart, facilitating changes, enhancements, etc. Furthermore, unobtrusive JavaScript stresses the importance of adding the least amount of cruft to a page as possible. If a user's browser doesn't support JavaScript, then it shouldn't be intertwined into the markup of the page. Also, to prevent naming collisions, JS code should utilize a single namespace for different pieces of functionality or libraries. jQuery is a good example of this, in that the jQuery object/constructor (and also the $ alias to jQuery) only utilizes a single global variable, and all of jQuery's functionality is packaged into that one object.</p>

<p>To accomplish the desired task unobtrusively, let's change our HTML a little bit by removing the onclick attribute and replacing it with an id, which we'll utilize to "hook onto" the button from within a script file.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"helloBtn"</span><span class="nt">&gt;</span>Say hello<span class="nt">&lt;/button&gt;</span>
</pre></div>

<p>If we wanted to be informed when a user clicks on that button unobtrusively, we might do something like the following in a separate script file:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Event binding using addEventListener</span>
<span class="kd">var</span> <span class="nx">helloBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"helloBtn"</span><span class="p">);</span>
<span class="nx">helloBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello."</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>

<p>Here we're saving a reference to the button element by calling getElementById and assigning its return value to a variable. We then call addEventListener and provide an event handler function that will be called whenever that event occurs. While there's nothing wrong with this code as it will work fine in modern browsers, it won't fare well in versions of IE prior to IE9. This is because Microsoft chose to implement a different method, attachEvent, as opposed to the W3C standard addEventListener, and didn't get around to changing it until IE9 was released. For this reason, it's beneficial to utilize jQuery because it abstracts away browser inconsistencies, allowing developers to use a single API for these types of tasks, as seen below.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Event binding using a convenience method</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#helloBtn"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello."</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The $( "#helloBtn" ) code selects the button element using the $ (a.k.a. jQuery) function and returns a jQuery object. The jQuery object has a bunch of methods (functions) available to it, one of them named click, which resides in the jQuery object's prototype. We call the click method on the jQuery object and pass along an anonymous function event handler that's going to be executed when a user clicks the button, alerting "Hello." to the user.</p>

<p>There are a number of ways that events can be listened for using jQuery:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// The many ways to bind events with jQuery</span>
<span class="c1">// Attach an event handler directly to the button using jQuery's</span>
<span class="c1">// shorthand `click` method.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#helloBtn"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello."</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// Attach an event handler directly to the button using jQuery's</span>
<span class="c1">// `bind` method, passing it an event string of `click`</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#helloBtn"</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello."</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// As of jQuery 1.7, attach an event handler directly to the button</span>
<span class="c1">// using jQuery's `on` method.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#helloBtn"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello."</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// As of jQuery 1.7, attach an event handler to the `body` element that</span>
<span class="c1">// is listening for clicks, and will respond whenever *any* button is</span>
<span class="c1">// clicked on the page.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"body"</span><span class="p">).</span><span class="nx">on</span><span class="p">({</span>
    <span class="nx">click</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello."</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="s2">"button"</span><span class="p">);</span>
<span class="c1">// An alternative to the previous example, using slightly different syntax.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"body"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="s2">"button"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello."</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>As of jQuery 1.7, all events are bound via the on method, whether you call it directly or whether you use an alias/shortcut method such as bind or click, which are mapped to the on method internally. With this in mind, it's beneficial to use the on method because the others are all just syntactic sugar, and utilizing the on method is going to result in faster and more consistent code.</p>

<p>Let's look at the on examples from above and discuss their differences. In the first example, a string of click is passed as the first argument to the on method, and an anonymous function is passed as the second. This looks a lot like the bind method before it. Here, we're attaching an event handler directly to #helloBtn. If there were any other buttons on the page, they wouldn't alert "Hello" when clicked because the event is only attached to #helloBtn.</p>

<p>In the second on example, we're passing an object (denoted by the curly braces {}), which has a property of click whose value is an anonymous function. The second argument to the on method is a jQuery selector string of button. While examples 1–3 are functionally equivalent, example 4 is different in that the body element is listening for click events that occur on any button element, not just #helloBtn. The final example above is exactly the same as the one preceding it, but instead of passing an object, we pass an event string, a selector string, and the callback. Both of these are examples of event delegation, a process by which an element higher in the DOM tree listens for events occurring on its children.</p>

<p>Event delegation works because of the notion of event bubbling. For most events, whenever something occurs on a page (like an element is clicked), the event travels from the element it occurred on, up to its parent, then up to the parent's parent, and so on, until it reaches the root element, a.k.a. the window. So in our table example, whenever a td is clicked, its parent tr would also be notified of the click, the parent table would be notified, the body would be notified, and ultimately the window would be notified as well. While event bubbling and delegation work well, the delegating element (in our example, the table) should always be as close to the delegatees as possible so the event doesn't have to travel way up the DOM tree before its handler function is called.</p>

<p>The two main pros of event delegation over binding directly to an element (or set of elements) are performance and the aforementioned event bubbling. Imagine having a large table of 1,000 cells and binding to an event for each cell. That's 1,000 separate event handlers that the browser has to attach, even if they're all mapped to the same function. Instead of binding to each individual cell though, we could instead use delegation to listen for events that occur on the parent table and react accordingly. One event would be bound instead of 1,000, resulting in way better performance and memory management.</p>

<p>The event bubbling that occurs affords us the ability to add cells via AJAX for example, without having to bind events directly to those cells since the parent table is listening for clicks and is therefore notified of clicks on its children. If we weren't using delegation, we'd have to constantly bind events for every cell that's added which is not only a performance issue, but could also become a maintenance nightmare.</p>

<p><strong>The event object</strong></p>

<p>In all of the previous examples, we've been using anonymous functions and specifying an event argument within that function. Let's change it up a little bit.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Binding a named function</span>
<span class="kd">function</span> <span class="nx">sayHello</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello."</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#helloBtn"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="nx">sayHello</span><span class="p">);</span>
</pre></div>

<p>In this slightly different example, we're defining a function called sayHello and then passing that function into the on method instead of an anonymous function. So many online examples show anonymous functions used as event handlers, but it's important to realize that you can also pass defined functions as event handlers as well. This is important if different elements or different events should perform the same functionality. This helps to keep your code DRY.</p>

<p>But what about that event argument in the sayHello function — what is it and why does it matter? In all DOM event callbacks, jQuery passes an event object argument which contains information about the event, such as precisely when and where it occurred, what type of event it was, which element the event occurred on, and a plethora of other information. Of course you don't have to call it event; you could call it e or whatever you want to, but event is a pretty common convention.</p>

<p>If the element has default functionality for a specific event (like a link opens a new page, a button in a form submits the form, etc.), that default functionality can be cancelled. This is often useful for AJAX requests. When a user clicks on a button to submit a form via AJAX, we'd want to cancel the button/form's default action (to submit it to the form's action attribute), and we would instead do an AJAX request to accomplish the same task for a more seamless experience. To do this, we would utilize the event object and call its .preventDefault() method. We can also prevent the event from bubbling up the DOM tree using .stopPropagation() so that parent elements aren't notified of its occurrence (in the case that event delegation is being used).</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Preventing a default action from occurring and stopping the event bubbling</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"form"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Prevent the form's default submission.</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="c1">// Prevent event from bubbling up DOM tree, prohibiting delegation</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="c1">// Make an AJAX request to submit the form data</span>
<span class="p">});</span>
</pre></div>

<p>When utilizing both .preventDefault() and .stopPropagation() simultaneously, you can instead return false to achieve both in a more concise manner, but it's advisable to only return false when both are actually necessary and not just for the sake of terseness. </p>

<blockquote>
<p>A final note on .stopPropagation() is that when using it in delegated events, the soonest that event bubbling can be stopped is when the event reaches the element that is delegating it.</p>
</blockquote>

<p>It's also important to note that the event object contains a property called originalEvent, which is the event object that the browser itself created. jQuery wraps this native event object with some useful methods and properties, but in some instances, you'll need to access the original event via event.originalEvent for instance. This is especially useful for touch events on mobile devices and tablets.</p>

<p>Finally, to inspect the event itself and see all of the data it contains, you should log the event in the browser's console using console.log. This will allow you to see all of an event's properties (including the originalEvent) which can be really helpful for debugging.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Logging an event's information</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"form"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Prevent the form's default submission.</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="c1">// Log the event object for inspectin'</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="c1">// Make an AJAX request to submit the form data</span>
<span class="p">});</span>
</pre></div>

<h4>Handling Events</h4>

<p>jQuery provides a method .on() to respond to any event on the selected elements. This is called an event binding. Although .on() isn't the only method provided for event binding, it is a best practice to use this for jQuery 1.7+. To learn more, read more about the evolution of event binding in jQuery.</p>

<p>The .on() method provides several useful features:</p>

<ul class="task-list">
<li>Bind any event triggered on the selected elements to an event handler</li>
<li>Bind multiple events to one event handler</li>
<li>Bind multiple events and multiple handlers to the selected elements</li>
<li>Use details about the event in the event handler</li>
<li>Pass data to the event handler for custom events</li>
<li>Bind events to elements that will be rendered in the future</li>
</ul>
<p>Examples</p>

<p><strong>Simple event binding</strong></p>

<div class="highlight highlight-javascript"><pre><span class="c1">// When any &lt;p&gt; tag is clicked, we expect to see '&lt;p&gt; was clicked' in the console.</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"p"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"&lt;p&gt; was clicked"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><strong>Many events, but only one event handler</strong></p>

<p>Suppose you want to trigger the same event whenever the mouse hovers over or leaves the selected elements. The best practice for this is to use "mouseenter mouseleave". </p>

<blockquote>
<p>Note the difference between this and the next example.</p>
</blockquote>

<div class="highlight highlight-javascript"><pre><span class="c1">// When a user focuses on or changes any input element, we expect a console message</span>
<span class="c1">// bind to multiple events</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"div"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseenter mouseleave"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"mouse hovered over or left a div"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><strong>Many events and handlers</strong></p>

<p>Suppose that instead you want different event handlers for when the mouse enters and leaves an element. This is more common than the previous example. For example, if you want to show and hide a tooltip on hover, you would use this.</p>

<p>.on() accepts an object containing multiple events and handlers.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"div"</span><span class="p">).</span><span class="nx">on</span><span class="p">({</span>
    <span class="nx">mouseenter</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"hovered over a div"</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">mouseleave</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"mouse left a div"</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">click</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"clicked on a div"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><strong>The event object</strong></p>

<p>Handling events can be tricky. It's often helpful to use the extra information contained in the event object passed to the event handler for more control. To become familiar with the event object, use this code to inspect it in your browser console after you click on a div in the page.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"div"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"event object:"</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><strong>Passing data to the event handler</strong></p>

<p>You can pass your own data to the event object.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"p"</span> <span class="p">).</span><span class="nx">on</span><span class="p">(</span> <span class="s2">"click"</span><span class="p">,</span> <span class="p">{</span> <span class="nx">foo</span><span class="o">:</span> <span class="s2">"bar"</span>  <span class="p">},</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">"event data: "</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">foo</span> <span class="o">+</span> <span class="s2">" (should be 'bar')"</span> <span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><strong>Binding events to elements that don't exist yet</strong></p>

<p>This is called event delegation. Here's an example just for completeness, but see the page on Event Delegation for a full explanation.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">"ul"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="s2">"li"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Something in a &lt;ul&gt; was clicked, and we detected that it was an &lt;li&gt; element."</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><strong>Connecting Events to Run Only Once</strong></p>

<p>Sometimes you need a particular handler to run only once — after that, you may want no handler to run, or you may want a different handler to run. jQuery provides the .one() method for this purpose.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Switching handlers using the `.one()` method</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"p"</span><span class="p">).</span><span class="nx">one</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"You just clicked this for the first time!"</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"You have clicked this before!"</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>The .one() method is especially useful if you need to do some complicated setup the first time an element is clicked, but not subsequent times.</p>

<p>.one() accepts the same arguments as .on() which means it supports multiple events to one or multiple handlers, passing custom data and event delegation.</p>

<p><strong>Disconnecting Events</strong></p>

<p>Although all the fun of jQuery occurs in the .on() method, it's counterpart is just as important if you want to be a responsible developer. .off() cleans up that event binding when you don't need it anymore. Complex user interfaces with lots of event bindings can bog down browser performance, so using the .off() method diligently is a best practice to ensure that you only have the event bindings that you need, when you need them.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Unbinding all click handlers on a selection</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"p"</span> <span class="p">).</span><span class="nx">off</span><span class="p">(</span> <span class="s2">"click"</span> <span class="p">);</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// Unbinding a particular click handler, using a reference to the function</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"p"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="nx">foo</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="nx">bar</span><span class="p">);</span>
<span class="c1">// foo will stay bound to the click event</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"p"</span><span class="p">).</span><span class="nx">off</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="nx">bar</span><span class="p">);</span>
</pre></div>

<p><strong>Namespacing Events</strong></p>

<p>For complex applications and for plugins you share with others, it can be useful to namespace your events so you don't unintentionally disconnect events that you didn't or couldn't know about. For details, see Event Namespacing.</p>

<h4>Inside the Event Handling Function</h4>

<p>Every event handling function receives an event object, which contains many properties and methods. The event object is most commonly used to prevent the default action of the event via the .preventDefault() method. However, the event object contains a number of other useful properties and methods, including:</p>

<p><strong>pageX, pageY</strong></p>

<p>The mouse position at the time the event occurred, relative to the top left of the page.</p>

<p><strong>type</strong></p>

<p>The type of the event (e.g. "click").</p>

<p><strong>which</strong></p>

<p>The button or key that was pressed.</p>

<p><strong>data</strong></p>

<p>Any data that was passed in when the event was bound.</p>

<p><strong>target</strong></p>

<p>The DOM element that initiated the event.</p>

<p><strong>preventDefault()</strong></p>

<p>Prevent the default action of the event (e.g. following a link).</p>

<p><strong>stopPropagation()</strong></p>

<p>Stop the event from bubbling up to other elements.</p>

<p>In addition to the event object, the event handling function also has access to the DOM element that the handler was bound to via the keyword this. To turn the DOM element into a jQuery object that we can use jQuery methods on, we simply do $( this ), often following this idiom:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// Preventing a link from being followed</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"href"</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="s2">"evil"</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="nx">elem</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"evil"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<h4>Understanding Event Delegation</h4>

<p>Event delegation allows us to attach a single event listener, to a parent element, that will fire for all descendants matching a selector, whether those descendants exist now or are added in the future.</p>

<p><strong>Example</strong></p>

<p>For the remainder of the lesson, we will reference the following HTML structure:</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"list"</span><span class="nt">&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"http://domain1.com"</span><span class="nt">&gt;</span>Item #1<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/local/path/1"</span><span class="nt">&gt;</span>Item #2<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/local/path/2"</span><span class="nt">&gt;</span>Item #3<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"http://domain4.com"</span><span class="nt">&gt;</span>Item #4<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p>When an anchor in our #list group is clicked, we want to log its text to the console. Normally we could directly bind to the click event of each anchor using the .on() method:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// attach a directly bound event</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#list a"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<p>While this works perfectly fine, there are drawbacks. Consider what happens when we add a new anchor after having already bound the above listener:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// add a new element on to our existing list</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"#list"</span> <span class="p">).</span><span class="nx">append</span><span class="p">(</span> <span class="s2">"&lt;li&gt;&lt;a href='http://newdomain.com'&gt;Item #5&lt;/a&gt;&lt;/li&gt;"</span> <span class="p">);</span>
</pre></div>

<p>If we were to click our newly added item, nothing would happen. This is because of the directly bound event handler that we attached previously. Direct events are only attached to elements at the time the .on() method is called. In this case, since our new anchor did not exist when .on() was called, it does not get the event handler.</p>

<p><strong>Event Propagation</strong></p>

<p>Understanding how events propagate is an important factor in being able to leverage Event Delegation. Any time one of our anchor tags is clicked, a click event is fired for that anchor, and then bubbles up the DOM tree, triggering each of its parent click event handlers:</p>

<div class="highlight highlight-html"><pre>    <span class="nt">&lt;a&gt;</span>
    <span class="nt">&lt;li&gt;</span>
    <span class="nt">&lt;ul</span> <span class="err">#</span><span class="na">list</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="err">#</span><span class="na">container</span><span class="nt">&gt;</span>
    <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;html&gt;</span>
    document root
</pre></div>

<p>This means that anytime you click one of our bound anchor tags, you are effectively clicking the entire document body! This is called event bubbling or event propagation.</p>

<p>Since we know how events bubble, we can create a delegated event: </p>

<div class="highlight highlight-javascript"><pre><span class="c1">// attach a delegated event</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#list"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<p>Notice how we have moved the a part from the selector to the second parameter position of the .on() method. This second, selector parameter tells the handler to listen for the specified event, and when it hears it, check to see if the triggering element for that event matches the second parameter. In this case, the triggering event is our anchor tag, which matches that parameter. Since it matches, our anonymous function will execute. We have now attached a single click event listener to our ul that will listen for clicks on its descendant anchors, instead of attaching an unknown number of directly bound events to the existing anchor tags only.</p>

<p><strong>Using the Triggering Element</strong></p>

<p>What if we wanted to open the link in a new window if that link is an external one (as denoted here by beginning with "http")? </p>

<div class="highlight highlight-javascript"><pre><span class="c1">// attach a delegated event</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#list"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">"[href^='http']"</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">elem</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"target"</span><span class="p">,</span> <span class="s2">"_blank"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>This simply passes the .is() method a selector to see if the href attribute of the element starts with "http". We have also removed the event.preventDefault(); statement as we want the default action to happen (which is to follow the href).</p>

<p>We can actually simplify our code by allowing the selector parameter of .on() do our logic for us:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// attach a delegated event with a more refined selector</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#list"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="s2">"a[href^='http']"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"target"</span><span class="p">,</span> <span class="s2">"_blank"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><strong>Summary</strong></p>

<p>Event delegation refers to the process of using event propagation (bubbling) to handle events at a higher level in the DOM than the element on which the event originated. It allows us to attach a single event listener for elements that exist now or in the future.</p>

<h4>Triggering Event Handlers</h4>

<p>jQuery provides a way to trigger the event handlers bound to an element without any user interaction via the .trigger() method.</p>

<p><strong>What handlers can be .trigger()'d?</strong></p>

<p>jQuery's event handling system is a layer on top of native browser events. When an event handler is added using .on( "click", function() {...} ), it can be triggered using jQuery's .trigger( "click" ) because jQuery stores a reference to that handler when it is originally added. Additionally, it will trigger the JavaScript inside the onclick attribute. The .trigger() function cannot be used to mimic native browser events, such as clicking on a file input box or an anchor tag. This is because, there is no event handler attached using jQuery's event system that corresponds to these events.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://learn.jquery.com"</span><span class="nt">&gt;</span>Learn jQuery<span class="nt">&lt;/a&gt;</span>
</pre></div>

<div class="highlight highlight-html"><pre>// This will not change the current page
$( "a" ).trigger( "click" );
</pre></div>

<p><strong>How can I mimic a native browser event, if not .trigger()?</strong></p>

<p>In order to trigger a native browser event, you have to use document.createEventObject for Internet Explorer less than version 9 and document.createEvent for all other browsers. Using these two APIs, you can programmatically create an event that behaves exactly as if someone has actually clicked on a file input box. The default action will happen, and the browse file dialog will display.</p>

<p>The jQuery UI Team created jquery.simulate.js in order to simplify triggering a native browser event for use in their automated testing. Its usage is modeled after jQuery's trigger.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Triggering a native browser event using the simulate plugin</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"a"</span> <span class="p">).</span><span class="nx">simulate</span><span class="p">(</span> <span class="s2">"click"</span> <span class="p">);</span>
</pre></div>

<p>This will not only trigger the jQuery event handlers, but also follow the link and change the current page.</p>

<p><strong>.trigger() vs .triggerHandler()</strong></p>

<p>There are four differences between .trigger() and .triggerHandler()</p>

<ol class="task-list">
<li>.triggerHandler() only triggers the event on the first element of a jQuery object.</li>
<li>.triggerHandler() cannot be chained. It returns the value that is returned by the last handler, not a jQuery object.</li>
<li>.triggerHandler() will not cause the default behavior of the event (such as a form submission).</li>
<li>Events triggered by .triggerHandler(), will not bubble up the DOM hierarchy. Only the handlers on the single element will fire.</li>
</ol>
<p><strong>Don't use .trigger() simply to execute specific functions</strong></p>

<p>While this method has its uses, it should not be used simply to call a function that was bound as a click handler. Instead, you should store the function you want to call in a variable, and pass the variable name when you do your binding. Then, you can call the function itself whenever you want, without the need for .trigger().</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Triggering an event handler the right way</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"this didn't come from an event!"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"p"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="nx">foo</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">();</span> <span class="c1">// instead of $( "p" ).trigger( "click" )</span>
</pre></div>

<p>A more complex architecture can built on top of trigger using the publish-subscribe pattern using jQuery plugins. With this technique, .trigger() can be used to notify other sections of code that an application specific event has happened.</p>

<h4>Custom Events</h4>

<p>We're all familiar with the basic events — click, mouseover, focus, blur, submit, etc. — that we can latch on to as a user interacts with the browser. Custom events open up a whole new world of event-driven programming. </p>

<p>It can be difficult at first to understand why you'd want to use custom events, when the built-in events seem to suit your needs just fine. It turns out that custom events offer a whole new way of thinking about event-driven JavaScript. Instead of focusing on the element that triggers an action, custom events put the spotlight on the element being acted upon. This brings a bevy of benefits, including:</p>

<ul class="task-list">
<li>Behaviors of the target element can easily be triggered by different elements using the same code.</li>
<li>Behaviors can be triggered across multiple, similar, target elements at once.</li>
<li>Behaviors are more clearly associated with the target element in code, making code easier to read and maintain.</li>
</ul>
<p><strong>Recap: .on() and .trigger()</strong></p>

<p>In the world of custom events, there are two important jQuery methods: .on() and .trigger(). In the Events chapter, we saw how to use these methods for working with user events; for this chapter, it's important to remember two things:</p>

<ul class="task-list">
<li><p>.on() method takes an event type and an event handling function as arguments. Optionally, it can also receive event-related data as its second argument, pushing the event handling function to the third argument. Any data that is passed will be available to the event handling function in the data property of the event object. The event handling function always receives the event object as its first argument.</p></li>
<li><p>.trigger() method takes an event type as its argument. Optionally, it can also take an array of values. These values will be passed to the event handling function as arguments after the event object.</p></li>
</ul>
<p>Here is an example of the usage of .on() and .trigger() that uses custom data in both cases:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"myCustomEvent"</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">foo</span> <span class="o">:</span> <span class="s2">"bar"</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// "bar"</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arg1</span><span class="p">);</span> <span class="c1">// "bim"</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arg2</span><span class="p">);</span> <span class="c1">// "baz"</span>
<span class="p">});</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">"myCustomEvent"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"bim"</span><span class="p">,</span> <span class="s2">"baz"</span><span class="p">]);</span>
</pre></div>

<a name="ajax"><h3>Ajax</h3></a>

<p><a href="https://camo.githubusercontent.com/ac4af348e0bf47a5f249fd22fcec8c4317d78c71/687474703a2f2f692e696d6775722e636f6d2f507942335761522e706e67" target="_blank"><img src="https://camo.githubusercontent.com/ac4af348e0bf47a5f249fd22fcec8c4317d78c71/687474703a2f2f692e696d6775722e636f6d2f507942335761522e706e67" alt="" data-canonical-src="http://i.imgur.com/PyB3WaR.png" style="max-width:100%;"></a></p>

<p><em>(Courtesy: Jonas Jacobi)</em></p>

<p>Traditionally webpages required reloading to update their content. For web-based email this meant that users had to manually reload their inbox to check and see if they had new mail. This had huge drawbacks: it was slow and it required user input. When the user reloaded their inbox, the server had to reconstruct the entire web page and resend all of the HTML, CSS, JavaScript, as well as the user's email. This was hugely inefficient. Ideally, the server should only have to send the user's new messages, not the entire page. By 2003, all the major browsers solved this issue by adopting the XMLHttpRequest (XHR) object, allowing browsers to communicate with the server without requiring a page reload.</p>

<p>The XMLHttpRequest object is part of a technology called Ajax (Asynchronous JavaScript and XML). Using Ajax, data could then be passed between the browser and the server, using the XMLHttpRequest API, without having to reload the web page. With the widespread adoption of the XMLHttpRequest object it quickly became possible to build web applications like Google Maps, and Gmail that used XMLHttpRequest to get new map tiles, or new email without having to reload the entire page.</p>

<p>Ajax requests are triggered by JavaScript code; your code sends a request to a URL, and when it receives a response, a callback function can be triggered to handle the response. Because the request is asynchronous, the rest of your code continues to execute while the request is being processed, so it's imperative that a callback be used to handle the response.</p>

<p>Unfortunately, different browsers implement the Ajax API differently. Typically this meant that developers would have to account for all the different browsers to ensure that Ajax would work universally. Fortunately, jQuery provides Ajax support that abstracts away painful browser differences. It offers both a full-featured $.ajax() method, and simple convenience methods such as $.get(), $.getScript(), $.getJSON(), $.post(), and $().load().</p>

<p>Most jQuery applications don't in fact use XML, despite the name "Ajax"; instead, they transport data as plain HTML or JSON (JavaScript Object Notation).</p>

<p>In general, Ajax does not work across domains. For instance, a webpage loaded from example1.com is unable to make an Ajax request to example2.com as it would violate the same origin policy. As a work around, JSONP (JSON with Padding) uses script tags to load files containing arbitrary JavaScript content and JSON, from another domain. More recently browsers have implemented a technology called Cross-Origin Resource Sharing (CORS), that allows Ajax requests to different domains.</p>

<h4>Key Concepts</h4>

<p>Proper use of Ajax-related jQuery methods requires understanding some key concepts first.</p>

<p><strong>GET vs. POST</strong></p>

<p>The two most common "methods" for sending a request to a server are GET and POST. It's important to understand the proper application of each.</p>

<p>The GET method should be used for non-destructive operations — that is, operations where you are only "getting" data from the server, not changing data on the server. For example, a query to a search service might be a GET request. GET requests may be cached by the browser, which can lead to unpredictable behavior if you are not expecting it. GET requests generally send all of their data in a query string.</p>

<p>The POST method should be used for destructive operations — that is, operations where you are changing data on the server. For example, a user saving a blog post should be a POST request. POST requests are generally not cached by the browser; a query string can be part of the URL, but the data tends to be sent separately as post data.</p>

<p><strong>Data Types</strong></p>

<p>jQuery generally requires some instruction as to the type of data you expect to get back from an Ajax request; in some cases the data type is specified by the method name, and in other cases it is provided as part of a configuration object. </p>

<p>There are several options:</p>

<p><strong>text</strong></p>

<p>For transporting simple strings.</p>

<p><strong>html</strong></p>

<p>For transporting blocks of HTML to be placed on the page.</p>

<p><strong>script</strong></p>

<p>For adding a new script to the page.</p>

<p><strong>json</strong></p>

<p>For transporting JSON-formatted data, which can include strings, arrays, and objects.</p>

<p>Note: As of jQuery 1.4, if the JSON data sent by your server isn't properly formatted, the request may fail silently. See <a href="http://json.org">http://json.org</a> for details on properly formatting JSON, but as a general rule, use built-in language methods for generating JSON on the server to avoid syntax issues.</p>

<p><strong>jsonp</strong></p>

<p>For transporting JSON data from another domain.</p>

<p><strong>xml</strong></p>

<p>For transporting data in a custom XML schema.</p>

<p>I am a strong proponent of using the JSON format in most cases, as it provides the most flexibility. It is especially useful for sending both HTML and data at the same time.</p>

<p><strong>A is for Asynchronous</strong></p>

<p>The asynchronicity of Ajax catches many new jQuery users off guard. Because Ajax calls are asynchronous by default, the response is not immediately available. Responses can only be handled using a callback. So, for example, the following code will not work:</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">response</span><span class="p">;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"foo.php"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span> <span class="c1">// undefined</span>
</pre></div>

<p>Instead, we need to pass a callback function to our request; this callback will run when the request succeeds, at which point we can access the data that it returned, if any.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"foo.php"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span> <span class="c1">// server response</span>
<span class="p">});</span>
</pre></div>

<p><strong>Same-Origin Policy and JSONP</strong></p>

<p>In general, Ajax requests are limited to the same protocol (http or https), the same port, and the same domain as the page making the request. This limitation does not apply to scripts that are loaded via jQuery's Ajax methods.</p>

<p>The other exception is requests targeted at a JSONP service on another domain. In the case of JSONP, the provider of the service has agreed to respond to your request with a script that can be loaded into the page using a script tag, thus avoiding the same-origin limitation; that script will include the data you requested, wrapped in a callback function you provide.</p>

<p><strong>Ajax and Firebug</strong></p>

<p>Firebug (or the Webkit Inspector in Chrome or Safari) is an invaluable tool for working with Ajax requests. You can see Ajax requests as they happen in the Console tab of Firebug (and in the Resources &gt; XHR panel of Webkit Inspector), and you can click on a request to expand it and see details such as the request headers, response headers, response content, and more. If something isn't going as expected with an Ajax request, this is the first place to look to track down what's wrong.</p>

<h4>jQuery’s Ajax-Related Methods</h4>

<p>While jQuery does offer many Ajax-related convenience methods, the core $.ajax() method is at the heart of all of them, and understanding it is imperative. We'll review it first, and then touch briefly on the convenience methods.</p>

<p>I generally use the $.ajax() method and do not use convenience methods. As you'll see, it offers features that the convenience methods do not, and its syntax is more easily understandable, in my opinion.</p>

<p><strong>$.ajax()</strong></p>

<p>jQuery’s core $.ajax() method is a powerful and straightforward way of creating Ajax requests. It takes a configuration object that contains all the instructions jQuery requires to complete the request. The $.ajax() method is particularly valuable because it offers the ability to specify both success and failure callbacks. Also, its ability to take a configuration object that can be defined separately makes it easier to write reusable code. For complete documentation of the configuration options, visit <a href="http://api.jquery.com/jQuery.ajax/">http://api.jquery.com/jQuery.ajax/</a>.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using the core $.ajax() method</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="c1">// the URL for the request</span>
    <span class="nx">url</span> <span class="o">:</span> <span class="s2">"post.php"</span><span class="p">,</span>
    <span class="c1">// the data to send (will be converted to a query string)</span>
    <span class="nx">data</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">id</span> <span class="o">:</span> <span class="mi">123</span>
    <span class="p">},</span>
    <span class="c1">// whether this is a POST or GET request</span>
    <span class="nx">type</span> <span class="o">:</span> <span class="s2">"GET"</span><span class="p">,</span>
    <span class="c1">// the type of data we expect back</span>
    <span class="nx">dataType</span> <span class="o">:</span> <span class="s2">"json"</span><span class="p">,</span>
    <span class="c1">// code to run if the request succeeds;</span>
    <span class="c1">// the response is passed to the function</span>
    <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;h1/&gt;"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">title</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s2">"body"</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;div class=\"content\"/&gt;"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">html</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s2">"body"</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="c1">// code to run if the request fails; the raw request and</span>
    <span class="c1">// status codes are passed to the function</span>
    <span class="nx">error</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"Sorry, there was a problem!"</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Error: "</span> <span class="o">+</span> <span class="nx">errorThrown</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Status: "</span> <span class="o">+</span> <span class="nx">status</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">xhr</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="c1">// code to run regardless of success or failure</span>
    <span class="nx">complete</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"The request is complete!"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>A note about the dataType setting: if the server sends back data that is in a different format than you specify, your code may fail, and the reason will not always be clear, because the HTTP response code will not show an error. When working with Ajax requests, make sure your server is sending back the data type you're asking for, and verify that the Content-type header is accurate for the data type. For example, for JSON data, the Content-type header should be application/json.</p>
</blockquote>

<p><strong>$.ajax() Options</strong></p>

<p>There are many, many options for the $.ajax() method, which is part of its power. For a complete list of options, visit <a href="http://api.jquery.com/jQuery.ajax/">http://api.jquery.com/jQuery.ajax/</a>; here are several that you will use frequently:</p>

<p><strong>async</strong></p>

<p>Set to false if the request should be sent synchronously. Defaults to true. </p>

<blockquote>
<p>Note that if you set this option to false, your request will block execution of other code until the response is received.</p>
</blockquote>

<p><strong>cache</strong></p>

<p>Whether to use a cached response if available. Defaults to true for all dataTypes except "script" and "jsonp". When set to false, the URL will simply have a cachebusting parameter appended to it.</p>

<p><strong>complete</strong></p>

<p>A callback function to run when the request is complete, regardless of success or failure. The function receives the raw request object and the text status of the request.</p>

<p><strong>context</strong></p>

<p>The scope in which the callback function(s) should run (i.e. what this will mean inside the callback function(s)). By default, this inside the callback function(s) refers to the object originally passed to $.ajax().</p>

<p><strong>data</strong></p>

<p>The data to be sent to the server. This can either be an object or a query string, such as foo=bar&amp;baz=bim.</p>

<p><strong>dataType</strong></p>

<p>The type of data you expect back from the server. By default, jQuery will look at the MIME type of the response if no dataType is specified.</p>

<p><strong>error</strong></p>

<p>A callback function to run if the request results in an error. The function receives the raw request object and the text status of the request.</p>

<p><strong>jsonp</strong></p>

<p>The callback name to send in a query string when making a JSONP request. Defaults to "callback".</p>

<p><strong>success</strong></p>

<p>A callback function to run if the request succeeds. The function receives the response data (converted to a JavaScript object if the dataType was JSON), as well as the text status of the request and the raw request object.</p>

<p><strong>timeout</strong></p>

<p>The time in milliseconds to wait before considering the request a failure.</p>

<p><strong>traditional</strong></p>

<p>Set to true to use the param serialization style in use prior to jQuery 1.4. For details, see <a href="http://api.jquery.com/jQuery.param/">http://api.jquery.com/jQuery.param/</a>.</p>

<p><strong>type</strong></p>

<p>The type of the request, "POST" or "GET". Defaults to "GET". Other request types, such as "PUT" and "DELETE" can be used, but they may not be supported by all browsers.</p>

<p><strong>url</strong></p>

<p>The URL for the request.</p>

<p>The url option is the only required property of the $.ajax() configuration object; all other properties are optional. This can also be passed as the first argument to $.ajax(), and the options object as the second argument.</p>

<p><strong>Convenience Methods</strong></p>

<p>If you don't need the extensive configurability of $.ajax(), and you don't care about handling errors, the Ajax convenience functions provided by jQuery can be useful, terse ways to accomplish Ajax requests. These methods are just "wrappers" around the core $.ajax() method, and simply pre-set some of the options on the $.ajax() method.</p>

<p>The convenience methods provided by jQuery are:</p>

<p><strong>$.get</strong></p>

<p>Perform a GET request to the provided URL.</p>

<p><strong>$.post</strong></p>

<p>Perform a POST request to the provided URL.</p>

<p><strong>$.getScript</strong></p>

<p>Add a script to the page.</p>

<p><strong>$.getJSON</strong></p>

<p>Perform a GET request, and expect JSON to be returned.</p>

<p>In each case, the methods take the following arguments, in order:</p>

<p><strong>url</strong></p>

<p>The URL for the request. Required.</p>

<p><strong>data</strong></p>

<p>The data to be sent to the server. Optional. This can either be an object or a query string, such as foo=bar&amp;baz=bim.</p>

<blockquote>
<p>Note: This option is not valid for $.getScript.</p>
</blockquote>

<p><strong>success callback</strong></p>

<p>A callback function to run if the request succeeds. Optional. The function receives the response data (converted to a JavaScript object if the data type was JSON), as well as the text status of the request and the raw request object.</p>

<p><strong>data type</strong></p>

<p>The type of data you expect back from the server. Optional.</p>

<blockquote>
<p>Note: This option is only applicable for methods that don't already specify the data type in their name.</p>
</blockquote>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using jQuery's Ajax convenience methods</span>
<span class="c1">// get plain text or HTML</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/users.php"</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">userId</span> <span class="o">:</span> <span class="mi">1234</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">resp</span><span class="p">);</span> <span class="c1">// server response</span>
<span class="p">});</span>
<span class="c1">// add a script to the page, then run a function defined in it</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">getScript</span><span class="p">(</span><span class="s2">"/static/js/myScript.js"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">functionFromMyScript</span><span class="p">();</span>
<span class="p">});</span>
<span class="c1">// get JSON-formatted data from the server</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s2">"/details.php"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// log each key in the response data</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">resp</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">key</span> <span class="o">+</span> <span class="s2">" : "</span> <span class="o">+</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><strong>$.fn.load</strong></p>

<p>The .load() method is unique among jQuery’s Ajax methods in that it is called on a selection. The .load() method fetches HTML from a URL, and uses the returned HTML to populate the selected element(s). In addition to providing a URL to the method, you can optionally provide a selector; jQuery will fetch only the matching content from the returned HTML.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using $.fn.load to populate an element</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"#newContent"</span> <span class="p">).</span><span class="nx">load</span><span class="p">(</span> <span class="s2">"/foo.html"</span> <span class="p">);</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using $.fn.load to populate an element based on a selector</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#newContent"</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span><span class="s2">"/foo.html #myDiv h1:first"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Content updated!"</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Ajax and Forms</h4>

<p>jQuery's ajax capabilities can be especially useful when dealing with forms. There are several advantages, which can range from serialization, to simple client-side validation (e.g. "Sorry, that username is taken"), to prefilters (explained below), and even more!</p>

<p><strong>Serialization</strong></p>

<p>Serializing form inputs in jQuery is extremely easy. Two methods come supported natively: .serialize() and .serializeArray(). While the names are fairly self-explanatory, there are many advantages to using them.</p>

<p>The .serialize() method serializes a form's data into a query string. For the element's value to be serialized, it must have a name attribute. Please note that values from inputs with a type of checkbox or radio are included only if they are checked.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Turning form data into a query string</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"#myForm"</span> <span class="p">).</span><span class="nx">serialize</span><span class="p">();</span>
<span class="c1">// creates a query string like this:</span>
<span class="c1">// field_1=something&amp;field2=somethingElse</span>
</pre></div>

<p>While plain old serialization is great, sometimes your application would work better if you sent over an array of objects, instead of just the query string. For that, jQuery has the .serializeArray() method. It's very similar to the .serialize() method listed above, except it produces an array of objects, instead of a string.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Creating an array of objects containing form data</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"#myForm"</span> <span class="p">).</span><span class="nx">serializeArray</span><span class="p">();</span>
<span class="c1">// creates a structure like this:</span>
<span class="c1">// [</span>
<span class="c1">// {</span>
<span class="c1">// name : "field_1",</span>
<span class="c1">// value : "something"</span>
<span class="c1">// },</span>
<span class="c1">// {</span>
<span class="c1">// name : "field_2",</span>
<span class="c1">// value : "somethingElse"</span>
<span class="c1">// }</span>
<span class="c1">// ]</span>
</pre></div>

<p><strong>Client-side validation</strong></p>

<p>Client-side validation is, much like many other things, extremely easy using jQuery. While there are several cases developers can test for, some of the most common ones are: presence of a required input, valid usernames/emails/phone numbers/etc…, or checking an "I agree…" box.</p>

<blockquote>
<p>Please note that it is advisable that you also perform server-side validation for your inputs. However, it typically makes for a better user experience to be able to validate some things without submitting the form.</p>
</blockquote>

<p>With that being said, let's jump on in to some examples! First, we'll see how easy it is to check if a required field doesn't have anything in it. If it doesn't, then we'll return false, and prevent the form from processing.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using validation to check for the presence of an input</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#form"</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// if .required's value's length is zero</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">".required"</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// usually show some kind of error message here</span>
        <span class="c1">// this prevents the form from submitting</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// run $.ajax here</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>Let's see how easy it is to check for invalid characters in a phone number:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Validate a phone number field</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#form"</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">inputtedPhoneNumber</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#phone"</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="c1">// match only numbers</span>
    <span class="kd">var</span> <span class="nx">phoneNumberRegex</span> <span class="o">=</span> <span class="sr">/^\d*$/</span><span class="p">;</span>
    <span class="c1">// if the phone number doesn't match the regex</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">phoneNumberRegex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">inputtedPhoneNumber</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// usually show some kind of error message here</span>
        <span class="c1">// prevent the form from submitting</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// run $.ajax here</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><strong>Prefiltering</strong></p>

<p>A prefilter is a way to modify the ajax options before each request is sent (hence, the name prefilter).</p>

<p>For example, say we would like to modify all cross-domain requests through a proxy. To do so with a prefilter is quite simple:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using a proxy with a prefilter</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajaxPrefilter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">originalOptions</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">crossDomain</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="s2">"http://mydomain.net/proxy/"</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">crossDomain</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>You can pass in an optional argument before the callback function that specifies which dataTypes you'd like the prefilter to be applied to. For example, if we want our prefilter to only apply to JSON and script requests, we'd do:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using the optional dataTypes argument</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajaxPrefilter</span><span class="p">(</span><span class="s2">"json script"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">originalOptions</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do all of the prefiltering here, but only for</span>
    <span class="c1">// requests that indicate a dataType of "JSON" or "script"</span>
<span class="p">});</span>
</pre></div>

<h4>Working with JSONP</h4>

<p>The advent of JSONP — essentially a consensual cross-site scripting hack — has opened the door to powerful mashups of content. Many prominent sites provide JSONP services, allowing you access to their content via a predefined API. A particularly great source of JSONP-formatted data is the Yahoo! Query Language, which we'll use in the following example to fetch news about cats.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Using YQL and JSONP</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="nx">url</span> <span class="o">:</span> <span class="s2">"http://query.yahooapis.com/v1/public/yql"</span><span class="p">,</span>
    <span class="c1">// the name of the callback parameter, as specified by the YQL service</span>
    <span class="nx">jsonp</span> <span class="o">:</span> <span class="s2">"callback"</span><span class="p">,</span>
    <span class="c1">// tell jQuery we're expecting JSONP</span>
    <span class="nx">dataType</span> <span class="o">:</span> <span class="s2">"jsonp"</span><span class="p">,</span>
    <span class="c1">// tell YQL what we want and that we want JSON</span>
    <span class="nx">data</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">q</span> <span class="o">:</span> <span class="s2">"select title,abstract,url from search.news where query=\"cat\""</span><span class="p">,</span>
        <span class="nx">format</span> <span class="o">:</span> <span class="s2">"json"</span>
    <span class="p">},</span>
    <span class="c1">// work with the response</span>
    <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span> <span class="c1">// server response</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>jQuery handles all the complex aspects of JSONP behind-the-scenes — all we have to do is tell jQuery the name of the JSONP callback parameter specified by YQL ("callback" in this case), and otherwise the whole process looks and feels like a normal Ajax request.</p>

<h4>Ajax Events</h4>

<p>Often, you'll want to perform an operation whenever an Ajax requests starts or stops, such as showing or hiding a loading indicator. Rather than defining this behavior inside every Ajax request, you can bind Ajax events to elements just like you'd bind other events. For a complete list of Ajax events, visit Ajax Events documentation on docs.jquery.com.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// Setting up a loading indicator using Ajax Events</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#loading_indicator"</span><span class="p">).</span><span class="nx">ajaxStart</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
<span class="p">}).</span><span class="nx">ajaxStop</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<a name="fp"><h3>Functional Programming</h3></a>

<blockquote>
<p>Note: Functional programming in this book mainly refers to JavaScript context but the principles are the same.</p>
</blockquote>

<h4>Getting Started with Functional Programming</h4>

<p>This chapter is courtesy of Michael Fogus, author of "Functional JavaScript" (O'Reilly).</p>

<p>You may have heard of functional programming on your favorite news aggregation site, or maybe you’ve worked in a language supporting functional techniques. If you’ve written JavaScript (and in this book I assume that you have) then you indeed have used a language supporting functional programming. However, that being the case, you might not have used JavaScript in a functional way. This book outlines a functional style of programming that aims to simplify your own libraries and applications, and helps tame the wild beast of JavaScript complexity.</p>

<p>As a bare-bones introduction, functional programming can be described in a single sentence:</p>

<blockquote>
<p>Functional programming is the use of functions that transform values into units of abstraction, subsequently used to build software systems.</p>
</blockquote>

<p>This is a simplification bordering on libel, but it’s functional (ha!) for this early stage in the book. The library that I use as my medium of functional expression in JavaScript is Underscore, and for the most part, it adheres to this basic definition. However, this definition fails to explain the “why” of functional programming.</p>

<h4>Why Functional Programming Matters</h4>

<blockquote>
<p>The major evolution that is still going on for me is towards a more functional programming style, which involves unlearning a lot of old habits, and backing away from some OOP directions.<br>
—John Carmack</p>
</blockquote>

<p>If you’re familiar with object-oriented programming, then you may agree that its primary goal is to break a problem into parts. Likewise, these parts/objects can be aggregated and composed to form larger parts. Based on these parts and their aggregates, a system is then described in terms of the interactions and values of the parts. This is a gross simplification of how object-oriented systems are formed, but I think that as a high-level description it works just fine. By comparison, a strict functional programming approach to solving problems also breaks a problem into parts (namely, functions).</p>

<blockquote>
<p>Whereas the object-oriented approach tends to break problems into groupings of “nouns,” or objects, a functional approach breaks the same problem into groupings of “verbs,” or functions. </p>
</blockquote>

<p>As with object-oriented programming, larger functions are formed by “gluing” or “composing” other functions together to build high-level behaviors. Finally, one way that the functional parts are formed into a system is by taking a value and gradually “transforming” it — via one primitive or composed function — into another.</p>

<p>In a system observing a strict object-oriented style, the interactions between objects cause internal change to each object, leading to an overall system state that is the amalgamation of many smaller, potentially subtle state changes. These interrelated state changes form a conceptual “web of change” that, at times, can be confusing to keep in your head. This confusion becomes a problem when the act of adding new objects and system features requires a working knowledge of the subtleties of potentially far-reaching state changes. </p>

<blockquote>
<p>A functional system, on the other hand, strives to minimize observable state modification. </p>
</blockquote>

<p>Therefore, adding new features to a system built using functional principles is a matter of understanding how new functions can operate within the context of localized, nondestructive (i.e., original data is never changed) data transformations. </p>

<p>However, I hesitate to create a false dichotomy and say that functional and object-oriented styles should stand in opposition. That JavaScript supports both models means that systems can and should be composed of both models. Finding the balance between functional and object-oriented styles is a tricky task that will be tackled much later in the book, when discussing mixins in Chapter 9. However, since this is a book about functional programming in JavaScript, the bulk of the discussion is focused on functional styles rather than object-oriented ones.</p>

<p>Having said that, a nice image of a system built along functional principles is an assembly-line device that takes raw materials in one end, and gradually builds a product that comes out the other end.</p>

<p>The assembly line analogy is, of course, not entirely perfect, because every machine I know consumes its raw materials to produce a product. By contrast, functional programming is what happens when you take a system built in an imperative way and shrink explicit state changes to the smallest possible footprint to make it more modular (Hughes 1984). </p>

<blockquote>
<p>Practical functional programming is not about eliminating state change, but instead about reducing the occurrences of mutation to the smallest area possible for any given system.</p>
</blockquote>

<p>To summarize the essence of functional programming, here are some key ideas:</p>

<ul class="task-list">
<li>functions as units of abstraction </li>
<li>functions as units of behavior</li>
<li>data as abstraction - UnderscoreJS/LoDash</li>
<li>data flow versus control flow (app logic versus control logic)</li>
<li>function chaining</li>
<li>functional reactive programming - see BaconJS</li>
</ul>

<a name="pbp"><h3>Promise-based Programming</h3></a>

<p><a href="https://camo.githubusercontent.com/dfc19da4e7bbb00bc5fe2f7536e57b10d7d166c3/687474703a2f2f692e696d6775722e636f6d2f444347486466352e706e67" target="_blank"><img src="https://camo.githubusercontent.com/dfc19da4e7bbb00bc5fe2f7536e57b10d7d166c3/687474703a2f2f692e696d6775722e636f6d2f444347486466352e706e67" alt="" data-canonical-src="http://i.imgur.com/DCGHdf5.png" style="max-width:100%;"></a></p>

<p><em>(Courtesy: <a href="http://blog.mediumequalsmessage.com/promise-deferred-objects-in-javascript-pt1-theory-and-semantics">Chris Webb</a>)</em></p>

<p>I will port <a href="https://github.com/raimohanska/bacon-devday-code">BaconJS tutorial</a> to promise-based programming using WhenJS via Browserify (well, it is not a full-blown port but it's functional).</p>

<blockquote>
<p>Note: The BaconJS tutorial includes Mockjax 1.5.1 which works for jQuery 1.8.0 only.</p>
</blockquote>

<p><a href="https://camo.githubusercontent.com/29dff10d582ca4e8d73945da515ad85a9ef4039e/687474703a2f2f692e696d6775722e636f6d2f50496c623773632e706e67" target="_blank"><img src="https://camo.githubusercontent.com/29dff10d582ca4e8d73945da515ad85a9ef4039e/687474703a2f2f692e696d6775722e636f6d2f50496c623773632e706e67" alt="" data-canonical-src="http://i.imgur.com/PIlb7sc.png" style="max-width:100%;"></a></p>

<p>Here are the specifications using BaconJS library:</p>

<pre><code>Disable button if username is missing
    define usernameEntered property
    assign side-effect: setDisabled for registerButton

Disable also if full name is missing
    define fullname and fullnameEntered properties
    use .and() to change the condition for enabling the button

Disable also if username unavailable
    include usernameAvailable to the condition for enabling the button

Show AJAX indicator when AJAX pending
    define usernameRequestPending property as usernameResponse.pending(usernameRequest)
    assign side effect to show usernameAjaxIndicator

Disable button when AJAX is pending

Implement registerClick stream
    tip: do(".preventDefault")

Implement registrationRequest
    combine username and password into a new property that would be the data given to JQuery.ajax
    can use username.combine(..) or Bacon.combineTemplate
    type: "POST"

Make this a stream of registration requests, send when the button is clicked
    .sampledBy(registerClick)

Create registrationResponse stream
    as in usernameResponse stream

Show feedback

Disable button after registration sent

Show ajax indicator for registration POST
</code></pre>

<p>My objectives here are twofold:</p>

<ol class="task-list">
<li>To show you a promise-based version of that tutorial without porting all the functionality found in BaconJS</li>
<li>To show coding around the event paradigm of jQuery (such as onClick event)</li>
</ol>
<p>Here is the HTML and BaconJS code of that tutorial.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"css/register.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"lib/jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"lib/jquery.mockjax.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"lib/Bacon.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"lib/Bacon.UI.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"mocks.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"login-container"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h1&gt;</span>Bacon Registration Form<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"username"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"username"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;em</span> <span class="na">class=</span><span class="s">"ajax"</span><span class="nt">&gt;&lt;/em&gt;</span>
        <span class="nt">&lt;em</span> <span class="na">id=</span><span class="s">"username-unavailable"</span> <span class="na">class=</span><span class="s">"tooltip"</span><span class="nt">&gt;</span>Username is unavailable<span class="nt">&lt;/em&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"fullname"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Full Name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"register"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button&gt;</span>Get some!<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;em</span> <span class="na">class=</span><span class="s">"ajax"</span><span class="nt">&gt;&lt;/em&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"result"</span><span class="nt">&gt;&lt;/span&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<div class="highlight highlight-javascript"><pre>    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"text/javascript"</span><span class="o">&gt;</span>
      <span class="kd">function</span> <span class="nx">show</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">}</span>
      <span class="kd">function</span> <span class="nx">nonEmpty</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">}</span>
      <span class="kd">function</span> <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="nx">visible</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="kd">function</span> <span class="nx">setEnabled</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"disabled"</span><span class="p">,</span> <span class="o">!</span><span class="nx">enabled</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="c1">// fields</span>
          <span class="nx">usernameField</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#username input"</span><span class="p">)</span>
          <span class="nx">fullnameField</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#fullname input"</span><span class="p">)</span>
          <span class="nx">registerButton</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#register button"</span><span class="p">)</span>
          <span class="nx">unavailabilityLabel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#username-unavailable"</span><span class="p">)</span>
          <span class="nx">usernameAjaxIndicator</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#username .ajax"</span><span class="p">)</span>
          <span class="nx">registerAjaxIndicator</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#register .ajax"</span><span class="p">)</span>

          <span class="c1">// username</span>
          <span class="nx">username</span> <span class="o">=</span> <span class="nx">Bacon</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">textFieldValue</span><span class="p">(</span><span class="nx">usernameField</span><span class="p">)</span>
          <span class="nx">usernameEntered</span> <span class="o">=</span> <span class="nx">username</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">nonEmpty</span><span class="p">)</span>
          <span class="nx">availabilityRequest</span> <span class="o">=</span> <span class="nx">username</span><span class="p">.</span><span class="nx">changes</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nx">nonEmpty</span><span class="p">).</span><span class="nx">skipDuplicates</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">throttle</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span> <span class="nx">url</span> <span class="o">:</span> <span class="s2">"/usernameavailable/"</span> <span class="o">+</span> <span class="nx">user</span> <span class="p">}</span> <span class="p">})</span>
          <span class="nx">availabilityResponse</span> <span class="o">=</span> <span class="nx">availabilityRequest</span><span class="p">.</span><span class="nx">ajax</span><span class="p">()</span>
          <span class="nx">usernameAvailable</span> <span class="o">=</span> <span class="nx">availabilityResponse</span><span class="p">.</span><span class="nx">toProperty</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
          <span class="nx">availabilityPending</span> <span class="o">=</span> <span class="nx">availabilityResponse</span><span class="p">.</span><span class="nx">pending</span><span class="p">(</span><span class="nx">availabilityRequest</span><span class="p">)</span>

          <span class="c1">// fullname</span>
          <span class="nx">fullname</span> <span class="o">=</span> <span class="nx">Bacon</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">textFieldValue</span><span class="p">(</span><span class="nx">fullnameField</span><span class="p">)</span>
          <span class="nx">fullnameEntered</span> <span class="o">=</span> <span class="nx">fullname</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">nonEmpty</span><span class="p">)</span>

          <span class="c1">// registration</span>
          <span class="nx">registerClick</span> <span class="o">=</span> <span class="nx">registerButton</span><span class="p">.</span><span class="nx">asEventStream</span><span class="p">(</span><span class="s2">"click"</span><span class="p">).</span><span class="k">do</span><span class="p">(</span><span class="s2">".preventDefault"</span><span class="p">)</span>
          <span class="nx">registrationRequest</span> <span class="o">=</span> <span class="nx">username</span><span class="p">.</span><span class="nx">combine</span><span class="p">(</span><span class="nx">fullname</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s2">"post"</span><span class="p">,</span>
                <span class="nx">url</span> <span class="o">:</span> <span class="s2">"/register"</span><span class="p">,</span>
                <span class="nx">contentType</span><span class="o">:</span> <span class="s2">"application/json"</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">u</span><span class="p">,</span> <span class="nx">fullname</span><span class="o">:</span> <span class="nx">f</span> <span class="p">})</span>
              <span class="p">}</span>
          <span class="p">}).</span><span class="nx">sampledBy</span><span class="p">(</span><span class="nx">registerClick</span><span class="p">)</span>
          <span class="nx">registrationResponse</span> <span class="o">=</span> <span class="nx">registrationRequest</span><span class="p">.</span><span class="nx">ajax</span><span class="p">()</span>
          <span class="nx">registrationPending</span> <span class="o">=</span> <span class="nx">registrationResponse</span><span class="p">.</span><span class="nx">pending</span><span class="p">(</span><span class="nx">registrationRequest</span><span class="p">)</span>
          <span class="nx">registrationSent</span> <span class="o">=</span> <span class="nx">registrationRequest</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">toProperty</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

          <span class="c1">// button enabled state</span>
          <span class="nx">buttonEnabled</span> <span class="o">=</span> <span class="nx">usernameEntered</span><span class="p">.</span><span class="nx">and</span><span class="p">(</span><span class="nx">fullnameEntered</span><span class="p">).</span><span class="nx">and</span><span class="p">(</span><span class="nx">usernameAvailable</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">and</span><span class="p">(</span><span class="nx">availabilityPending</span><span class="p">.</span><span class="nx">not</span><span class="p">()).</span><span class="nx">and</span><span class="p">(</span><span class="nx">registrationSent</span><span class="p">.</span><span class="nx">not</span><span class="p">())</span>

          <span class="c1">// side-effects</span>
          <span class="nx">buttonEnabled</span><span class="p">.</span><span class="nx">onValue</span><span class="p">(</span><span class="nx">setEnabled</span><span class="p">,</span> <span class="nx">registerButton</span><span class="p">)</span>
          <span class="nx">usernameAvailable</span><span class="p">.</span><span class="nx">not</span><span class="p">().</span><span class="nx">and</span><span class="p">(</span><span class="nx">availabilityPending</span><span class="p">.</span><span class="nx">not</span><span class="p">())</span>
            <span class="p">.</span><span class="nx">onValue</span><span class="p">(</span><span class="nx">setVisibility</span><span class="p">,</span> <span class="nx">unavailabilityLabel</span><span class="p">)</span>
          <span class="nx">availabilityPending</span><span class="p">.</span><span class="nx">onValue</span><span class="p">(</span><span class="nx">setVisibility</span><span class="p">,</span> <span class="nx">usernameAjaxIndicator</span><span class="p">)</span>
          <span class="nx">registrationPending</span><span class="p">.</span><span class="nx">onValue</span><span class="p">(</span><span class="nx">setVisibility</span><span class="p">,</span> <span class="nx">registerAjaxIndicator</span><span class="p">)</span>
          <span class="nx">registrationResponse</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="s2">"Thanks dude!"</span><span class="p">).</span><span class="nx">onValue</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">"#result"</span><span class="p">),</span> <span class="s2">"text"</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p>Here is the Promise-based version using <a href="https://github.com/cujojs/when">WhenJS</a> using the same HTML.</p>

<p>Why WhenJS?</p>

<p>I recommend you download the source code of <a href="https://github.com/tryghost/Ghost">Ghost blog platform</a> which offers a ton of examples using WhenJS.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">jqPromise</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">when</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'when'</span><span class="p">);</span>

    <span class="kd">function</span> <span class="nx">show</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">nonEmpty</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="nx">visible</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">setEnabled</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"disabled"</span><span class="p">,</span> <span class="o">!</span><span class="nx">enabled</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">registerButton</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#register button"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">unavailabilityLabel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#username-unavailable"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">usernameAjaxIndicator</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#username .ajax"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">registerAjaxIndicator</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#register .ajax"</span><span class="p">);</span>

    <span class="c1">//initialize</span>
    <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">usernameAjaxIndicator</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">registerAjaxIndicator</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="nx">setEnabled</span><span class="p">(</span><span class="nx">registerButton</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

    <span class="c1">//a deferred's resolve/reject and notify are mutually exclusive</span>

    <span class="kd">var</span> <span class="nx">fullname</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">usernameEntered</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">fullnameEntered</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">buttonEnabled</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">availabilityRequest</span> <span class="o">=</span> <span class="nx">when</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">jqAvailabilityRequest</span><span class="p">;</span> <span class="c1">//= $.Deferred();</span>
    <span class="kd">var</span> <span class="nx">availabilityPending</span> <span class="o">=</span> <span class="nx">when</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">usernameAvailable</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

    <span class="c1">//no availabilityResponse (less variables, the better)</span>

    <span class="kd">function</span> <span class="nx">setButtonEnabled</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">buttonEnabled</span> <span class="o">=</span> <span class="nx">when</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">usernameEntered</span><span class="p">,</span> <span class="nx">usernameAvailable</span><span class="p">,</span> <span class="nx">fullnameEntered</span><span class="p">);</span>

        <span class="nx">buttonEnabled</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">arrayBool</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//alert(arrayBool);</span>

            <span class="nx">len</span> <span class="o">=</span> <span class="nx">arrayBool</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span> <span class="o">&amp;&amp;</span> <span class="nx">arrayBool</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="nx">setEnabled</span><span class="p">(</span><span class="nx">registerButton</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>

        <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">//promises enable you to get out of the callback shell</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"#username input"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'keyup'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span> <span class="c1">//string</span>

        <span class="nx">username</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">nonEmpty</span><span class="p">(</span><span class="nx">user</span><span class="p">))</span> <span class="p">{</span>

            <span class="nx">usernameEntered</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

            <span class="c1">//simulate availabilityPending</span>
            <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">usernameAjaxIndicator</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

            <span class="c1">//jQuery AJAX calls implement a promise interface</span>
            <span class="nx">jqAvailabilityRequest</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/usernameavailable/"</span> <span class="o">+</span> <span class="nx">user</span><span class="p">);</span>

            <span class="nx">usernameAvailable</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="nx">jqAvailabilityRequest</span><span class="p">);</span>

            <span class="nx">usernameAvailable</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>

                <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">usernameAjaxIndicator</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

                <span class="c1">//when usernameavailable is false, show unavailabilityLabel</span>
                <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">unavailabilityLabel</span><span class="p">,</span> <span class="o">!</span><span class="nx">bool</span><span class="p">);</span>
            <span class="p">});</span>



        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">usernameEntered</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">setButtonEnabled</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="s2">"#fullname input"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'keyup'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">strFullname</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span> <span class="c1">//string</span>
        <span class="nx">fullname</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="nx">strFullname</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">nonEmpty</span><span class="p">(</span><span class="nx">strFullname</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">fullnameEntered</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">fullnameEntered</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">setButtonEnabled</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">registerButton</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">'disabled'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

        <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">registerAjaxIndicator</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">when</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">fullname</span><span class="p">);</span>


        <span class="nx">input</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="nx">type</span> <span class="o">:</span> <span class="s2">"post"</span><span class="p">,</span>
                <span class="nx">url</span> <span class="o">:</span> <span class="s2">"/register"</span><span class="p">,</span>
                <span class="nx">contentType</span> <span class="o">:</span> <span class="s2">"application/json"</span><span class="p">,</span>
                <span class="nx">data</span> <span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
                    <span class="nx">username</span> <span class="o">:</span> <span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="nx">fullname</span> <span class="o">:</span> <span class="nx">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">}),</span>
                <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Username: "</span> <span class="o">+</span> <span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">" Fullname: "</span> <span class="o">+</span> <span class="nx">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

                    <span class="nx">$</span><span class="p">(</span><span class="s2">"#username input"</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">"#fullname input"</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>

                    <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">registerAjaxIndicator</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

                    <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'demo3.html'</span><span class="p">,</span> <span class="s2">"_self"</span><span class="p">);</span>  <span class="c1">//refresh</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">});</span>


    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<h4>Lazy Evaluation</h4>

<p>The concept of promise-based programming is based on functional programming (FP). The key to understand FP is the concept of lazy evaluation. In this book, I will discuss about FP in the context of JavaScript language. Also, I'm going to discuss about promise-based programming in the context of WhenJS library (other libraries may have different syntax but the principles are the same).</p>

<blockquote>
<p>In imperative programming, you assign a value to a variable (<code>var str = 'string';</code>)</p>

<p>In functional programming, you assign a value to an object which you can evaluate later (hence lazy evaluation)</p>
</blockquote>

<p>For example,</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">buttonEnabled</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</pre></div>

<p>When you want to evaluate the Boolean value being hold by <code>buttonEnabled</code> object, you can use its "then" method like so.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">buttonEnabled</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>  <span class="c1">//false</span>
<span class="p">});</span>
</pre></div>

<p>In our example, see how we are able to capture state of three variables using promises without using a callback in two keyup event handlers .</p>

<div class="highlight highlight-javascript"><pre>    <span class="kd">function</span> <span class="nx">setButtonEnabled</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">buttonEnabled</span> <span class="o">=</span> <span class="nx">when</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">usernameEntered</span><span class="p">,</span> <span class="nx">usernameAvailable</span><span class="p">,</span> <span class="nx">fullnameEntered</span><span class="p">);</span>

        <span class="nx">buttonEnabled</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">arrayBool</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//alert(arrayBool);</span>

            <span class="nx">len</span> <span class="o">=</span> <span class="nx">arrayBool</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span> <span class="o">&amp;&amp;</span> <span class="nx">arrayBool</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="nx">setEnabled</span><span class="p">(</span><span class="nx">registerButton</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>

        <span class="p">});</span>
    <span class="p">}</span>
</pre></div>

<p>From WhenJS documentation,</p>

<p><strong>when()</strong></p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
</pre></div>

<p>Get a trusted promise for  x . If  x is:</p>

<ul class="task-list">
<li>a value, returns a promise fulfilled with  x</li>
<li>a promise, returns  x .</li>
<li>a foreign thenable, returns a promise that follows  x</li>
</ul>
<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">transformedPromise</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">f</span><span class="p">);</span>
</pre></div>

<p>Get a trusted promise by transforming  x with  f . If  x is</p>

<ul class="task-list">
<li><p>a value, returns a promise fulfilled with  f(x)</p></li>
<li><p>a promise or thenable, returns a promise that</p></li>
</ul>
<p>a) if  x fulfills, will fulfill with the result of calling  f with  x 's fulfillment value.<br>
b) if  x rejects, will reject with the same reason as  x</p>

<h4>Alternative to Callback Hell</h4>

<p>Since JavaScript is built around the concept of callbacks, consider the following jQuery GET AJAX example.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s2">"test.php"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span> <span class="s2">"Data Loaded: "</span> <span class="o">+</span> <span class="nx">data</span> <span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>If you need to pass that data outside of that anonymous function, you need to call another callback, ad infinitum...aka <a href="http://callbackhell.com/">callback hell</a>. </p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s2">"test.php"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span> <span class="s2">"Data Loaded: "</span> <span class="o">+</span> <span class="nx">data</span> <span class="p">);</span>
    <span class="nx">callback</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Callbacks are fine as long as the functionality you want is confined in the callback context. What if you want to evaluate the data in our GET example outside of the callback function? Since jQuery implements the Promise interface, you can make the following.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">objGet</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s2">"test.php"</span><span class="p">);</span>
</pre></div>

<p>So now you can evaluate objGet like so.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">objGet</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Data Loaded: "</span> <span class="o">+</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The variable objGet enables us to escape callback hell by encapsulating the value we want into an object that can be evaluated later.</p>

<h4>Deferred and Promises</h4>

<p>Now since we know that functional programming enables us to encapsulate state (or whatever data you want to track) into an object for later evaluation, we will differentiate between two objects that are central to promise-based programming.</p>

<ol class="task-list">
<li>Deferred - an object that we can trigger as a result of an event (success, error and notify) and pass the result to a Promise object</li>
<li>Promise - an object that holds the result of a Deferred object operation (either resolve/reject or notify operation) </li>
</ol>
<p>For example, in a relational database a transaction is either committed or not. </p>

<ul class="task-list">
<li>when a transaction is committed, we can say that it resolves a successful operation</li>
<li>when a transaction is rolled back, we can say that it rejects the operation </li>
</ul>
<p>Consider the following code.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">dbTxnDeferred</span> <span class="o">=</span> <span class="nx">when</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">dbTxnNotifyDeferred</span> <span class="o">=</span> <span class="nx">when</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>

<span class="nx">dbTxnNotifyDeferred</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">'Transaction pending'</span><span class="p">);</span> 

<span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> 

    <span class="nx">dbTxnDeferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">'Transaction committed'</span><span class="p">);</span> 
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">dbTxnDeferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s1">'Transaction rolled back'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">dbTxnNotifyDeferred</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">'Waiting for transaction... '</span><span class="p">);</span> 
<span class="nx">dbTxnDeferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s1">'Transaction rolled back'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">dbTxnNotify</span> <span class="o">=</span> <span class="nx">dbTxnNotifyDeferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">dbTxnPromise</span> <span class="o">=</span> <span class="nx">dbTxnDeferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>  <span class="c1">//returns a promise object</span>

<span class="nx">dbTxnNotify</span><span class="p">.</span><span class="nx">progress</span><span class="p">(</span><span class="nx">onProgress</span><span class="p">);</span>

<span class="nx">dbTxnPromise</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">onFulfilled</span><span class="p">)</span>
<span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">onRejected</span><span class="p">)</span>

<span class="kd">function</span> <span class="nx">onProgress</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="c1">//Transaction pending</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">onFulfilled</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Success: "</span> <span class="o">+</span> <span class="nx">value</span><span class="p">);</span> <span class="c1">//Transaction committed</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">onRejected</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Error: "</span> <span class="o">+</span> <span class="nx">value</span><span class="p">);</span> <span class="c1">//Transaction rolled back</span>
<span class="p">}</span>
</pre></div>

<p>Output:</p>

<pre><code>"Transaction pending" 
"Waiting for transaction... " 
"Success: Transaction committed"
</code></pre>

<p>From WhenJS documentation:</p>

<p>A promise makes the following guarantees about handlers registered in the same call to  .then():</p>

<ol class="task-list">
<li>Only one of  onFulfilled or  onRejected will be called, never both.</li>
<li>onFulfilled and  onRejected will never be called more than once.</li>
<li>onProgress may be called zero or more times.</li>
</ol>
<p>A couple of notes:</p>

<ul class="task-list">
<li>notice that dbTxnDeferred.reject was never called since it was already resolved</li>
<li>resolve/reject are mutually exclusive. If there is resolve/reject call, notify will be ignored</li>
<li>if you want to use notification, create a new deferred object separate from the deferred that resolves/rejects</li>
</ul>
<h4>jQuery and WhenJS</h4>

<p>Look at the following code:</p>

<div class="highlight highlight-javascript"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s2">"#username input"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'keyup'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span> <span class="c1">//string</span>
        <span class="nx">username</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span> <span class="c1">//promise object that holds a string</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">nonEmpty</span><span class="p">(</span><span class="nx">user</span><span class="p">))</span> <span class="p">{</span>

            <span class="nx">usernameEntered</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

            <span class="c1">//simulate availabilityPending</span>
            <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">usernameAjaxIndicator</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

            <span class="c1">//jQuery AJAX calls implement a promise interface</span>
            <span class="nx">jqAvailabilityRequest</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/usernameavailable/"</span> <span class="o">+</span> <span class="nx">user</span><span class="p">);</span>

            <span class="nx">usernameAvailable</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="nx">jqAvailabilityRequest</span><span class="p">);</span>

            <span class="nx">usernameAvailable</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>

                <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">usernameAjaxIndicator</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

                <span class="c1">//when usernameavailable is false, show unavailabilityLabel</span>
                <span class="nx">setVisibility</span><span class="p">(</span><span class="nx">unavailabilityLabel</span><span class="p">,</span> <span class="o">!</span><span class="nx">bool</span><span class="p">);</span>
            <span class="p">});</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">usernameEntered</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">setButtonEnabled</span><span class="p">();</span>
    <span class="p">});</span>
</pre></div>

<p>Since jQuery AJAX calls also implement the Promise interface, now we are stuck with a jQuery promise object. Fortunately, WhenJS has a when() function that accepts any promise that provides a  thenable promise, that is, any object that provides a  .then() method, even promises that aren't fully Promises/A+ compliant, such as jQuery's Deferred. It will assimilate such promises and make them behave like <a href="http://domenic.me/2012/10/14/youre-missing-the-point-of-promises/">Promises/A+</a>.</p>

<p>This is important so we can convert a jQuery promise into a WhenJS promise that can be evaluated later on. If all we need is to evaluate the data returned by the jQuery promise object, we can do  so using jQuery's then or done method on the spot.</p>

<div class="highlight highlight-javascript"><pre><span class="c1">//jQuery AJAX calls implement a promise interface</span>
<span class="nx">jqAvailabilityRequest</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"/usernameavailable/"</span> <span class="o">+</span> <span class="nx">user</span><span class="p">);</span>

<span class="nx">usernameAvailable</span> <span class="o">=</span> <span class="nx">when</span><span class="p">(</span><span class="nx">jqAvailabilityRequest</span><span class="p">);</span>
</pre></div>

<a name="bootstrap"><h3>Learn Bootstrap 2</h3></a>

<p><a href="https://camo.githubusercontent.com/0c90cd641dba1ac8a605d098e0c9a83df06bf71d/687474703a2f2f692e696d6775722e636f6d2f453255617759752e706e67" target="_blank"><img src="https://camo.githubusercontent.com/0c90cd641dba1ac8a605d098e0c9a83df06bf71d/687474703a2f2f692e696d6775722e636f6d2f453255617759752e706e67" alt="" data-canonical-src="http://i.imgur.com/E2UawYu.png" style="max-width:100%;"></a></p>

<blockquote>
<p>Note: If you are into jQuery UI, Foundation or any other user interface framework, then by all means use it. However, if you are totally new to CSS, I will recommend using Bootstrap from Twitter. The built-in components enable you to use them out of the box and manipulate them using jQuery.</p>
</blockquote>

<p>Since we are dealing mostly with the Web version of desktop applications, Bootstrap 2.3.2 which is the last version in the 2.0 series is more than enough to get us up and running in no time without learning advanced CSS. The goal is to build the GUI as fast as possible with Bootstrap 2 components. The wording in this chapter has been copied verbatim from the Bootstrap documentation.</p>

<p>For a more detailed treatment regarding Bootstrap, I recommend the book "Bootstrap" by Jake Spurlock (O'Reilly).</p>

<p>Without further ado, here are some of the most important concepts in Bootstrap 2.</p>

<h4>Container</h4>

<p>A fixed container layout provides a common fixed-width (and optionally responsive) layout requiring only class="container" on your page. If you want a fluid container layout, use class="container-fluid" instead.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-inverse"</span><span class="nt">&gt;</span>Span 2<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span10"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-success"</span><span class="nt">&gt;</span>Span 10<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h4>Fixed grid</h4>

<p>The default Bootstrap 2 grid system utilizes 12 columns, making for a 940px wide container without responsive features enabled. With the responsive CSS file added, the grid adapts to be 724px and 1170px wide depending on your viewport. Below 767px viewports, the columns become fluid and stack vertically.</p>

<p>For a simple two column layout, create a .row and add the appropriate number of .span* columns. As this is a 12-column grid, each .span* spans a number of those 12 columns, and should always add up to 12 for each row (or the number of columns in the parent).</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-primary"</span><span class="nt">&gt;</span>Span 4<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-danger"</span><span class="nt">&gt;</span>Span 8<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h4>Offset columns</h4>

<p>Move columns to the right using .offset* classes. Each class increases the left margin of a column by a whole column. For example, .offset4 moves .span4 over four columns.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"divBootOffset"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row-fluid"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span4"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-primary"</span><span class="nt">&gt;</span>Span 4<span class="nt">&lt;/button&gt;</span>  
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span8"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-danger"</span><span class="nt">&gt;</span>Span 8<span class="nt">&lt;/button&gt;</span>  
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>  

    <span class="nt">&lt;br&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row-fluid"</span><span class="nt">&gt;</span> 
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span4"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-primary"</span><span class="nt">&gt;</span>Span 4<span class="nt">&lt;/button&gt;</span>  
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span5 offset3"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-warning"</span><span class="nt">&gt;</span>Span 5 offset 3<span class="nt">&lt;/button&gt;</span>  
        <span class="nt">&lt;/div&gt;</span>      
    <span class="nt">&lt;/div&gt;</span>  

    <span class="nt">&lt;br&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row-fluid"</span><span class="nt">&gt;</span> 
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span4"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-primary"</span><span class="nt">&gt;</span>Span 4<span class="nt">&lt;/button&gt;</span>  
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span2 offset2"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-success"</span><span class="nt">&gt;</span>Span 2 offset 2<span class="nt">&lt;/button&gt;</span>  
        <span class="nt">&lt;/div&gt;</span>  
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span3 offset1"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-info"</span><span class="nt">&gt;</span>Span 3 offset1<span class="nt">&lt;/button&gt;</span>  
        <span class="nt">&lt;/div&gt;</span>      
    <span class="nt">&lt;/div&gt;</span>  
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h4>Nesting columns</h4>

<p>To nest your content with the default grid, add a new .row and set of .span* columns within an existing .span* column. Nested rows should include a set of columns that add up to the number of columns of its parent.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row-fluid"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span12"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-danger"</span><span class="nt">&gt;</span>Span 12<span class="nt">&lt;/button&gt;</span>  
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row-fluid"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span8"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-info"</span><span class="nt">&gt;</span>Level 2 span 8
                <span class="nt">&lt;/button&gt;</span> 
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row-fluid"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span3"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-success"</span><span class="nt">&gt;</span>Level 3 span 3
                        <span class="nt">&lt;/button&gt;</span>       
                    <span class="nt">&lt;/div&gt;</span>

                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span9"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-default"</span><span class="nt">&gt;</span>Level 3 span 9
                        <span class="nt">&lt;/button&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>                      
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span4"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-warning"</span><span class="nt">&gt;</span>Level 2 span 4
                <span class="nt">&lt;/button&gt;</span> 
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>  
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>  
</pre></div>

<h4>Fluid grid</h4>

<p>The fluid grid system uses percents instead of pixels for column widths. It has the same responsive capabilities as the fixed grid system, ensuring proper proportions for key screen resolutions and devices.</p>

<p>Make any row "fluid" by changing .row to .row-fluid. The column classes stay the exact same, making it easy to flip between fixed and fluid grids.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row-fluid"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-primary"</span><span class="nt">&gt;</span>Span 4<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"span8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-block btn-danger"</span><span class="nt">&gt;</span>Span 8<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h4>Navigation tab</h4>

<p>All nav components —tabs, pills, and lists—share the same base markup and styles through the .nav class.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav nav-tabs"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"dropdown"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-toggle"</span> <span class="na">data-toggle=</span><span class="s">"dropdown"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>jQuery 101
            <span class="nt">&lt;b</span> <span class="na">class=</span><span class="s">"caret"</span><span class="nt">&gt;&lt;/b&gt;</span>
        <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"dropdown-menu"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Action<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Another action<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Something else here<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"divider"</span><span class="nt">&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Separated link<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"dropdown"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-toggle"</span> <span class="na">data-toggle=</span><span class="s">"dropdown"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Bacon.js
            <span class="nt">&lt;b</span> <span class="na">class=</span><span class="s">"caret"</span><span class="nt">&gt;&lt;/b&gt;</span>
        <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"dropdown-menu"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Merge and Scan<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Filter EventStream<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Publish/Subscribe with Bus<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>EventStream and Property<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Filter Property-based EventStream <span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Combine EventStream<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>

<h4>Navigation bar</h4>

<p>To start, navbars are static (not fixed to the top) and include support for a project name and basic navigation. Place one anywhere within a .container, which sets the width of your site and content.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"navbar"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"navbar-inner"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"brand"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Title<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"active"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Link<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Link<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h4>Breadcrumb</h4>

<p>Breadcrumb provides context when you are in a specific page</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"breadcrumb"</span><span class="nt">&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"divider"</span><span class="nt">&gt;</span><span class="ni">&amp;raquo;</span><span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Software<span class="nt">&lt;/a&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"divider"</span><span class="nt">&gt;</span><span class="ni">&amp;raquo;</span><span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Linux<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>

<h4>Pagination</h4>

<p>Simple pagination inspired by Rdio, great for apps and search results. The large block is hard to miss, easily scalable, and provides large click areas.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Prev<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>2<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>3<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>4<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>5<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h4>Labels and badges</h4>

<div class="highlight highlight-html"><pre><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"label"</span><span class="nt">&gt;</span>Default<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"label label-success"</span><span class="nt">&gt;</span>Success<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"label label-warning"</span><span class="nt">&gt;</span>Warning<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"label label-important"</span><span class="nt">&gt;</span>Important<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"label label-info"</span><span class="nt">&gt;</span>Info<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"label label-inverse"</span><span class="nt">&gt;</span>Inverse<span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;br&gt;&lt;br&gt;</span>

<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"badge"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"badge badge-success"</span><span class="nt">&gt;</span>2<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"badge badge-warning"</span><span class="nt">&gt;</span>4<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"badge badge-important"</span><span class="nt">&gt;</span>6<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"badge badge-info"</span><span class="nt">&gt;</span>8<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"badge badge-inverse"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/span&gt;</span>
</pre></div>

<h4>Alert</h4>

<p>Wrap any text and an optional dismiss button in .alert for a basic warning alert message.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-block alert-error"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"alert"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/button&gt;</span>
    This is an alert-error with extra padding (alert-block)
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-error"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"alert"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/button&gt;</span>
    This is alert-error
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-success"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"alert"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/button&gt;</span>
    This is alert-success
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-info"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"alert"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/button&gt;</span>
    This is alert-info
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h4>Table</h4>

<div class="highlight highlight-html"><pre><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-striped table-bordered table-hover table-condensed"</span><span class="nt">&gt;</span>
<span class="nt">&lt;caption&gt;</span>Table Caption here<span class="nt">&lt;/caption&gt;</span>
<span class="nt">&lt;thead&gt;</span>
<span class="nt">&lt;tr&gt;</span>
<span class="nt">&lt;th&gt;</span>Country<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Capital<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/thead&gt;</span>
<span class="nt">&lt;tbody&gt;</span>
<span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"success"</span><span class="nt">&gt;</span>
<span class="nt">&lt;td&gt;</span>Philippines<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>Manila<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>

<span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"error"</span><span class="nt">&gt;</span>
<span class="nt">&lt;td&gt;</span>United States of America<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>Washington, D.C.<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>

<span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"warning"</span><span class="nt">&gt;</span>
<span class="nt">&lt;td&gt;</span>Japan<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>Tokyo<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>

<span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"info"</span><span class="nt">&gt;</span>
<span class="nt">&lt;td&gt;</span>Canada<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>Ottawa<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>

<span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>

<h4>Buttons</h4>

<div class="highlight highlight-html"><pre><span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-large btn-primary"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Large button<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-large"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Large button<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-info"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Default button<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Default button<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-small btn-success"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Small button<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-small"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Small button<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-mini btn-warning"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Mini button<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-mini disabled"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Mini button disabled<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-mini btn-inverse"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Mini button inverse<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-block btn-danger"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Block-level button<span class="nt">&lt;/button&gt;</span>
</pre></div>

<h4>Toggle</h4>

<div class="highlight highlight-html"><pre><span class="c">&lt;!-- courtesy of http://getboilerstrap.com/bootstrap-styles/ --&gt;</span>
<span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn"</span> <span class="na">data-toggle=</span><span class="s">"collapse"</span> <span class="na">data-target=</span><span class="s">"#toggle-demo"</span><span class="nt">&gt;</span>Toggle Section<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"toggle-demo"</span> <span class="na">class=</span><span class="s">"collapse"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"hero-unit"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"center"</span><span class="nt">&gt;</span>Toggle Demo<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h4>Modal</h4>

<div class="highlight highlight-html"><pre><span class="c">&lt;!-- courtesy of http://getboilerstrap.com/bootstrap-styles/ --&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#demo-modal"</span> <span class="na">role=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-success"</span> <span class="na">data-toggle=</span><span class="s">"modal"</span><span class="nt">&gt;</span>Launch Modal<span class="nt">&lt;/a&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"demo-modal"</span> <span class="na">class=</span><span class="s">"modal hide fade in"</span> <span class="na">role=</span><span class="s">"content"</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"modal-h1-title"</span><span class="nt">&gt;</span>Demo Modal<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-body search-modal row-fluid"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>Oh hello!<span class="nt">&lt;/p&gt;</span>                
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-footer"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span> <span class="na">aria-hidden=</span><span class="s">"true"</span> <span class="na">title=</span><span class="s">"Click to dismiss search"</span><span class="nt">&gt;</span>Close<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<a name="part3"><h2>Part III. Back-End Development</h2></a>

<p>Back-end development refers to server-side programming which comprises </p>

<ol class="task-list">
<li>the Web application (logic tier) and </li>
<li>the relational and/or non-relational NoSQL database (database tier). </li>
</ol>
<p>The simplest setup is the so-called LAMP (Linux, Apache, MySQL and PHP/Python/Perl) installed on a single computer (or its equivalent in Windows or other operating system).</p>

<a name="logic"><h4> Logic Tier </h4></a>

<p><a href="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" alt="" data-canonical-src="http://i.imgur.com/eb9S9Fz.jpg" style="max-width:100%;"></a></p>

<p><br><br><br></p>

<a name="rule1"><h5>Rule 1: Export services via port binding</h5></a>

<p><a href="https://camo.githubusercontent.com/f0b310a633e7b0745fcc658a8d1715ee531866f8/687474703a2f2f692e696d6775722e636f6d2f61484f6b4352412e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/f0b310a633e7b0745fcc658a8d1715ee531866f8/687474703a2f2f692e696d6775722e636f6d2f61484f6b4352412e6a7067" alt="" data-canonical-src="http://i.imgur.com/aHOkCRA.jpg" style="max-width:100%;"></a></p>

<p>This is Rule VII from <a href="http://12factor.net">The Twelve-Factor App</a>. That is, Web apps need to use a reverse proxy like nginx or the like. To see why this important, let me give you a brief background:</p>

<p>Historically, Web apps are executed inside a Web server container. For example, PHP apps might run as a module inside Apache HTTPD, or Java apps might run inside Tomcat (courtesy: Twelve Factor App). The Web apps are tightly coupled with a Web server. </p>

<p><strong>Why you should decouple a Web app from a Web server?</strong></p>

<p><strong>1. Efficiency</strong></p>

<p>From Peter Smith, author of "Professional Website Performance":</p>

<p>Nginx (pronounced “engine X”) appeared on the scene in the mid-2000s, and although initial uptake was slow because of lack of documentation, it has quickly gained in popularity. Many surveys now show it to be the third most used web server (behind Apache and IIS), and it is particularly popular for high-traffic sites. Nginx’s structure is notably different from Apache’s. As you have seen, Apache uses processes or threads (depending on the MPM used), each of which use significant resources (not to mention the overhead involved in creating and destroying child processes). By contrast, Nginx uses an asynchronous, event-driven model, which removes the need for each request to be handled as a separate child/thread. Instead there is a single master process with one or more worker processes. </p>

<p>The performance impact of this change is huge. Whereas each additional Apache process consumes an extra 4 MB or 5 MB (if the likes of mod_php have been loaded, this figure will be more like 15+MB) of memory, the impact of additional concurrent requests on Nginx is tiny. The result is that Nginx can handle a huge number of concurrent requests — much more than Apache, even with the<br>
newer threaded MPM.</p>

<p><strong>2. Separation of concerns</strong></p>

<ul class="task-list">
<li>Static apps (client-side)</li>
</ul>
<p>When you decouple the presentation layer of a Web app from its business logic layer, the former can be served simply as static files and the latter can be architected as Web services (RESTful). Better yet, front-end development (HTML/CSS/JavaScript) can be written by one team and back-end development by another. Static files are downloaded once and can be cached resulting in faster performance compared with server-side pages (like ASP/JSP/PHP) that are dynamically rendered on the client-side. See <a href="http://www.staticapps.org/">staticapps.org</a> for more information.</p>

<ul class="task-list">
<li>Web services (back-end)</li>
</ul>
<p>With Web services, you are no longer confined with the constraints of a Web server. You are no longer thinking in terms of Web sites. Instead, you design your back-end such that you can easily replace your HTML front-end without breaking functionality. Web services go beyond Web sites. Just look at Amazon Web Services. It redefined IT infrastructure by exposing compute/network/storage functionality as programmable Web APIs. Its AWS management console is just a window to what lies underneath.</p>

<p>Now if you're thinking Web application development has gotten more difficult with Web services, think again. You don't have to assume the role of a Web server because there is a reverse proxy. You can delegate serving static files to a Web server to offload tasks with your backend Web apps. However, you are now concerned with health checks of your backend apps (like restarting crashed apps). Fortunately, there are open source tools to do just that (see <a href="https://github.com/dotcloud/hipache">Hipache</a> for example).</p>

<a name="rule2"><h5>Rule 2: Minimize control logic, maximize application logic</h5></a>

<p>Computing is basically I-P-O.</p>

<p>I = input<br>
P = process<br>
O = output</p>

<p>The process part is composed of two components:</p>

<ol class="task-list">
<li>Control logic - examples include the main program in C, Go or Node.js </li>
<li>Application logic - libraries, plugins, packages, modules</li>
</ol>
<p>The control logic controls the overall state flow of the system so it is imperative to minimize it as much as possible (less moving parts). On the other hand, the application logic or modules  should function as black boxes at the program level. You don't care how it works internally, you only care about input parameters and its corresponding output. Modules are simply being invoked by the control logic, no more no less.</p>

<p><strong>A Tale of Two Programming Paradigms</strong></p>

<p>As far as programs and systems are concerned, there are only two programming paradigms: imperative and declarative programming.</p>

<ol class="task-list">
<li><p>Imperative programming is a low-level programming paradigm in contrast with declarative programming (like functional programming or flow-based programming) which lets you think in terms of more high-level abstractions</p></li>
<li><p>Imperative programming focuses on the how, declarative programming focuses on the what. As such, they tackle modularity (breaking into parts) and composition (gluing the parts together) from two different perspectives.</p></li>
<li><p>Declarative programming does not completely eliminate state (only keeps it to a minimum)</p></li>
<li><p>Turing machine is the basis of imperative programming while lambda calculus is the basis of functional programming</p></li>
<li><p>Programming paradigms all exhibit structured programming and they all promote modularity. The differences are in the implementation.</p></li>
</ol>
<p><strong>Structured Programming</strong></p>

<ul class="task-list">
<li><p>Sequence - with imperative programming, you call functions either by value or by reference. With functional programming, it is call-by-need (aka lazy evaluation).</p></li>
<li><p>Selection - "if" statement is executed in imperative programming. In functional programming, selection is an expression (which is converted to a value)</p></li>
<li><p>Loop - with imperative programming, there are "for", "while" statements and the like. With functional programming, the functionality in a loop is abstracted away (see function as abstraction at <a href="http://eloquentjavascript.net/chapter6.html">EloquentJavaScript.net</a>). For example, Underscore.js is an FP library for data while Bacon.js is an FP library for events.</p></li>
</ul>
<p><strong>Why Functional Programming Matters</strong> (courtesy of John Hughes)</p>

<p>Functional programs contain no assignment statements, so variables, once given a value, never change. More generally, functional programs contain no side-effects at all. A function call can have no effect other than to compute its result. This eliminates a major source of bugs, and also makes the order of execution irrelevant - since no side-effect can change the value of an expression, it can be evaluated at any time. This relieves the programmer of the burden of prescribing the flow of control. Since expressions can be evaluated at any time, one can freely replace variables by their values and vice versa - that is, programs are “referentially transparent”.</p>

<p><strong>Control Flow as a Graph</strong></p>

<p>Declarative programming (like flow-based programming and functional programming ) lends to a programming design akin to a graph in a whiteboard. To quote <a href="http://bergie.iki.fi/blog/noflo-two-years/">Henri Bergius</a>,</p>

<blockquote>
<p>the logic of the software is designed as a <a href="http://en.wikipedia.org/wiki/Control_flow_graph">graph</a> — much like a flowchart — and stays as a graph.</p>
</blockquote>

<a name="rule3"><h5>Rule 3: Concurrency is not parallelism</h5></a>

<p>Do not confuse concurrency with parallelism. The <a href="http://blog.golang.org/concurrency-is-not-parallelism">Go language blog</a> has an excellent post:</p>

<p>In programming, concurrency is the composition of independently executing processes, while parallelism is the simultaneous execution of (possibly related) computations. Concurrency is about dealing with lots of things at once. Parallelism is about doing lots of things at once.</p>

<p>In other words, <strong>concurrency</strong> refers to a <strong>single program that executes asynchronous processes</strong>  </p>

<ul class="task-list">
<li>regardless whether it is single-threaded or multi-threaded and</li>
<li>regardless whether it runs on a single-core or multi-core CPU</li>
</ul>
<p>Concurrency is not about threads or CPU. It is all about whether you execute processes in an asynchronous fashion. In the case of Node.js, since it is using a single-threaded event loop, you are advised not to block the event loop for input/output operations or network calls. In the case of Go language, concurrency can be achieved using its built-in high-level constructs called goroutines and channels. Go multiplexes user-level goroutines onto OS-level threads. </p>

<p>But here is the difference between concurrency in Node and Go. With Node, you are <strong>manually</strong> managing concurrency through the use of callbacks, promises, async library or what have you. With Go, the Go runtime <strong>automatically</strong> manages concurrency so <a href="http://stackoverflow.com/questions/6328679/in-golang-does-it-make-sense-to-write-non-blocking-code">you can write blocking operations without callback</a> as long as you put it in a goroutine and optionally use a channel for its output if need be.</p>

<p>Either way, <a href="https://glyph.twistedmatrix.com/2014/02/unyielding.html">asynchronous programming</a> is easier to reason about than thinking in terms of multithreading.</p>

<p>On the other hand, <strong>parallelism</strong> is about <strong>executing multiple identical processes</strong> </p>

<ul class="task-list">
<li>regardless whether it runs on a single computer with multi-core CPU or multiple computers with single/multi-core CPU</li>
<li>regardless whether it is concurrent process or not</li>
</ul>
<p>Of course, parallelism does not apply to a single computer with a single-core CPU but it does apply in the context of multiple computers regardless of number of CPU as long as the above-mentioned condition is met.</p>

<p>Parallelism is best described with N-tier architecture where programs/applications are deployed in parallel at the application/logic tier to achieve high throughput and high availability.</p>

<p>In short, concurrency is about asynchronous processes while parallelism is about executing multiple identical processes simultaneously.</p>

<a name="rule4"><h5>Rule 4: Use interface, not leaky abstraction</h5></a>

<p>The key to program modularity and extensibility is interface, not leaky abstraction. Software must be either a kernel or a component in the form of plugins, modules, libraries or packages.</p>

<p>To illustrate, I will give examples of interface:</p>

<ul class="task-list">
<li>operating system - interface to the physical machine</li>
<li>hypervisor, container (Docker, Solaris Zones) - interface to the operating system</li>
<li>SQL - interface to relational databases</li>
<li>NPM (Node Package Manager) - module interface in Node</li>
<li>jQuery - interface for DOM, AJAX, etc</li>
<li>Browserify - module interface to client-side JavaScript</li>
<li>composition - interface inheritance (see composition vs implementation inheritance below)</li>
</ul>
<p>Examples of leaky abstraction</p>

<ul class="task-list">
<li>client-side frameworks - Angular, Ember - leaks to JavaScript</li>
<li>ORM (object/relational mapping) - leaks to SQL</li>
<li>.NET, JVM - leaks to operating system</li>
<li>implementation inheritance - ask the Go language designers</li>
</ul>
<p>The problem with leaky abstraction is that they only provide a facade instead of a well-designed interface to the underlying software. There are two issues with this scenario.</p>

<ul class="task-list">
<li>the underlying software is a moving target so the leaky abstraction must keep up with the changes, so now you have to track and maintain two different sets of software</li>
<li>backward incompatibility is a fact of life in the software world but that is not the point. The issue is, leaky abstraction won't solve all use cases so for edge cases, you have no option but to dig the underlying software</li>
</ul>
<p>But <strong>leaky abstractions are not the same as tight-coupling though they are related</strong>. </p>

<p>The direction of "eventual functionality" between these two are just polar opposites.</p>

<p>For <strong>leaky abstraction</strong>, its eventual functionality is <strong>downward</strong>. </p>

<p>To illustrate, when a leaky abstraction cannot provide the functionality you want and it does not offer a way to write an extension, you are forced to dig deeper below the layer of abstraction. For example, when an ORM does not cover your use case, you will eventually resort to SQL, so why not just use SQL in the first place? The notion of abstracting away many relational databases is a fallacy. That is not going to happen because your application is tightly coupled to your data store. In case of NoSQL, why not just use its native query language? The choice of data storage software is a high-level architectural decision that is left to those who know what they are doing.</p>

<p>Another example of leaky abstractions are client-side frameworks (CSF) like Angular and Ember. Ok, there are extensibility avenues but plugins designed for one framework are not going to work with another. You have to port them. When there is porting involved, there are two issues:</p>

<ol class="task-list">
<li>lock-in - now you are tightly coupled not just programmatically but mentally as well</li>
<li>interoperability - when plugins are not interoperable, turf wars are inevitable</li>
</ol>
<p>In contrast, consider the elegant solution of interface compared with leaky abstraction.</p>

<p>For <strong>interface</strong>, its eventual functionality is <strong>upward</strong>.</p>

<blockquote>
<p>I will give two examples why an interface trumps leaky abstraction.</p>

<p>Ansible, a configuration management tool</p>
</blockquote>

<p>For starters, Ansible is written in Python and was originally designed to manage Linux machines. Management is being done from a control host machine running Linux (which is akin to military command and control). When Linux functionality stabilizes, it began to consider managing Windows as well. Instead of using the Windows port of Python, it retained the native Linux OS for the control host. So managing Windows environment is being done from the same Linux control host that manages Linux machines.</p>

<p>Here is the crucial decision: Ansible did not abstract away the differences between Linux and Windows versions of Python. Instead, it adapted Windows by utilizing Windows native PowerShell to talk to the same Linux control interface.</p>

<p>So Ansible standard modules that work in Linux also work seamlessly with Windows. Of course, there are going to be Windows-only modules but that is not the point. My point is, a well-designed interface is the key to avoid lock-in while maintaining program modularity, extensibility and interoperability.</p>

<p>The benefits of interface trickle down to <a href="http://substack.net/many_things">Browserify</a>, jQuery, NPM, SQL, Docker container, Xen, KVM, etc. Modules or plugins can be written once and deployed anywhere, no porting required although with minor differences among operating systems.</p>

<p>If you think there is tight coupling among component versions, you are right. It is called API versioning but it has nothing to do with issues given above.</p>

<blockquote>
<p>CommonJS as implemented in NPM</p>
</blockquote>

<p>Building large-scale JavaScript applications requires a module system that manages dependencies. But <a href="http://www.computer.org/csdl/mags/co/2012/02/mco2012020007.html">JavaScript was designed in a hurry</a> so a module system is just an afterthought. </p>

<p>The community came up with two major specifications: </p>

<ul class="task-list">
<li>AMD </li>
<li>CommonJS</li>
</ul>
<p>According to <a href="http://addyosmani.com/writing-modular-js/">Addy Osmani</a>, AMD adopts a browser-first approach to tackle the problems of module system and dependency management. CommonJS on the other hand takes the server-first approach.</p>

<p>Node.js adopted the CommonJS specification and implemented it with <a href="http://blog.izs.me/post/27987129912/tj-holowaychuk-components">NPM</a> (Node Package Manager). NPM solves the problem elegantly and has an ever growing number of modules (called packages). At the time of writing, the NPM repository has over 90,000 packages. The fact that Node included NPM as a built-in module says a lot about its architecture and implementation.</p>

<p>On the other hand, these are the experience of those using AMD.</p>

<ul class="task-list">
<li><a href="http://esa-matti.suuronen.org/blog/2013/03/22/journey-from-requirejs-to-browserify/">Journey from RequireJS to Browserify</a></li>
<li><a href="http://codeofrob.com/entries/why-i-stopped-using-amd.html">Why I Stopped using AMD</a></li>
<li><a href="http://tomdale.net/2012/01/amd-is-not-the-answer/">AMD is not the answer</a></li>
<li><a href="http://derickbailey.com/2014/06/10/browserify-my-new-choice-for-modules-in-a-browser-backbone-app/">Browserify: My new choice for modules in a browser</a></li>
</ul>
<p>The list goes on and on. As Einstein said, "In theory, theory and practice are the same. In practice, they are not". Well, he is damned right about AMD.</p>

<p>Let's dissect the real issues.</p>

<p>First, <a href="http://blog.startifact.com/posts/overwhelmed-by-javascript-dependencies.html">dependency management is hard</a>. You should not do it manually. Let the algorithm do it for you automatically using a well-defined interface (syntax) and a few rules<br>
Second, compare NPM repository with <a href="http://jamjs.org/packages/">Jam</a><br>
Third, consider the case of using the actual module. If there is too much ceremony as Tom Dale pointed out, do not count me in </p>

<p>Now, consider how NPM solved those issues intuitively.</p>

<ul class="task-list">
<li>NPM is a package manager with a few <a href="https://www.npmjs.org/doc/misc/npm-faq.html">rules</a>
</li>
<li>NPM has a bustling repository</li>
<li>NPM has a simple syntax when importing modules</li>
</ul>
<p>So back to the issue of interface versus leaky abstraction.</p>

<p>Both CommonJS and AMD are specifications. NPM and RequireJS are implementations of CommonJS and AMD respectively. </p>

<p>So what's the problem?</p>

<p>The problem is that AMD is a leaky abstraction because dependency management is based on <a href="http://codeofrob.com/entries/why-i-stopped-using-amd.html">configuration</a>. With NPM, you can segment your business logic into folders under node_modules and it will resolve the dependencies automatically.</p>

<p>So how can you use those NPM modules in the browser?</p>

<p>Simple. Through Browserify!</p>

<p>You see, Browserify does not have to reinvent the 3-in-1 awesomeness of NPM (package manager, repository and clean interface). </p>

<blockquote>
<p>Since <a href="http://blakeembrey.com/articles/introduction-to-browserify/">Browserify</a> implements the Node.js module resolve algorithm, you can use the same NPM modules in the server and export them for use in the browser.</p>
</blockquote>

<p>This is what I mean by interface. An interface is not concerned with the underlying implementation. If the syntax or interface being used by NPM modules works in the server, it should also work in the browser. And that's what Browserify does.</p>

<blockquote>
<p>Composition vs implementation inheritance</p>
</blockquote>

<p>With composition, you talk to an interface, not the object itself.</p>

<p>Excerpt from <a href="http://talks.golang.org/2012/splash.article">Golang</a>:</p>

<p>Object-oriented programming provides a powerful insight: that the behavior of data can be generalized independently of the representation of that data. The model works best when the behavior (method set) is fixed, but once you subclass a type and add a method, the behaviors are no longer identical. If instead the set of behaviors is fixed, such as in Go's statically defined interfaces, the uniformity of behavior enables data and programs to be composed uniformly, orthogonally, and safely.</p>

<p>Fortunately, JavaScript eschewed class-based OOP in favor of <a href="http://en.wikipedia.org/wiki/Prototype-based_programming">prototype-based paradigm</a> (see problem of <a href="http://en.wikipedia.org/wiki/Categorization">categorization</a>). And Go does not have type hierarchy. </p>

<p>Composition lends itself to better interfaces rather than <a href="http://bergie.iki.fi/blog/noflo-two-years/">dependency injection</a>.</p>

<a name="rule5"><h5>Rule 5: Scale out the logic tier, scale up the storage tier</h5></a>

<p>The logic tier is the business logic. In a three tier architecture, this comprises the Web applications. As such, Web apps regardless if they are deployed to physical machines or as virtual machines are expected to be decommissioned anytime. Thus, in the event of system maintenance or downtime, the continuity of online business is not disrupted.</p>

<p>Scaling out means deploying your apps to commodity hardware so you have three options:</p>

<ul class="task-list">
<li>physicalization - deploy to physical machines</li>
<li>
<a href="http://en.wikipedia.org/wiki/Hardware_virtualization">hardware-level virtualization</a> like KVM or Xen</li>
<li>
<a href="http://en.wikipedia.org/wiki/Operating_system%E2%80%93level_virtualization">OS-level virtualization</a> like Docker or SmartOS Zones</li>
</ul>
<p>On the other hand, when I say scaling up, I am not referring to big fat machines like those being sold by the big boys. Instead, I am referring to commodity hardware that have larger memory and faster CPU compared to their little counterpart in the logic tier.</p>

<p>RDMBS and distributed storage system like Ceph need to be installed on dedicated bare-metal servers so these are mean and brawny machines.</p>

<a name="rule6"><h5>Rule 6: Your tool does matter</h5></a>

<p>Your choice of programming language reflects the expediency of youth versus the wisdom of maturity. If Java, Python, PHP, Ruby, JVM and .NET all led you to class-based OOP hell, it's time you break loose and onto the promised land of functional programming (FP). OOP is like taking the blue pill. OOP has led you to a make believe world, a misdirection, a sleight of hand, a reality distortion field.</p>

<p>But you don't have to take my word for it. You may have experienced OOP and it gets the job done. Well, that is the nature of software. It may have solved your problems in the small scale but at what cost? What are the tradeoffs? Development complexity? Software is intangible so you better look out for things that are not directly measurable but affects the bottom line which is developer productivity.</p>

<p>Now, if you think functional programming is a silver bullet, you are missing the point of FP. Functional programming does not eliminate imperative programming (IP). Rather, the former complements the latter. Moreover, functional programming is a mere subset of <a href="http://en.wikipedia.org/wiki/Declarative_programming">declarative programming</a> paradigm.</p>

<p>If we adopt JavaScript and Go as the first programming languages to teach our students, we can surely defeat <a href="http://blog.codinghorror.com/the-php-singularity/">The PHP Singularity</a> now and into the future.</p>

<p>Which leads us to a corollary:</p>

<blockquote>
<p>IT is 20% software development and 80% operations.</p>
</blockquote>

<p>You may be using the best tools for software development but it won't shield you from the larger problem of operations. Operations include storage, networking and computing, the backend stuff that are invisible to users behind the graphical user interface. Mastery of operations is the reason why you cannot simply topple Facebook or Twitter or Google or Amazon because software development is just a small part of the overall picture.</p>

<a name="rule7"><h5>Rule 7: Separate data structures from functions</h5></a>

<p>OOP is the legacy of the Gang of Four along with JVM, .NET and <a href="http://saturnflyer.com/blog/jim/2012/07/06/the-gang-of-four-is-wrong-and-you-dont-understand-delegation/">Ruby on Rails</a>. I recommend that you read Steve Yegge's article "<a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">Execution in the Kingdom of Nouns</a>". This is the reason why you should not adopt class-based OOP to Node.js and Go language. And this is also the reason why you should not use stored procedures with your favorite relational database management system. There is a reason why computing is input - process - output. Input and output are data while code is process.</p>

<p>I will quote Joe Armstrong (who designed Erlang) from his article "<a href="http://harmful.cat-v.org/software/OO_programming/why_oo_sucks">Why OO Sucks</a>":</p>

<blockquote>
<p>Objects bind functions and data structures together in indivisible units. I think this is a <strong>fundamental error</strong> since functions and data structures belong in totally different worlds. Why is this?</p>
</blockquote>

<p>Functions do things. They have inputs and outputs. The inputs and outputs are data structures, which get changed by the functions. In most languages functions are built from sequences of imperatives: “Do this and then that …” to understand functions you have to understand the order in which things get done (In lazy FPLs and logical languages this restriction is relaxed).</p>

<blockquote>
<p>Data structures just are. They don’t do anything. They are intrinsically declarative. “Understanding” a data structure is a lot easier than “understanding” a function.</p>
</blockquote>

<p>Functions are understood as black boxes that transform inputs to outputs. If I understand the input and the output then I have understood the function. This does not mean to say that I could have written the function.</p>

<p>Functions are usually “understood” by observing that they are the things in a computational system whose job is to transfer data structures of type T1 into data structure of type T2.</p>

<p>Since functions and data structures are completely different types of animal it is fundamentally incorrect to lock them up in the same cage.</p>

<a name="rule8"><h5>Rule 8: Software development is "anything goes"</h5></a>

<p>Don't subscribe to Agile Software Development or any software development methodology for that matter.</p>

<p>The best methodology is no methodology at all.</p>

<p>Why?</p>

<p>Because software development at the individual level is "<a href="http://en.wikipedia.org/wiki/Against_Method">anything goes</a>". </p>

<blockquote>
<p>"Regression testing"? What's that? If it compiles, it is good; if it boots up, it is perfect. - LINUS TORVALDS</p>

<p>We are tired of XP, Scrum, Kanban, Waterfall, Software Craftsmanship (aka XP-Lite) and anything else getting in the way of...Programming...We are tired of being told we're autistic idiots who need to be manipulated to work in a Forced Pair Programming chain gang without any time to be creative because none of the 10 managers on the project can do... Programming...M!@#$%^&amp;*() -<a href="http://programming-motherfucker.com/">ZED SHAW</a></p>

<p>Don't tell people how to do things, tell them what to do and let them surprise you with their results. - GEORGE PATTON</p>
</blockquote>

<p>Of course, the top management all have their plans, their schemes. They want those accomplishment reports and other management tools. They want to show the client that the project is making progress so the client can pay on schedule. At the team level, there is a test-driven engineering practice you need to adhere to. There is nothing wrong with that.</p>

<p>But at the individual level, programmers don't want to be micro-managed.</p>

<p>Programmers are like The Joker (at least in front of their computer).</p>

<blockquote>
<p>Do I really look like a guy with a plan? You know what I am? I'm a dog chasing cars. I wouldn't know what to do with one if I caught it. You know? I just do things. The Mob has plans. The cops have plans... You know, they're schemers. Schemers trying to control their little worlds. I'm not a schemer. I try to show the schemers...how pathetic their attempts to control things really are.</p>
</blockquote>

<p>Well, you cannot blame Zed Shaw against those control freaks. At least unlike the morally deranged Batman nemesis!</p>

<a name="rule9"><h5>Rule 9: Git is for version control, not deployment</h5></a>

<p>Git is for developers to manage their code, not to deploy code. PaaS (platform as a service) is a black box unless you  understand that you wrestle control with the provider and trust their service.</p>

<p>A black box is worse than a leaky abstraction. While an abstraction lets you break the walls if you need to, a black box effectively locks you out of a particular software or service. This is the knowledge asymmetry that the provider wants to leverage since you need to go for your checkbook just to unlock what you need, instead of doing it yourself.</p>

<a name="rule10"><h5>Rule 10: Understand the problem domain first</h5></a>

<p>Understanding the problem domain is more important than the solution space.</p>

<p><a href="http://timbryce.com/bryces-laws/">Tim Bryce</a> said it best:</p>

<blockquote>
<p>No amount of elegant programming or technology will solve a problem if it is improperly specified or understood to begin with.</p>

<p>Project management is a philosophy of management, not a tool or technique.</p>
</blockquote>

<a name="rule11"><h5>Rule 11: Simplicity is the ultimate sophistication</h5></a>

<p><a href="http://en.wikipedia.org/wiki/Simplicity">Simplicity</a> in analysis, design and implementation must be the hallmark of your application. It must exhibit simplicity in API, tools and usability. You must give ample space to your user interface so that the user can breathe. You must provide a stable application programming interface such that the kernel may change internally without breaking compatibility. Avoid clutter. </p>

<p>To paraphrase Antoine de Saint-Exupery, design is achieved not when there is nothing left to add, but when there is nothing left to take away.</p>

<a name="rule12"><h5>Rule 12: Do not be afraid of the command line </h5></a>

<p>For desktop users, Windows or Linux distros may be your GUI (graphical user interface). For developers, you may have your favorite code editors. System operations may have a Web-based GUI but only for mundane or common tasks. For corner cases, a CLI (command line interface) is your only tool. </p>

<p>For Web developers, operations is an inevitable task. You need to know how it's working under the hood. You need to learn beyond front-end development. When I say command line, I am referring to the command line interface of the underlying operating system. Once you get the hang of it, a configuration management tool like <a href="http://www.ansible.com">Ansible</a> will come in handy when the going gets tough.</p>

<p>The command line is your window to the underlying machine, be it physical or virtual machine. If you can't see it, you are under the mercy of schemers.</p>

<p>As <a href="http://www.slideshare.net/datacharmer/dont-be-a-gui-rookie-forever-be-in-command-line">Giuseppe Maxia</a> has said,</p>

<blockquote>
<p>Don't be a rookie forever - Be in command! (line)</p>
</blockquote>

<a name="dbdevt"><h3>Database Development</h3></a>

<p><a href="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/e6806d6a408841c36a6f8f8c63f0c57018c883db/687474703a2f2f692e696d6775722e636f6d2f6562395339467a2e6a7067" alt="" data-canonical-src="http://i.imgur.com/eb9S9Fz.jpg" style="max-width:100%;"></a></p>

<p>Non-relational database development is beyond the scope of this book. Instead, we will focus on relational database since it is a fundamental technology and covers most use cases for business applications.</p>

<a name="rdbms"><h4> Basics of RDBMS</h4></a>

<ul class="task-list">
<li>Relational database relationships (one-to-one, one-to-many, many-to-many</li>
<li>Read performance is about indexes (like reading an index in a book)</li>
<li>SQL joins</li>
<li>Transactions (it's all or nothing, ACID constraints)</li>
<li>SQL DDL (CREATE, ALTER TABLE, etc) vs SQL DML (INSERT, UPDATE, DELETE)</li>
<li>Database security (field encryption, SQL injection, etc)</li>
<li>Working Dataset (Read-write) vs Archived Dataset (Read-only)</li>
<li>User administration (user permissions vs role-based ACL)</li>
</ul>
<a name="whyrdb"><h4>Why Relational Database?</h4></a>

<ul class="task-list">
<li>ACID Guarantees - banks need this "all-or-nothing" guarantee to transactions. Either money was deposited or not, there is no limbo state</li>
<li>The relational model is declarative - you use SQL to define, manipulate and query data</li>
<li>Separation of concerns - unlike object-relational database (e.g. PostgreSQL), relational database simply store data. In my view, objects, user-defined functions, triggers and stored procedures should be relegated to the logic layer, not at the database layer. Moreover, blobs or objects can be stored and retrieved more efficiently with REST-based services like S3, Swift and the like</li>
<li>Easy to learn and use - just look at MySQL, the world's most popular open source database</li>
</ul>
<a name="isolation"><h4>Isolation Levels</h4></a>

<p><strong>From High Performance MySQL, Third Edition:</strong></p>

<p>Isolation is more complex than it looks. The SQL standard defines four isolation levels, with specific rules for which changes are and aren’t visible inside and outside a transaction. Lower isolation levels typically allow higher concurrency and have lower overhead.</p>

<p><strong>READ UNCOMMITTED</strong></p>

<p>In the  READ UNCOMMITTED isolation level, transactions can view the results of uncommitted transactions. At this level, many problems can occur unless you really, really know what you are doing and have a good reason for doing it. This level is rarely used in practice, because its performance isn’t much better than the other levels, which have many advantages. Reading uncommitted data is also known as a dirty read.</p>

<p><strong>READ COMMITTED</strong></p>

<p>The default isolation level for most database systems (but not MySQL!) is READ COMMITTED . It satisfies the simple definition of isolation used earlier: a transaction will see only those changes made by transactions that were already committed when it began, and its changes won’t be visible to others until it has committed. This level still allows what’s known as a nonrepeatable read. This means you can run the same statement twice and see different data.</p>

<p><strong>REPEATABLE READ</strong></p>

<p>REPEATABLE READ solves the problems that  READ UNCOMMITTED allows. It guarantees that any rows a transaction reads will “look the same” in subsequent reads within the same transaction, but in theory it still allows another tricky problem: phantom reads. Simply put, a phantom read can happen when you select some range of rows, another transaction inserts a new row into the range, and then you select the same range again; you will then see the new “phantom” row. InnoDB and XtraDB solve the phantom read problem with multiversion concurrency control. </p>

<p>REPEATABLE READ is MySQL’s default transaction isolation level.</p>

<p><strong>SERIALIZABLE</strong></p>

<p>The highest level of isolation,  SERIALIZABLE , solves the phantom read problem by forcing transactions to be ordered so that they can’t possibly conflict. In a nutshell, SERIALIZABLE places a lock on every row it reads. At this level, a lot of timeouts and lock contention can occur. We’ve rarely seen people use this isolation level, but your application’s needs might force you to accept the decreased concurrency in favor of the data stability that results.</p>

<a name="limitsrdb"><h4>Limitations of Relational Database</h4></a>

<p>Don't abuse the relational model - here is Rule 14 from <em>"Scalability Rules" book by Martin Abbott and Michael Fisher</em>:</p>

<ul class="task-list">
<li>
<strong>What</strong>: Use relational databases when you need ACID properties to maintain relationships between your data. For other data storage needs consider more appropriate tools.</li>
<li>
<strong>When to use</strong>: When you are introducing new data or data structures into the architecture of a system.</li>
<li>
<strong>How to use</strong>: Consider the data volume, amount of storage, response time requirements, relationships, and other factors to choose the most appropriate storage tool.</li>
<li>
<strong>Why</strong>: An RDBMS provides great transactional integrity but is more difficult to scale, costs more, and has lower availability than many other storage options.</li>
<li>
<strong>Key takeaways</strong>: Use the right storage tool for your data. Don’t get lured into sticking everything in a relational database just because you are comfortable accessing data in a database.</li>
</ul>
<p>Of course, you may use NoSQL for non-relational data models:</p>

<ol class="task-list">
<li>Document-oriented - MongoDB, CouchDB</li>
<li>Graph - Neo4j</li>
<li>Column-oriented - HBase</li>
<li>Key-value - Riak, Redis, DynamoDB</li>
</ol>
<a name="basicsrdb"><h4>Basics of Relational Database</h4></a>

<ul class="task-list">
<li>Relational database management system - this is the software like MySQL that manages relational databases</li>
<li>Database - this is the container that houses the relational tables</li>
<li>Table - like in a spreadsheet, you may visualize a table as the container of vertical columns and horizontal rows of data. Think of a table as an entity</li>
<li>Field (aka column) - like in compiled programming languages, a field is a kind of data type in a table, an attribute of an entity. Think property of an object in OOP. You may visualize a field or column as the vertical set of all data in a spreadsheet<br>
</li>
<li>Row - you may visualize a row as the horizontal set of all data in a spreadsheet<br>
</li>
<li>Null - according to <a href="http://en.wikipedia.org/wiki/Three-valued_logic">Wikipedia</a>,</li>
</ul>
<p><em>The database structural query language SQL implements ternary logic as a means of handling comparisons with NULL field content. The original intent of NULL in SQL was to represent missing data in a database, i.e. the assumption that an actual value exists, but that the value is not currently recorded in the database.</em></p>

<p>Please refer to MySQL documentation on <a href="http://dev.mysql.com/doc/refman/5.0/en/problems-with-null.html">problems with NULL</a>.</p>

<ul class="task-list">
<li>Primary key - from <a href="http://en.wikipedia.org/wiki/Unique_key">Wikipedia</a>, a field that uniquely identifies the characteristics of each row. For now, suffice to say that a primary key is auto-increment (that is, auto-increment automatically assigns an integer as unique key in a table). A primary key optionally can be a foreign key to a related table </li>
<li>Foreign key - the primary key of a related table</li>
<li>Index - like index in a book, an index is a data structure that facilitates searching for rows more efficiently</li>
<li>One-to-one relationship - fields (or attributes) belong to one table only. For example, first name, last name, date of birth and so on belong to one entity only (person)</li>
</ul>
<table>
<thead><tr>
<th>Customers</th>
</tr></thead>
<tbody>
<tr>
<td>Firstname</td>
</tr>
<tr>
<td>Lastname</td>
</tr>
<tr>
<td>DOB</td>
</tr>
</tbody>
</table>
<ul class="task-list">
<li>One-to-many relationship - field in one table is recurring in a related table. For example, a state has many cities.</li>
</ul>
<table>
<thead><tr>
<th>States Table</th>
<th>StateID</th>
</tr></thead>
<tbody>
<tr>
<td>California</td>
<td>1</td>
</tr>
<tr>
<td>Portland</td>
<td>2</td>
</tr>
</tbody>
</table>
<table>
<thead><tr>
<th>Cities Table</th>
<th>StateID</th>
</tr></thead>
<tbody>
<tr>
<td>Los Angeles</td>
<td>1</td>
</tr>
<tr>
<td>San Francisco</td>
<td>1</td>
</tr>
<tr>
<td>San Jose</td>
<td>1</td>
</tr>
<tr>
<td>Palo Alto</td>
<td>1</td>
</tr>
</tbody>
</table>
<ul class="task-list">
<li>Many-to-many relationship - fields in table A and other fields in table B are contained in a third table C. For example, suppose we have table A (customers) and table B (products). To track which product a customer has subscribed, we need to create table C (accounts).</li>
</ul>
<table>
<thead><tr>
<th>Customers</th>
</tr></thead>
<tbody>
<tr>
<td>Peter</td>
</tr>
<tr>
<td>Paul</td>
</tr>
<tr>
<td>John</td>
</tr>
</tbody>
</table>
<table>
<thead><tr>
<th>Products</th>
<th>ProductID</th>
</tr></thead>
<tbody>
<tr>
<td>Savings</td>
<td>1</td>
</tr>
<tr>
<td>Checking</td>
<td>2</td>
</tr>
<tr>
<td>Housing Loan</td>
<td>3</td>
</tr>
<tr>
<td>Auto Loan</td>
<td>4</td>
</tr>
</tbody>
</table>
<table>
<thead><tr>
<th>Accounts</th>
<th>ProductID</th>
</tr></thead>
<tbody>
<tr>
<td>Peter</td>
<td>1</td>
</tr>
<tr>
<td>Peter</td>
<td>3</td>
</tr>
<tr>
<td>Paul</td>
<td>2</td>
</tr>
<tr>
<td>John</td>
<td>4</td>
</tr>
<tr>
<td>John</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Without going into the technical detail of database normalization, we could summarize the basics of a sound relational model as follows:</p>

<ol class="task-list">
<li>Know your one-to-one relationship</li>
<li>Know your one-to-many relationship</li>
<li>Know your many-to-many relationship</li>
<li>That's it!</li>
</ol>
<p>Use SQL or NoSQL where applicable, not ORM (object/relational mapper).</p>

<a name="whysql"><h4>Why SQL?</h4></a>

<ol class="task-list">
<li>First and foremost, ORM is a <a href="http://en.wikipedia.org/wiki/Leaky_abstraction">leaky abstraction</a> because it won't solve all the data retrieval and data manipulation that SQL natively provides. </li>
<li>Second, it guarantees ACID transactions. If you don't need ACID guarantees, you can use NoSQL</li>
<li>Third, SQL is the single source of truth for relational databases, not multiple ORMs from multiple frameworks or libraries </li>
<li>Even Google marries SQL and NoSQL with its <a href="http://highscalability.com/blog/2012/9/24/google-spanners-most-surprising-revelation-nosql-is-out-and.html">Spanner</a> database</li>
<li>Ceph RBD puts an end to myth of RDBMS scalability (or any <a href="http://en.wikipedia.org/wiki/NewSQL">NewSQL</a> product out there)</li>
</ol>
<a name="sql"><h4>SQL Caveats</h4></a>

<ol class="task-list">
<li>A basic knowledge of <a href="http://use-the-index-luke.com/">SQL indexing</a> would squeeze more performance out of your queries</li>
<li>SQL is just a specification. The implementation varies with RDBMS software</li>
<li>A poor craftsman blames his tool (SQL)</li>
</ol>
<a name="sqljoin"><h4>MySQL Join</h4></a>

<p>The following are my references on SQL joins.</p>

<ul class="task-list">
<li>From <a href="http://www.codinghorror.com/blog/2007/10/a-visual-explanation-of-sql-joins.html">CodingHorror</a> by Jeff Atwood</li>
<li>From <a href="http://www.codeproject.com/Articles/33052/Visual-Representation-of-SQL-Joins">CodeProject</a> by C.L.Moffatt</li>
</ul>
<p><a href="https://camo.githubusercontent.com/d1c72e3457fd4acbdf72452324fcda7d58b5b4e6/687474703a2f2f692e696d6775722e636f6d2f6969697136766b2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/d1c72e3457fd4acbdf72452324fcda7d58b5b4e6/687474703a2f2f692e696d6775722e636f6d2f6969697136766b2e706e67" alt="" data-canonical-src="http://i.imgur.com/iiiq6vk.png" style="max-width:100%;"></a></p>

<p>Here is my version derived from those above-mentioned articles with examples from <a href="http://www.mathsisfun.com/sets/venn-diagrams.html">MathIsFun.com</a></p>

<p>Suppose we have two MySQL tables of the same structure with id and name fields:</p>

<ul class="task-list">
<li>Soccer Table</li>
<li>Tennis Table</li>
</ul>
<p>Now let's say that alex, casey, drew and hunter play Soccer:</p>

<ul class="task-list">
<li>Soccer = {alex, casey, drew, hunter}</li>
</ul>
<p>And casey, drew and jade play Tennis:</p>

<ul class="task-list">
<li>Tennis = {casey, drew, jade}</li>
</ul>
<p><strong>INNER JOIN</strong></p>

<div class="highlight highlight-css"><pre><span class="nt">select</span> <span class="o">*</span> <span class="nt">from</span> <span class="nt">soccer</span> <span class="nt">s</span>
<span class="nt">inner</span> <span class="nt">join</span> <span class="nt">tennis</span> <span class="nt">t</span>
<span class="nt">on</span> <span class="nt">s</span><span class="nc">.name</span> <span class="o">=</span> <span class="nt">t</span><span class="nc">.name</span>
</pre></div>

<p>or you can issue this SQL statement and get the same result.</p>

<div class="highlight highlight-css"><pre><span class="nt">select</span> <span class="o">*</span> <span class="nt">from</span> <span class="nt">soccer</span> <span class="nt">s</span><span class="o">,</span> <span class="nt">tennis</span> <span class="nt">t</span>
<span class="nt">where</span> <span class="nt">s</span><span class="nc">.name</span> <span class="o">=</span> <span class="nt">t</span><span class="nc">.name</span>
</pre></div>

<p>Result:</p>

<div class="highlight highlight-css"><pre>    <span class="nt">id</span>  <span class="nt">name</span>        <span class="nt">id</span>  <span class="nt">name</span>  
<span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>
     <span class="nt">3</span>  <span class="nt">casey</span>        <span class="nt">1</span>  <span class="nt">casey</span> 
     <span class="nt">4</span>  <span class="nt">drew</span>         <span class="nt">2</span>  <span class="nt">drew</span>  
</pre></div>

<p><strong>LEFT OUTER JOIN OR LEFT JOIN</strong></p>

<div class="highlight highlight-css"><pre><span class="nt">select</span> <span class="o">*</span> <span class="nt">from</span> <span class="nt">soccer</span> <span class="nt">s</span>
<span class="nt">left</span> <span class="nt">outer</span> <span class="nt">join</span> <span class="nt">tennis</span> <span class="nt">t</span>
<span class="nt">on</span> <span class="nt">s</span><span class="nc">.name</span> <span class="o">=</span> <span class="nt">t</span><span class="nc">.name</span>
</pre></div>

<p>Result:</p>

<div class="highlight highlight-css"><pre>    <span class="nt">id</span>  <span class="nt">name</span>        <span class="nt">id</span>  <span class="nt">name</span>  
<span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>
     <span class="nt">1</span>  <span class="nt">alex</span>    <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>
     <span class="nt">2</span>  <span class="nt">hunter</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>
     <span class="nt">3</span>  <span class="nt">casey</span>        <span class="nt">1</span>  <span class="nt">casey</span> 
     <span class="nt">4</span>  <span class="nt">drew</span>         <span class="nt">2</span>  <span class="nt">drew</span>  
</pre></div>

<p><strong>LEFT EXCLUDING JOIN</strong></p>

<p>Soccer − Tennis = {alex, hunter}</p>

<div class="highlight highlight-css"><pre><span class="nt">select</span> <span class="o">*</span> <span class="nt">from</span> <span class="nt">soccer</span> <span class="nt">s</span>
<span class="nt">left</span> <span class="nt">outer</span> <span class="nt">join</span> <span class="nt">tennis</span> <span class="nt">t</span>
<span class="nt">on</span> <span class="nt">s</span><span class="nc">.name</span> <span class="o">=</span> <span class="nt">t</span><span class="nc">.name</span>
<span class="nt">where</span> <span class="nt">t</span><span class="nc">.name</span> <span class="nt">IS</span> <span class="nt">NULL</span>
</pre></div>

<p>Result:</p>

<div class="highlight highlight-css"><pre>    <span class="nt">id</span>  <span class="nt">name</span>        <span class="nt">id</span>  <span class="nt">name</span>  
<span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>
     <span class="nt">1</span>  <span class="nt">alex</span>    <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>
     <span class="nt">2</span>  <span class="nt">hunter</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>
</pre></div>

<blockquote>
<p>Note: Left outer join simply means you retrieve all the rows from the left table <strong>regardless</strong> if there is matching record on the right table or not. Right outer join is basically the same thing as left outer join if you reverse the order of the table.</p>
</blockquote>

<p><strong>RIGHT EXCLUDING JOIN</strong></p>

<div class="highlight highlight-css"><pre><span class="nt">select</span> <span class="o">*</span> <span class="nt">from</span> <span class="nt">tennis</span> <span class="nt">t</span>
<span class="nt">right</span> <span class="nt">outer</span> <span class="nt">join</span> <span class="nt">soccer</span> <span class="nt">s</span>
<span class="nt">on</span> <span class="nt">t</span><span class="nc">.name</span> <span class="o">=</span> <span class="nt">s</span><span class="nc">.name</span>
<span class="nt">where</span> <span class="nt">t</span><span class="nc">.name</span> <span class="nt">IS</span> <span class="nt">NULL</span>
</pre></div>

<p>Result:</p>

<div class="highlight highlight-css"><pre>    <span class="nt">id</span>  <span class="nt">name</span>        <span class="nt">id</span>  <span class="nt">name</span>  
<span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>
<span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>       <span class="nt">1</span>  <span class="nt">alex</span>  
<span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>       <span class="nt">2</span>  <span class="nt">hunter</span>
</pre></div>

<p><strong>FULL OUTER JOIN OR UNION</strong></p>

<blockquote>
<p>Note: There is no FULL OUTER JOIN syntax in MySQL but you can use UNION.</p>
</blockquote>

<div class="highlight highlight-css"><pre><span class="nt">select</span> <span class="o">*</span> <span class="nt">from</span> <span class="nt">soccer</span> <span class="nt">s</span>
<span class="nt">left</span> <span class="nt">outer</span> <span class="nt">join</span> <span class="nt">tennis</span> <span class="nt">t</span>
<span class="nt">on</span> <span class="nt">s</span><span class="nc">.name</span> <span class="o">=</span> <span class="nt">t</span><span class="nc">.name</span>

<span class="nt">union</span>

<span class="nt">select</span> <span class="o">*</span> <span class="nt">from</span> <span class="nt">soccer</span> <span class="nt">s</span>
<span class="nt">right</span> <span class="nt">outer</span> <span class="nt">join</span> <span class="nt">tennis</span> <span class="nt">t</span>
<span class="nt">on</span> <span class="nt">s</span><span class="nc">.name</span> <span class="o">=</span> <span class="nt">t</span><span class="nc">.name</span>
</pre></div>

<p>Result:</p>

<div class="highlight highlight-css"><pre>    <span class="nt">id</span>  <span class="nt">name</span>        <span class="nt">id</span>  <span class="nt">name</span>  
<span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>
     <span class="nt">1</span>  <span class="nt">alex</span>    <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>
     <span class="nt">2</span>  <span class="nt">hunter</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>
     <span class="nt">3</span>  <span class="nt">casey</span>        <span class="nt">1</span>  <span class="nt">casey</span> 
     <span class="nt">4</span>  <span class="nt">drew</span>         <span class="nt">2</span>  <span class="nt">drew</span>  
<span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>       <span class="nt">3</span>  <span class="nt">jade</span>  
</pre></div>

<p><strong>OUTER EXCLUDING JOIN</strong></p>

<p>Outer excluding join = Full outer join - Inner join</p>

<div class="highlight highlight-css"><pre><span class="nt">select</span> <span class="o">*</span> <span class="nt">from</span> <span class="nt">soccer</span> <span class="nt">s</span>
<span class="nt">left</span> <span class="nt">outer</span> <span class="nt">join</span> <span class="nt">tennis</span> <span class="nt">t</span>
<span class="nt">on</span> <span class="nt">s</span><span class="nc">.name</span> <span class="o">=</span> <span class="nt">t</span><span class="nc">.name</span>
<span class="nt">where</span> <span class="nt">s</span><span class="nc">.name</span> <span class="nt">IS</span> <span class="nt">NULL</span>
<span class="nt">or</span> <span class="nt">t</span><span class="nc">.name</span> <span class="nt">IS</span> <span class="nt">NULL</span>

<span class="nt">union</span>

<span class="nt">select</span> <span class="o">*</span> <span class="nt">from</span> <span class="nt">soccer</span> <span class="nt">s</span>
<span class="nt">right</span> <span class="nt">outer</span> <span class="nt">join</span> <span class="nt">tennis</span> <span class="nt">t</span>
<span class="nt">on</span> <span class="nt">s</span><span class="nc">.name</span> <span class="o">=</span> <span class="nt">t</span><span class="nc">.name</span>
<span class="nt">where</span> <span class="nt">s</span><span class="nc">.name</span> <span class="nt">IS</span> <span class="nt">NULL</span>
<span class="nt">or</span> <span class="nt">t</span><span class="nc">.name</span> <span class="nt">IS</span> <span class="nt">NULL</span>
</pre></div>

<p>Result:</p>

<div class="highlight highlight-css"><pre>    <span class="nt">id</span>  <span class="nt">name</span>        <span class="nt">id</span>  <span class="nt">name</span>  
<span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>  <span class="nt">------</span>
     <span class="nt">1</span>  <span class="nt">alex</span>    <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>
     <span class="nt">2</span>  <span class="nt">hunter</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>
<span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>  <span class="o">(</span><span class="nt">NULL</span><span class="o">)</span>       <span class="nt">3</span>  <span class="nt">jade</span>  
</pre></div>

<a name="sqltojson"><h4>MySQL to JSON</h4></a>

<p>The GROUP_CONCAT function is useful to construct MySQL data into JSON (courtesy of <a href="http://www.thomasfrank.se/mysql_to_json.html">Thomas Frank</a>)</p>

<div class="highlight highlight-sql"><pre><span class="k">SELECT</span> <span class="n">CONCAT</span><span class="p">(</span><span class="ss">"{"</span><span class="p">,</span>
<span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="s1">'"'</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="s1">'":'</span><span class="p">,</span>
    <span class="n">CONCAT</span><span class="p">(</span><span class="s1">'{"firstname":'</span><span class="p">,</span><span class="s1">'"'</span><span class="p">,</span><span class="n">firstname</span><span class="p">,</span><span class="s1">'",'</span><span class="p">),</span> 
    <span class="n">CONCAT</span><span class="p">(</span><span class="s1">'"lastname":'</span><span class="p">,</span><span class="s1">'"'</span><span class="p">,</span><span class="n">lastname</span><span class="p">,</span><span class="s1">'"}'</span><span class="p">)),</span>
<span class="ss">"}"</span><span class="p">)</span> <span class="k">as</span> <span class="n">json</span>
<span class="k">FROM</span> <span class="n">client</span>
</pre></div>

<p>Result:</p>

<div class="highlight highlight-javascript"><pre><span class="p">{</span>
    <span class="s2">"4"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"firstname"</span><span class="o">:</span> <span class="s2">"Peter"</span><span class="p">,</span>
        <span class="s2">"lastname"</span><span class="o">:</span> <span class="s2">"Cross"</span>
    <span class="p">},</span>
    <span class="s2">"5"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"firstname"</span><span class="o">:</span> <span class="s2">"Steve"</span><span class="p">,</span>
        <span class="s2">"lastname"</span><span class="o">:</span> <span class="s2">"Klein"</span>
    <span class="p">},</span>
    <span class="s2">"6"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"firstname"</span><span class="o">:</span> <span class="s2">"Mary"</span><span class="p">,</span>
        <span class="s2">"lastname"</span><span class="o">:</span> <span class="s2">"Smith"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>



</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
